<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accessify Minimal Integration</title>
    <style>
        /* Minimal Accessify Styles */
        .accessify-toggle {
            position: fixed !important; top: 20px !important; right: 20px !important; 
            width: 72px !important; height: 72px !important;
            min-width: 72px !important; min-height: 72px !important;
            max-width: 72px !important; max-height: 72px !important;
            background: transparent; border: none; border-radius: 16px; color: white;
            font-size: 40px !important; cursor: pointer; z-index: 99999 !important;
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
            display: flex !important; align-items: center; justify-content: center;
            background-image: url('assets/accessify-icon.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .accessify-toggle::before {
            display: none;
        }
        .accessify-panel {
            position: fixed !important; top: 20px !important; right: 20px !important; 
            width: 300px; max-width: 90vw;
            background: white; border: 1px solid rgba(0,0,0,0.15); border-radius: 16px;
            padding: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            z-index: 99998 !important; font-family: system-ui, sans-serif;
        }
        
        /* Ensure fixed positioning works even with parent transforms */
        html, body {
            position: relative;
        }
        
        /* Prevent any parent from affecting fixed positioning */
        .accessify-toggle {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            left: auto !important;
            bottom: auto !important;
        }
        
        .accessify-panel {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            left: auto !important;
            bottom: auto !important;
        }
        
        /* Protect color boxes from contrast/theme overrides */
        .color-test-box {
            background-color: inherit !important;
            color: inherit !important;
        }
        .accessify-panel.hidden { display: none; }
        .accessify-control { margin: 8px 0; padding: 12px; background: #f8f9fa;
            border-radius: 8px; display: flex; align-items: center; gap: 12px; }
        .accessify-control label { width: 36px; height: 36px; background: #e9ecef;
            border-radius: 6px; display: flex; align-items: center; justify-content: center;
            font-size: 20px !important; }
        .accessify-control select, .accessify-control input { flex: 1; padding: 12px;
            border: 1px solid #ddd; border-radius: 4px; font-size: 20px !important; }
        .accessify-control button { padding: 12px 16px; background: #f8f9fa;
            border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-size: 20px !important; }
        /* Isolate from text size changes - use fixed font sizes */
        .accessify-toggle {
            font-size: 40px !important;
            width: 72px !important;
            height: 72px !important;
        }
        
        .accessify-panel {
            font-size: 14px !important;
        }
        
        .accessify-panel h3 {
            font-size: 18px !important;
            margin: 0 0 12px 0;
        }
        
        .accessify-control {
            font-size: 14px !important;
        }
        
        .accessify-control label {
            font-size: 20px !important;
        }
        
        .accessify-control select,
        .accessify-control input,
        .accessify-control button {
            font-size: 14px !important;
        }
        /* RTL Support */
        .accessify-rtl .accessify-panel { right: auto !important; left: 20px !important; }
        .accessify-rtl .accessify-toggle { right: auto !important; left: 20px !important; }
        @media (max-width: 768px) {
            .accessify-panel { 
                width: calc(100vw - 40px);
                font-size: 13px !important;
            }
            .accessify-toggle { 
                width: 64px; 
                height: 64px; 
                font-size: 36px !important; 
            }
            .accessify-panel h3 {
                font-size: 16px !important;
            }
            .accessify-control {
                font-size: 13px !important;
            }
            .accessify-control select, 
            .accessify-control button { 
                font-size: 13px !important; 
            }
            .accessify-control label { 
                font-size: 18px !important; 
                width: 32px; 
                height: 32px; 
            }
        }
    </style>
</head>
<body>
    <!-- Accessify Controls -->
    <button class="accessify-toggle" onclick="togglePanel()" title="Accessibility Controls" aria-label="Toggle Accessibility Controls"></button>
    <div class="accessify-panel" id="panel">
        <h3>‚ôø Accessibility</h3>
        
        <div class="accessify-control">
            <label>A</label>
            <input type="range" min="0.5" max="3" step="0.1" value="1" oninput="setTextSize(this.value)">
            <button onclick="increaseText()">+</button>
            <button onclick="decreaseText()">-</button>
        </div>
        
        <div class="accessify-control">
            <label>‚óê</label>
            <select onchange="setContrast(this.value)">
                <option value="normal">Normal</option>
                <option value="high">High</option>
                <option value="inverted">Inverted</option>
                <option value="grayscale">Grayscale</option>
            </select>
        </div>
        
        <div class="accessify-control">
            <label>üé®</label>
            <select onchange="setTheme(this.value)">
                <option value="default">Default</option>
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="colorblind-friendly">Colorblind Friendly</option>
            </select>
        </div>
        
        <div class="accessify-control">
            <label>üåà</label>
            <select onchange="setColorFilter(this.value)">
                <option value="none">No Filter</option>
                <option value="protanopia">Protanopia</option>
                <option value="deuteranopia">Deuteranopia</option>
                <option value="tritanopia">Tritanopia</option>
                <option value="achromatopsia">Achromatopsia</option>
            </select>
        </div>
        
        <div class="accessify-control">
            <label>üåê</label>
            <select onchange="setLanguage(this.value)">
                <option value="en">English</option>
                <option value="he">◊¢◊ë◊®◊ô◊™</option>
                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>
        
        <div class="accessify-control">
            <label>‚úì</label>
            <button onclick="runTests()">Test</button>
            <button onclick="resetAll()">Reset</button>
        </div>
    </div>

    <!-- Include Accessify Library -->
    <script src="dist/accessify.min.js"></script>
    
    <script>
        // Minimal Accessify Integration
        let accessify = null;
        let panelVisible = true;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                accessify = new Accessify({ debug: false });
                await accessify.init();
                console.log('Accessify ready');
            } catch (e) {
                console.error('Accessify failed:', e);
            }
        });
        
        // Panel toggle
        function togglePanel() {
            const panel = document.getElementById('panel');
            panelVisible = !panelVisible;
            panel.classList.toggle('hidden', !panelVisible);
        }
        
        // Text size
        function setTextSize(size) {
            if (accessify?.visual) accessify.visual.setTextSize(parseFloat(size));
        }
        function increaseText() {
            if (accessify?.visual) accessify.visual.increaseTextSize();
        }
        function decreaseText() {
            if (accessify?.visual) accessify.visual.decreaseTextSize();
        }
        
        // Contrast
        function setContrast(mode) {
            try {
                if (accessify?.visual) {
                    accessify.visual.setContrastMode(mode);
                    console.log('Contrast mode set to:', mode);
                    
                    // Force apply contrast mode by directly manipulating styles
                    const styleId = 'accessify-contrast-override';
                    let styleEl = document.getElementById(styleId);
                    if (!styleEl) {
                        styleEl = document.createElement('style');
                        styleEl.id = styleId;
                        document.head.appendChild(styleEl);
                    }
                    
                    let css = '';
                    switch (mode) {
                        case 'high':
                            css = 'html, body { background-color: white !important; color: black !important; } html *, body * { background-color: inherit !important; color: inherit !important; border-color: black !important; } a { color: #0000EE !important; } a:visited { color: #551A8B !important; }';
                            break;
                        case 'inverted':
                            css = 'html, body { background-color: black !important; color: white !important; } html *, body * { background-color: inherit !important; color: inherit !important; border-color: white !important; } a { color: #00FFFF !important; } a:visited { color: #FF00FF !important; }';
                            break;
                        case 'grayscale':
                            css = 'html, body, html *, body * { filter: grayscale(100%) !important; }';
                            break;
                        case 'normal':
                        default:
                            css = 'html, body, html *, body * { filter: none !important; background-color: unset !important; color: unset !important; border-color: unset !important; }';
                            break;
                    }
                    styleEl.textContent = css;
                }
            } catch (error) {
                console.error('Error setting contrast mode:', error);
            }
        }
        
        // Theme
        function setTheme(theme) {
            try {
                if (accessify?.visual) {
                    accessify.visual.setTheme(theme);
                    console.log('Theme set to:', theme);
                }
            } catch (error) {
                console.error('Error setting theme:', error);
                alert('Invalid theme. Please select a valid option.');
            }
        }
        
        // Color Filter
        function setColorFilter(filter) {
            try {
                if (accessify?.visual) {
                    accessify.visual.setColorFilter(filter);
                    console.log('Color filter set to:', filter);
                    
                    // Force apply color filter by directly manipulating styles
                    const styleId = 'accessify-color-filter-override';
                    let styleEl = document.getElementById(styleId);
                    if (!styleEl) {
                        styleEl = document.createElement('style');
                        styleEl.id = styleId;
                        document.head.appendChild(styleEl);
                    }
                    
                    let css = '';
                    switch (filter) {
                        case 'protanopia':
                            // Use CSS matrix filter for protanopia simulation
                            css = 'html, body, html *, body * { filter: contrast(1.2) saturate(0.8) hue-rotate(-10deg) !important; }';
                            break;
                        case 'deuteranopia':
                            // Use CSS matrix filter for deuteranopia simulation
                            css = 'html, body, html *, body * { filter: contrast(1.2) saturate(0.8) hue-rotate(10deg) !important; }';
                            break;
                        case 'tritanopia':
                            // Use CSS matrix filter for tritanopia simulation
                            css = 'html, body, html *, body * { filter: contrast(1.1) saturate(0.7) hue-rotate(180deg) !important; }';
                            break;
                        case 'achromatopsia':
                            css = 'html, body, html *, body * { filter: grayscale(100%) !important; }';
                            break;
                        case 'none':
                        default:
                            css = 'html, body, html *, body * { filter: none !important; }';
                            break;
                    }
                    styleEl.textContent = css;
                }
            } catch (error) {
                console.error('Error setting color filter:', error);
            }
        }
        
        // Language
        function setLanguage(lang) {
            if (accessify?.multilingual) accessify.multilingual.setLanguage(lang);
        }
        
        // Testing
        function runTests() {
            if (accessify?.testingUtils) {
                accessify.testingUtils.runAccessibilityTests()
                    .then(r => alert('Tests completed. Check console.'))
                    .catch(e => alert('Tests failed. Check console.'));
            } else {
                alert('Testing not available');
            }
        }
        
        // Reset
        function resetAll() {
            if (accessify?.visual) {
                accessify.visual.resetTextSize();
                accessify.visual.setContrastMode('normal');
                accessify.visual.setTheme('default');
                accessify.visual.setColorFilter('none');
            }
            
            // Clear override styles
            const contrastOverride = document.getElementById('accessify-contrast-override');
            if (contrastOverride) contrastOverride.textContent = '';
            const colorFilterOverride = document.getElementById('accessify-color-filter-override');
            if (colorFilterOverride) colorFilterOverride.textContent = '';
            
            document.querySelector('input[type="range"]').value = 1;
            const selects = document.querySelectorAll('select');
            selects.forEach((select, index) => {
                if (index === 0) select.selectedIndex = 0; // Contrast
                if (index === 1) select.selectedIndex = 0; // Theme
                if (index === 2) select.selectedIndex = 0; // Color Filter
                if (index === 3) select.selectedIndex = 0; // Language
            });
        }
    </script>
    
    <!-- Demo Content -->
    <div style="padding: 40px; max-width: 600px; margin: 0 auto;">
        <h1>Minimal Accessify Integration</h1>
        <p>This is a minimal implementation with just the essential accessibility features.</p>
        <p>Click the ‚ôø button in the top-right corner to access the controls.</p>
        
        <h2>Features</h2>
        <ul>
            <li>Text size adjustment</li>
            <li>Contrast modes</li>
            <li>Theme switching</li>
            <li>Language selection</li>
            <li>Accessibility testing</li>
        </ul>
        
        <button onclick="alert('Test button')">Test Button</button>
        <input type="text" placeholder="Test input">
        
        <h2>Color Testing</h2>
        <p>Use the color filter dropdown above to test how colors appear for users with different types of color blindness:</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 20px 0;">
            <div class="color-test-box" style="background: #FF0000 !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Red</div>
            <div class="color-test-box" style="background: #00FF00 !important; color: black !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Green</div>
            <div class="color-test-box" style="background: #0000FF !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Blue</div>
            <div class="color-test-box" style="background: #FFFF00 !important; color: black !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Yellow</div>
            <div class="color-test-box" style="background: #FF00FF !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Magenta</div>
            <div class="color-test-box" style="background: #00FFFF !important; color: black !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Cyan</div>
            <div class="color-test-box" style="background: #FFA500 !important; color: black !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Orange</div>
            <div class="color-test-box" style="background: #800080 !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Purple</div>
            <div class="color-test-box" style="background: #FFC0CB !important; color: black !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Pink</div>
            <div class="color-test-box" style="background: #A52A2A !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Brown</div>
            <div class="color-test-box" style="background: #808080 !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Gray</div>
            <div class="color-test-box" style="background: #000000 !important; color: white !important; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center;">Black</div>
        </div>
        
        <div style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
            <h3 style="color: white; margin-top: 0;">Color Blindness Types</h3>
            <ul style="margin: 10px 0;">
                <li><strong>Protanopia:</strong> Red-green color blindness (cannot see red)</li>
                <li><strong>Deuteranopia:</strong> Red-green color blindness (cannot see green)</li>
                <li><strong>Tritanopia:</strong> Blue-yellow color blindness</li>
                <li><strong>Achromatopsia:</strong> Complete color blindness (grayscale)</li>
            </ul>
            <p style="margin-bottom: 0;">Select a filter from the dropdown above to see how these colors appear to users with different types of color blindness.</p>
        </div>
    </div>
    
    <!-- Additional style to protect colors from contrast mode overrides -->
    <style id="color-box-protection">
        /* This style block ensures color boxes maintain their colors */
        .color-test-box {
            /* Inline styles with !important will override this, preserving the colors */
            background-color: inherit !important;
            color: inherit !important;
        }
    </style>
</body>
</html>
