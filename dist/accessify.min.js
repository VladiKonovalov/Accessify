!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Accessify=t()}(this,function(){"use strict";class e{constructor(){this.events=new Map}on(e,t){if("function"!=typeof t)throw new Error("Callback must be a function");return this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t),this}off(e,t){if(!this.events.has(e))return this;const i=this.events.get(e),n=i.indexOf(t);return n>-1&&i.splice(n,1),0===i.length&&this.events.delete(e),this}emit(e,...t){if(!this.events.has(e))return this;return this.events.get(e).forEach(i=>{try{i(...t)}catch(t){console.error(`Error in event listener for "${e}":`,t)}}),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}eventNames(){return Array.from(this.events.keys())}listenerCount(e){return this.events.has(e)?this.events.get(e).length:0}hasListeners(e){return this.listenerCount(e)>0}}class t{constructor(){this.state=new Map,this.history=[],this.maxHistorySize=50,this.listeners=new Map}getState(){return Object.fromEntries(this.state)}get(e){return this.state.get(e)}set(e,t){const i=this.state.get(e);return i!==t&&(this._addToHistory(e,i,t),this.state.set(e,t),this._notifyListeners(e,t,i)),this}setState(e){if("object"!=typeof e||null===e)throw new Error("State must be an object");const t={};let i=!1;for(const[n,s]of Object.entries(e)){const e=this.state.get(n);e!==s&&(t[n]={old:e,new:s},this._addToHistory(n,e,s),this.state.set(n,s),i=!0)}return i&&this._notifyListeners("*",t,null),this}delete(e){const t=this.state.get(e);return this.state.has(e)&&(this._addToHistory(e,t,void 0),this.state.delete(e),this._notifyListeners(e,void 0,t)),this}has(e){return this.state.has(e)}clear(){const e=this.getState();return this._addToHistory("*",e,{}),this.state.clear(),this._notifyListeners("*",{},e),this}subscribe(e,t){if("function"!=typeof t)throw new Error("Callback must be a function");return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>this.unsubscribe(e,t)}unsubscribe(e,t){if(!this.listeners.has(e))return;const i=this.listeners.get(e),n=i.indexOf(t);n>-1&&i.splice(n,1),0===i.length&&this.listeners.delete(e)}getHistory(){return[...this.history]}clearHistory(){this.history=[]}undo(){if(0===this.history.length)return!1;const e=this.history.pop();return"*"===e.key?(this.state.clear(),e.oldValue&&this.setState(e.oldValue)):void 0===e.oldValue?this.state.delete(e.key):this.state.set(e.key,e.oldValue),!0}_addToHistory(e,t,i){this.history.push({key:e,oldValue:t,newValue:i,timestamp:Date.now()}),this.history.length>this.maxHistorySize&&this.history.shift()}_notifyListeners(e,t,i){if(this.listeners.has(e)){this.listeners.get(e).forEach(n=>{try{n(t,i,e)}catch(t){console.error(`Error in state listener for "${e}":`,t)}})}if(this.listeners.has("*")){this.listeners.get("*").forEach(n=>{try{n(t,i,e)}catch(e){console.error("Error in wildcard state listener:",e)}})}}createSelector(e){if("function"!=typeof e)throw new Error("Selector must be a function");let t=null,i=null;return()=>{const n=this.getState();return n!==i&&(i=n,t=e(n)),t}}size(){return this.state.size}keys(){return Array.from(this.state.keys())}values(){return Array.from(this.state.values())}entries(){return Array.from(this.state.entries())}}class i{constructor(e={}){this.config=this._mergeWithDefaults(e),this.featureFlags=new Set,this._initializeFeatureFlags()}get(e,t=null){return this._getNestedValue(this.config,e)??t}set(e,t){return this._setNestedValue(this.config,e,t),this}update(e){if("object"!=typeof e||null===e)throw new Error("Configuration must be an object");this.config=this._deepMerge(this.config,e),this._updateFeatureFlags()}getAll(){return{...this.config}}isFeatureEnabled(e){return this.featureFlags.has(e)}enableFeature(e){this.featureFlags.add(e),this._updateFeatureConfig(e,!0)}disableFeature(e){this.featureFlags.delete(e),this._updateFeatureConfig(e,!1)}toggleFeature(e){this.isFeatureEnabled(e)?this.disableFeature(e):this.enableFeature(e)}getEnabledFeatures(){return Array.from(this.featureFlags)}getDisabledFeatures(){return this._getAllFeatures().filter(e=>!this.featureFlags.has(e))}reset(){this.config=this._getDefaultConfig(),this._initializeFeatureFlags()}validate(){const e=[];["version","language","direction"].forEach(t=>{this.config[t]||e.push(`Missing required configuration: ${t}`)});return["en","he","ar","es","fr","de"].includes(this.config.language)||e.push(`Unsupported language: ${this.config.language}`),["ltr","rtl"].includes(this.config.direction)||e.push(`Invalid direction: ${this.config.direction}`),(this.config.visual.textSize.min<.5||this.config.visual.textSize.max>3)&&e.push("Text size range must be between 0.5 and 3.0"),{valid:0===e.length,errors:e}}_mergeWithDefaults(e){const t=this._getDefaultConfig(),i=this._deepMerge(t,e);return"default"===i.visual?.contrast?.current&&(i.visual.contrast.current="normal"),i}_getDefaultConfig(){return{version:"1.0.0",language:"en",direction:"ltr",theme:"default",debug:!1,visual:{textSize:{enabled:!0,current:1,min:.5,max:3,step:.1},contrast:{enabled:!0,current:"normal",modes:["normal","high","inverted","grayscale"]},brightness:{enabled:!0,current:1,min:.3,max:2,step:.1},themes:{enabled:!0,current:"default",available:["default","dark","light","colorblind-friendly"]},cursors:{enabled:!0,current:"default",available:["default","large","extra-large","high-contrast","crosshair","pointer-large","text-large"]},focusIndicators:{enabled:!0,style:"standard",color:"#0066cc",thickness:2},linkUnderlining:{enabled:!0,style:"none",color:"#0066cc",thickness:2,offset:2},colorFilters:{enabled:!0,current:"none",available:["none","protanopia","deuteranopia","tritanopia","achromatopsia","high-contrast","invert","sepia","blue-light"]},saturation:{enabled:!0,min:0,max:2,step:.1,current:1}},navigation:{keyboard:{enabled:!0,shortcuts:{enabled:!0,skipToContent:"Alt+S",toggleMenu:"Alt+M",increaseTextSize:"Alt+Plus",decreaseTextSize:"Alt+Minus",toggleContrast:"Alt+C",toggleHighContrast:"Alt+H"}},focus:{enabled:!0,trap:!0,visible:!0,order:"logical"},skipLinks:{enabled:!0,visible:!0}},reading:{textToSpeech:{enabled:!0,rate:1,pitch:1,volume:1,voice:"auto"},fonts:{enabled:!0,dyslexia:!0,current:"default",available:["default","opendyslexic","lexend","atkinson"]},spacing:{enabled:!0,lineHeight:1.5,letterSpacing:"normal",wordSpacing:"normal"},guides:{enabled:!0,readingRuler:!0,textHighlighting:!0}},motor:{targets:{enabled:!0,minSize:44,padding:8},gestures:{enabled:!0,alternatives:!0},voice:{enabled:!0,commands:!0},motion:{enabled:!0,reduced:!1},delays:{enabled:!0,interaction:0,hover:0}},multilingual:{enabled:!0,autoDetect:!0,fallback:"en",rtl:{enabled:!0,autoDetect:!0}},readingGuide:{enabled:!0,readingRuler:{enabled:!0,height:60,color:"#ff0000",opacity:.1},textHighlighting:{enabled:!0,color:"rgba(255, 255, 0, 0.3)"},textMasking:{enabled:!0,color:"rgba(0, 0, 0, 0.8)"}},screenReader:{enabled:!0,announcements:{enabled:!0,types:["polite","assertive","status","log"]},ariaEnhancements:{enabled:!0,autoEnhance:!0},liveRegions:{enabled:!0,polite:!0,assertive:!0,status:!0,log:!0}},plugins:{enabled:!0,autoLoad:!0,builtIn:["textToSpeech","voiceCommands","switchNavigation"]},testing:{enabled:!1,axe:!0,lighthouse:!0,manual:!0}}}_initializeFeatureFlags(){this.featureFlags.clear(),this.config.visual.textSize.enabled&&this.featureFlags.add("textSizeAdjustment"),this.config.visual.contrast.enabled&&this.featureFlags.add("highContrast"),this.config.visual.themes.enabled&&this.featureFlags.add("colorThemes"),this.config.visual.cursors.enabled&&this.featureFlags.add("customCursors"),this.config.visual.focusIndicators.enabled&&this.featureFlags.add("focusIndicators"),this.config.navigation.keyboard.enabled&&this.featureFlags.add("keyboardNavigation"),this.config.navigation.focus.enabled&&this.featureFlags.add("focusManagement"),this.config.navigation.skipLinks.enabled&&this.featureFlags.add("skipLinks"),this.config.reading.textToSpeech.enabled&&this.featureFlags.add("textToSpeech"),this.config.reading.fonts.enabled&&this.featureFlags.add("dyslexiaFonts"),this.config.reading.spacing.enabled&&this.featureFlags.add("textSpacing"),this.config.reading.guides.enabled&&this.featureFlags.add("readingGuides"),this.config.motor.targets.enabled&&this.featureFlags.add("largeTargets"),this.config.motor.gestures.enabled&&this.featureFlags.add("gestureAlternatives"),this.config.motor.voice.enabled&&this.featureFlags.add("voiceCommands"),this.config.motor.motion.enabled&&this.featureFlags.add("motionControl"),this.config.multilingual.enabled&&this.featureFlags.add("multilingual"),this.config.multilingual.rtl.enabled&&this.featureFlags.add("rtlSupport"),this.config.plugins.enabled&&this.featureFlags.add("plugins")}_updateFeatureFlags(){this._initializeFeatureFlags()}_updateFeatureConfig(e,t){const i={textSizeAdjustment:"visual.textSize.enabled",highContrast:"visual.contrast.enabled",colorThemes:"visual.themes.enabled",customCursors:"visual.cursors.enabled",focusIndicators:"visual.focusIndicators.enabled",keyboardNavigation:"navigation.keyboard.enabled",focusManagement:"navigation.focus.enabled",skipLinks:"navigation.skipLinks.enabled",textToSpeech:"reading.textToSpeech.enabled",dyslexiaFonts:"reading.fonts.enabled",textSpacing:"reading.spacing.enabled",readingGuides:"reading.guides.enabled",largeTargets:"motor.targets.enabled",gestureAlternatives:"motor.gestures.enabled",voiceCommands:"motor.voice.enabled",motionControl:"motor.motion.enabled",multilingual:"multilingual.enabled",rtlSupport:"multilingual.rtl.enabled",plugins:"plugins.enabled"}[e];i&&this._setNestedValue(this.config,i,t)}_getAllFeatures(){return["textSizeAdjustment","highContrast","colorThemes","customCursors","focusIndicators","keyboardNavigation","focusManagement","skipLinks","textToSpeech","dyslexiaFonts","textSpacing","readingGuides","largeTargets","gestureAlternatives","voiceCommands","motionControl","multilingual","rtlSupport","plugins"]}_deepMerge(e,t){const i={...e};for(const e in t)t.hasOwnProperty(e)&&("object"!=typeof t[e]||null===t[e]||Array.isArray(t[e])?i[e]=t[e]:i[e]=this._deepMerge(i[e]||{},t[e]));return i}_getNestedValue(e,t){return t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}_setNestedValue(e,t,i){const n=t.split("."),s=n.pop();n.reduce((e,t)=>(e[t]&&"object"==typeof e[t]||(e[t]={}),e[t]),e)[s]=i}}class n{constructor(e){this.accessify=e,this.plugins=new Map,this.initializedPlugins=new Set,this.pluginConfigs=new Map}register(e,t,i={}){if("function"!=typeof t)throw new Error("Plugin must be a class or constructor function");return this.plugins.has(e)?(console.warn(`Plugin "${e}" is already registered`),this):(this.plugins.set(e,t),this.pluginConfigs.set(e,i),console.log(`Plugin "${e}" registered successfully`),this)}unregister(e){return this.plugins.has(e)&&(this.initializedPlugins.has(e)&&this.destroy(e),this.plugins.delete(e),this.pluginConfigs.delete(e),console.log(`Plugin "${e}" unregistered`)),this}async init(){const e=this.accessify.configManager.get("plugins.builtIn",[]);for(const t of e)this.plugins.has(t)&&await this.initPlugin(t)}async initPlugin(e){if(!this.plugins.has(e))throw new Error(`Plugin "${e}" is not registered`);if(this.initializedPlugins.has(e))return console.warn(`Plugin "${e}" is already initialized`),this;try{const t=this.plugins.get(e),i=this.pluginConfigs.get(e),n=new t(this.accessify,i);"function"==typeof n.init&&await n.init(),this.plugins.set(e,n),this.initializedPlugins.add(e),this.accessify.emit("pluginInitialized",{name:e,plugin:n}),console.log(`Plugin "${e}" initialized successfully`)}catch(t){throw console.error(`Failed to initialize plugin "${e}":`,t),t}}destroy(){for(const e of this.initializedPlugins)this.destroyPlugin(e)}destroyPlugin(e){if(this.initializedPlugins.has(e))try{const t=this.plugins.get(e);t&&"function"==typeof t.destroy&&t.destroy(),this.initializedPlugins.delete(e),this.accessify.emit("pluginDestroyed",{name:e}),console.log(`Plugin "${e}" destroyed`)}catch(t){console.error(`Failed to destroy plugin "${e}":`,t)}}getPlugin(e){return this.initializedPlugins.has(e)?this.plugins.get(e):null}isInitialized(e){return this.initializedPlugins.has(e)}getRegisteredPlugins(){return Array.from(this.plugins.keys())}getInitializedPlugins(){return Array.from(this.initializedPlugins)}updatePluginConfig(e,t){if(!this.pluginConfigs.has(e))throw new Error(`Plugin "${e}" is not registered`);const i={...this.pluginConfigs.get(e),...t};if(this.pluginConfigs.set(e,i),this.initializedPlugins.has(e)){const t=this.plugins.get(e);t&&"function"==typeof t.updateConfig&&t.updateConfig(i)}this.accessify.emit("pluginConfigUpdated",{name:e,config:i})}enablePlugin(e){const t=this.accessify.configManager.get("plugins.builtIn",[]);t.includes(e)||(t.push(e),this.accessify.configManager.set("plugins.builtIn",t))}disablePlugin(e){const t=this.accessify.configManager.get("plugins.builtIn",[]),i=t.indexOf(e);i>-1&&(t.splice(i,1),this.accessify.configManager.set("plugins.builtIn",t),this.initializedPlugins.has(e)&&this.destroyPlugin(e))}async loadExternalPlugin(e,t,i={}){try{const n=await import(e),s=n.default||n[t];if(!s)throw new Error(`Plugin class not found in module: ${e}`);return this.register(t,s,i),await this.initPlugin(t),this.getPlugin(t)}catch(t){throw console.error(`Failed to load external plugin from ${e}:`,t),t}}getPluginStatus(){const e={};for(const t of this.plugins.keys())e[t]={registered:!0,initialized:this.initializedPlugins.has(t),config:this.pluginConfigs.get(t)};return e}validatePlugin(e){const t=[];"function"!=typeof e&&t.push("Plugin must be a class or constructor function");return["init","destroy"].forEach(i=>{"function"!=typeof e.prototype[i]&&t.push(`Plugin must implement ${i}() method`)}),{valid:0===t.length,errors:t}}createPluginAPI(e){return{name:e,accessify:this.accessify,config:this.pluginConfigs.get(e),on:(e,t)=>this.accessify.on(e,t),off:(e,t)=>this.accessify.off(e,t),emit:(e,...t)=>this.accessify.emit(e,...t),getState:()=>this.accessify.getState(),setState:e=>this.accessify.setState(e),getConfig:(e,t)=>this.accessify.configManager.get(e,t),setConfig:(e,t)=>this.accessify.configManager.set(e,t),log:(t,...i)=>console.log(`[${e}]`,t,...i),warn:(t,...i)=>console.warn(`[${e}]`,t,...i),error:(t,...i)=>console.error(`[${e}]`,t,...i)}}}class s{constructor(){this.userAgent=navigator.userAgent,this.browser=this._detectBrowser(),this.version=this._detectVersion(),this.features=this._detectFeatures(),this.isSupported=this._checkSupport()}_detectBrowser(){const e=this.userAgent.toLowerCase();return e.includes("chrome")&&!e.includes("edg")?"chrome":e.includes("firefox")?"firefox":e.includes("safari")&&!e.includes("chrome")?"safari":e.includes("edg")?"edge":e.includes("opera")||e.includes("opr")?"opera":"unknown"}_detectVersion(){const e=this.userAgent;let t="unknown";switch(this.browser){case"chrome":const i=e.match(/chrome\/(\d+)/i)||e.match(/chromium\/(\d+)/i);t=i?parseInt(i[1]):"unknown";break;case"firefox":const n=e.match(/firefox\/(\d+)/i);t=n?parseInt(n[1]):"unknown";break;case"safari":const s=e.match(/version\/(\d+)/i)||e.match(/safari\/(\d+)/i);t=s?parseInt(s[1]):"unknown";break;case"edge":const a=e.match(/edg\/(\d+)/i)||e.match(/edge\/(\d+)/i);t=a?parseInt(a[1]):"unknown";break;case"opera":const r=e.match(/(?:opera|opr)\/(\d+)/i);t=r?parseInt(r[1]):"unknown"}if("unknown"===t){const i=e.match(/(\d+\.\d+)/);i&&(t=parseInt(i[1].split(".")[0]))}return t}_detectFeatures(){return{arrowFunctions:!0,classes:"function"==typeof class{},modules:"import"in window||"function"==typeof window.import,promises:"undefined"!=typeof Promise,asyncAwait:(async()=>{})()instanceof Promise,speechSynthesis:"speechSynthesis"in window,speechRecognition:"webkitSpeechRecognition"in window||"SpeechRecognition"in window,webAudio:"AudioContext"in window||"webkitAudioContext"in window,webGL:"WebGLRenderingContext"in window,webGL2:"WebGL2RenderingContext"in window,canvas:"HTMLCanvasElement"in window,svg:"SVGElement"in window,cssGrid:CSS.supports("display","grid"),cssFlexbox:CSS.supports("display","flex"),cssCustomProperties:CSS.supports("--custom-property","value"),cssTransforms:CSS.supports("transform","translateX(10px)"),cssTransitions:CSS.supports("transition","all 0.3s"),cssAnimations:CSS.supports("animation","fadeIn 1s"),aria:"ariaHidden"in document.createElement("div"),focusVisible:CSS.supports(":focus-visible"),reducedMotion:CSS.supports("(prefers-reduced-motion: reduce)"),highContrast:CSS.supports("(prefers-contrast: high)"),colorScheme:CSS.supports("(prefers-color-scheme: dark)"),touch:"ontouchstart"in window,pointer:"onpointerdown"in window,gamepad:"getGamepads"in navigator,localStorage:"localStorage"in window,sessionStorage:"sessionStorage"in window,indexedDB:"indexedDB"in window,fetch:"fetch"in window,webSocket:"WebSocket"in window,fileReader:"FileReader"in window,fileAPI:"File"in window,performance:"performance"in window,requestAnimationFrame:"requestAnimationFrame"in window,requestIdleCallback:"requestIdleCallback"in window,crypto:"crypto"in window,subtle:"subtle"in(window.crypto||{}),intl:"Intl"in window,intlDateTimeFormat:"DateTimeFormat"in(window.Intl||{}),intlNumberFormat:"NumberFormat"in(window.Intl||{}),rtl:this._checkRTLSupport(),mobile:/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(this.userAgent),tablet:/ipad|android(?!.*mobile)/i.test(this.userAgent)}}_checkRTLSupport(){const e=document.createElement("div");e.style.direction="rtl",e.style.unicodeBidi="bidi-override",e.textContent="×",document.body.appendChild(e);const t=e.offsetLeft>0;return document.body.removeChild(e),t}_checkSupport(){if(console.log("Browser Detection:",{browser:this.browser,version:this.version,userAgent:this.userAgent}),"unknown"===this.browser)return console.warn("Unknown browser detected, allowing for development"),!0;const e={chrome:60,firefox:55,safari:12,edge:79,opera:47}[this.browser];if(!e)return console.warn(`No minimum version defined for ${this.browser}, allowing for development`),!0;if("unknown"===this.version)return console.warn("Unknown version detected, allowing for development"),!0;const t=this.version>=e;return t||console.warn(`Browser version ${this.version} is below minimum ${e} for ${this.browser}`),t}getInfo(){return{browser:this.browser,version:this.version,userAgent:this.userAgent,isSupported:this.isSupported,features:this.features,isMobile:this.features.mobile,isTablet:this.features.tablet,isDesktop:!this.features.mobile&&!this.features.tablet}}hasFeature(e){return!0===this.features[e]}getUnsupportedFeatures(){return["arrowFunctions","classes","promises","speechSynthesis","cssGrid","cssFlexbox","cssCustomProperties","aria","localStorage","fetch","performance","requestAnimationFrame","intl"].filter(e=>!this.features[e])}getCapabilitiesScore(){const e=Object.keys(this.features),t=e.filter(e=>this.features[e]);return Math.round(t.length/e.length*100)}getAccessibilitySupport(){return{speechSynthesis:this.features.speechSynthesis,speechRecognition:this.features.speechRecognition,aria:this.features.aria,focusVisible:this.features.focusVisible,reducedMotion:this.features.reducedMotion,highContrast:this.features.highContrast,colorScheme:this.features.colorScheme,rtl:this.features.rtl,touch:this.features.touch,pointer:this.features.pointer}}getRecommendedFeatures(){const e=[];return this.features.speechSynthesis&&e.push("textToSpeech"),this.features.speechRecognition&&e.push("voiceCommands"),this.features.touch&&e.push("touchNavigation","gestureAlternatives"),this.features.pointer&&e.push("pointerEvents"),this.features.reducedMotion&&e.push("reducedMotion"),this.features.highContrast&&e.push("highContrast"),this.features.rtl&&e.push("rtlSupport"),e}getOptimizations(){return{chrome:{useWebGL:this.features.webGL2,useWebAudio:this.features.webAudio,useServiceWorker:"serviceWorker"in navigator},firefox:{useWebGL:this.features.webGL,useWebAudio:this.features.webAudio,useIndexedDB:this.features.indexedDB},safari:{useWebGL:this.features.webGL,useWebAudio:this.features.webAudio,useLocalStorage:this.features.localStorage},edge:{useWebGL:this.features.webGL2,useWebAudio:this.features.webAudio,useServiceWorker:"serviceWorker"in navigator}}[this.browser]||{}}}class a{constructor(){this.errors=[],this.maxErrors=100,this.errorTypes={INITIALIZATION:"initialization",RUNTIME:"runtime",CONFIGURATION:"configuration",PLUGIN:"plugin",COMPONENT:"component",NETWORK:"network",PERMISSION:"permission",COMPATIBILITY:"compatibility"}}handle(e,t="",i=this.errorTypes.RUNTIME){const n=this._createErrorInfo(e,t,i);return this.addError(n),this._logError(n),"undefined"!=typeof window&&window.Accessify&&window.Accessify.prototype&&window.accessifyInstance&&"function"==typeof window.accessifyInstance.emit&&window.accessifyInstance.emit("error",n),n}addError(e){this.errors.push(e),this.errors.length>this.maxErrors&&this.errors.shift()}_createErrorInfo(e,t,i){return{id:this._generateErrorId(),timestamp:(new Date).toISOString(),type:i,context:t,message:e.message||String(e),stack:e.stack,userAgent:navigator.userAgent,url:window.location.href,severity:this._determineSeverity(e,i),recoverable:this._isRecoverable(e,i)}}_generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}_determineSeverity(e,t){return{[this.errorTypes.INITIALIZATION]:"high",[this.errorTypes.CONFIGURATION]:"medium",[this.errorTypes.PLUGIN]:"medium",[this.errorTypes.COMPONENT]:"medium",[this.errorTypes.NETWORK]:"low",[this.errorTypes.PERMISSION]:"high",[this.errorTypes.COMPATIBILITY]:"high",[this.errorTypes.RUNTIME]:"medium"}[t]||"medium"}_isRecoverable(e,t){return[this.errorTypes.NETWORK,this.errorTypes.PLUGIN,this.errorTypes.COMPONENT].includes(t)}_logError(e){const t=this._getLogLevel(e.severity),i=this._formatLogMessage(e);switch(t){case"error":console.error(i,e);break;case"warn":console.warn(i,e);break;case"info":console.info(i,e);break;default:console.log(i,e)}}_getLogLevel(e){return{high:"error",medium:"warn",low:"info"}[e]||"log"}_formatLogMessage(e){return`[Accessify ${e.type.toUpperCase()}] ${e.context}: ${e.message}`}getErrors(){return[...this.errors]}getErrorsByType(e){return this.errors.filter(t=>t.type===e)}getErrorsBySeverity(e){return this.errors.filter(t=>t.severity===e)}getRecentErrors(e=10){return this.errors.slice(-e)}clearErrors(){this.errors=[]}getErrorStats(){const e={total:this.errors.length,byType:{},bySeverity:{},recent:this.getRecentErrors(5).length};return this.errors.forEach(t=>{e.byType[t.type]=(e.byType[t.type]||0)+1}),this.errors.forEach(t=>{e.bySeverity[t.severity]=(e.bySeverity[t.severity]||0)+1}),e}hasCriticalErrors(){return this.errors.some(e=>"high"===e.severity)}getCriticalErrors(){return this.errors.filter(e=>"high"===e.severity)}createErrorReport(){const e=this.getErrorStats(),t=this.getCriticalErrors();return{timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,stats:e,criticalErrors:t,allErrors:this.errors,recommendations:this._getErrorRecommendations()}}_getErrorRecommendations(){const e=[],t=this.getErrorStats();return t.byType[this.errorTypes.COMPATIBILITY]>0&&e.push("Consider updating your browser or using a supported browser"),t.byType[this.errorTypes.PERMISSION]>0&&e.push("Check browser permissions for microphone, camera, and storage access"),t.byType[this.errorTypes.NETWORK]>0&&e.push("Check your internet connection and try again"),t.byType[this.errorTypes.PLUGIN]>0&&e.push("Some accessibility plugins may not be working correctly"),e}wrapFunction(e,t="",i=this.errorTypes.RUNTIME){return(...n)=>{try{return e(...n)}catch(e){throw this.handle(e,t,i),e}}}wrapAsyncFunction(e,t="",i=this.errorTypes.RUNTIME){return async(...n)=>{try{return await e(...n)}catch(e){throw this.handle(e,t,i),e}}}createErrorBoundary(e){return{catch:(t,i="")=>{this.handle(t,`${e}: ${i}`,this.errorTypes.COMPONENT)},wrap:t=>this.wrapFunction(t,e,this.errorTypes.COMPONENT),wrapAsync:t=>this.wrapAsyncFunction(t,e,this.errorTypes.COMPONENT)}}setupGlobalHandlers(){window.addEventListener("error",e=>{this.handle(e.error,"Global error",this.errorTypes.RUNTIME)}),window.addEventListener("unhandledrejection",e=>{this.handle(e.reason,"Unhandled promise rejection",this.errorTypes.RUNTIME)});const e=console.error;console.error=(...t)=>{e.apply(console,t);const i=t.join(" ");(i.includes("Accessify")||i.includes("accessibility"))&&this.handle(new Error(i),"Console error",this.errorTypes.RUNTIME)}}removeGlobalHandlers(){console.warn("Global error handlers cannot be easily removed. Consider restarting the page.")}}class r{constructor(e){this.accessify=e,this.isInitialized=!1,this.currentStyles=new Map,this.styleElement=null,this.originalStyles=new Map}async init(){try{if(this.isInitialized)return;this.styleElement=document.createElement("style"),this.styleElement.id="accessify-visual-styles",document.head.appendChild(this.styleElement),this._storeOriginalStyles(),await this._applyInitialConfiguration(),this._setupEventListeners(),this._initializeAltTextGeneration(),this.isInitialized=!0,this.accessify.emit("visualAccessibilityInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Visual accessibility initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this._removeEventListeners(),this._restoreOriginalStyles(),this.styleElement&&this.styleElement.parentNode&&this.styleElement.parentNode.removeChild(this.styleElement),this.currentStyles.clear(),this.isInitialized=!1,this.accessify.emit("visualAccessibilityDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Visual accessibility destruction","component")}}setTextSize(e){const t=this.accessify.configManager.get("visual.textSize"),i=Math.max(t.min,Math.min(t.max,e));this.accessify.configManager.set("visual.textSize.current",i),this._applyTextSize(i),this.accessify.emit("textSizeChanged",i)}increaseTextSize(){const e=this.accessify.configManager.get("visual.textSize"),t=e.current,i=Math.min(e.max,t+e.step);this.setTextSize(i)}decreaseTextSize(){const e=this.accessify.configManager.get("visual.textSize"),t=e.current,i=Math.max(e.min,t-e.step);this.setTextSize(i)}resetTextSize(){this.setTextSize(1)}setContrastMode(e){"default"===e&&(e="normal");if(!this.accessify.configManager.get("visual.contrast.modes").includes(e))throw new Error(`Invalid contrast mode: ${e}`);this.accessify.configManager.set("visual.contrast.current",e),this._applyContrastMode(e),this.accessify.emit("contrastModeChanged",e)}toggleContrastMode(){const e=this.accessify.configManager.get("visual.contrast.current"),t=this.accessify.configManager.get("visual.contrast.modes"),i=(t.indexOf(e)+1)%t.length;this.setContrastMode(t[i])}setBrightness(e){const t=this.accessify.configManager.get("visual.brightness"),i=Math.max(t.min,Math.min(t.max,e));this.accessify.configManager.set("visual.brightness.current",i),this._applyBrightness(i),this.accessify.emit("brightnessChanged",i)}setTheme(e){if(!this.accessify.configManager.get("visual.themes.available").includes(e))throw new Error(`Invalid theme: ${e}`);this.accessify.configManager.set("visual.themes.current",e),this._applyTheme(e),this.accessify.emit("themeChanged",e)}setColorFilter(e){if(!this.accessify.configManager.get("visual.colorFilters.available").includes(e))throw new Error(`Invalid color filter: ${e}`);this.accessify.configManager.set("visual.colorFilters.current",e),this._applyColorFilter(e),this.accessify.emit("colorFilterChanged",e)}_applyColorFilter(e){let t="";switch(e){case"protanopia":t="\n          * {\n            filter: url(#protanopia) !important;\n          }\n        ";break;case"deuteranopia":t="\n          * {\n            filter: url(#deuteranopia) !important;\n          }\n        ";break;case"tritanopia":t="\n          * {\n            filter: url(#tritanopia) !important;\n          }\n        ";break;case"achromatopsia":t="\n          * {\n            filter: grayscale(100%) !important;\n          }\n        ";break;case"high-contrast":t="\n          * {\n            filter: contrast(200%) brightness(150%) !important;\n          }\n        ";break;case"invert":t="\n          * {\n            filter: invert(100%) !important;\n          }\n        ";break;case"sepia":t="\n          * {\n            filter: sepia(100%) !important;\n          }\n        ";break;case"blue-light":t="\n          * {\n            filter: hue-rotate(180deg) saturate(150%) !important;\n          }\n        ";break;default:t="\n          * {\n            filter: none !important;\n          }\n        "}this._addStyle("color-filter",t)}setSaturation(e){const t=this.accessify.configManager.get("visual.saturation"),i=Math.max(t.min,Math.min(t.max,e));this.accessify.configManager.set("visual.saturation.current",i),this._applySaturation(i),this.accessify.emit("saturationChanged",i)}_applySaturation(e){const t=`\n      * {\n        filter: saturate(${e}) !important;\n      }\n    `;this._addStyle("saturation",t)}setCursor(e){if(!this.accessify.configManager.get("visual.cursors.available").includes(e))throw new Error(`Invalid cursor type: ${e}`);this.accessify.configManager.set("visual.cursors.current",e),this._applyCursor(e),this.accessify.emit("cursorChanged",e)}setFocusIndicator(e){const t=this.accessify.configManager.get("visual.focusIndicators");this.accessify.configManager.set("visual.focusIndicators.style",e),this._applyFocusIndicators(t),this.accessify.emit("focusIndicatorChanged",e)}setLinkUnderlining(e){const t=this.accessify.configManager.get("visual.linkUnderlining");this.accessify.configManager.set("visual.linkUnderlining.style",e),this._applyLinkUnderlining(t),this.accessify.emit("linkUnderliningChanged",e)}_applyLinkUnderlining(e){let t="";switch(e.style){case"always":t=`\n          a {\n            text-decoration: underline !important;\n            text-decoration-thickness: ${e.thickness}px !important;\n            text-underline-offset: ${e.offset}px !important;\n            text-decoration-color: ${e.color} !important;\n          }\n          \n          a:hover {\n            text-decoration-thickness: ${1.5*e.thickness}px !important;\n          }\n        `;break;case"hover":t=`\n          a {\n            text-decoration: none !important;\n          }\n          \n          a:hover {\n            text-decoration: underline !important;\n            text-decoration-thickness: ${e.thickness}px !important;\n            text-underline-offset: ${e.offset}px !important;\n            text-decoration-color: ${e.color} !important;\n          }\n        `;break;case"enhanced":t=`\n          a {\n            text-decoration: underline !important;\n            text-decoration-thickness: ${e.thickness}px !important;\n            text-underline-offset: ${e.offset}px !important;\n            text-decoration-color: ${e.color} !important;\n            border-bottom: 1px solid transparent !important;\n            transition: all 0.2s ease !important;\n          }\n          \n          a:hover {\n            text-decoration-thickness: ${2*e.thickness}px !important;\n            border-bottom-color: ${e.color} !important;\n            background-color: rgba(255, 255, 0, 0.1) !important;\n          }\n        `;break;case"double":t=`\n          a {\n            text-decoration: underline !important;\n            text-decoration-style: double !important;\n            text-decoration-thickness: ${e.thickness}px !important;\n            text-underline-offset: ${e.offset}px !important;\n            text-decoration-color: ${e.color} !important;\n          }\n        `;break;default:t="\n          a {\n            text-decoration: none !important;\n          }\n        "}this._addStyle("link-underlining",t)}_applyTextSize(e){const t=`\n      html {\n        font-size: ${16*e}px !important;\n      }\n      \n      body {\n        font-size: ${e}rem !important;\n      }\n      \n      * {\n        font-size: inherit !important;\n      }\n    `;this._addStyle("text-size",t)}_applyContrastMode(e){let t="";switch(e){case"high":t="\n          * {\n            background-color: white !important;\n            color: black !important;\n            border-color: black !important;\n          }\n          \n          a {\n            color: #0000EE !important;\n          }\n          \n          a:visited {\n            color: #551A8B !important;\n          }\n        ";break;case"inverted":t="\n          * {\n            background-color: black !important;\n            color: white !important;\n            border-color: white !important;\n          }\n          \n          a {\n            color: #00FFFF !important;\n          }\n          \n          a:visited {\n            color: #FF00FF !important;\n          }\n        ";break;case"grayscale":t="\n          * {\n            filter: grayscale(100%) !important;\n          }\n        ";break;default:t="\n          * {\n            filter: none !important;\n          }\n        "}this._addStyle("contrast-mode",t)}_applyBrightness(e){const t=`\n      * {\n        filter: brightness(${e}) !important;\n      }\n    `;this._addStyle("brightness",t)}_applyTheme(e){let t="";switch(e){case"dark":t="\n          * {\n            background-color: #1a1a1a !important;\n            color: #ffffff !important;\n            border-color: #333333 !important;\n          }\n          \n          a {\n            color: #66b3ff !important;\n          }\n          \n          input, textarea, select {\n            background-color: #2a2a2a !important;\n            color: #ffffff !important;\n            border-color: #444444 !important;\n          }\n        ";break;case"light":t="\n          * {\n            background-color: #ffffff !important;\n            color: #000000 !important;\n            border-color: #cccccc !important;\n          }\n          \n          a {\n            color: #0066cc !important;\n          }\n          \n          input, textarea, select {\n            background-color: #f8f8f8 !important;\n            color: #000000 !important;\n            border-color: #dddddd !important;\n          }\n        ";break;case"colorblind-friendly":t="\n          * {\n            background-color: #f8f8f8 !important;\n            color: #2c2c2c !important;\n            border-color: #666666 !important;\n          }\n          \n          a {\n            color: #0066cc !important;\n          }\n          \n          .error, .danger {\n            color: #d73027 !important;\n          }\n          \n          .warning {\n            color: #f46d43 !important;\n          }\n          \n          .success {\n            color: #1a9641 !important;\n          }\n        ";break;default:t="\n          * {\n            background-color: inherit !important;\n            color: inherit !important;\n            border-color: inherit !important;\n          }\n        "}this._addStyle("theme",t)}_applyCursor(e){let t="";switch(e){case"large":t='\n          * {\n            cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="16" fill="black"/></svg>\'), auto !important;\n          }\n        ';break;case"extra-large":t='\n          * {\n            cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><circle cx="24" cy="24" r="24" fill="black"/></svg>\'), auto !important;\n          }\n        ';break;case"high-contrast":t='\n          * {\n            cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="white" stroke="black" stroke-width="2"/></svg>\'), auto !important;\n          }\n        ';break;case"crosshair":t="\n          * {\n            cursor: crosshair !important;\n          }\n        ";break;case"pointer-large":t='\n          * {\n            cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M2 2 L2 22 L8 16 L14 22 L14 2 Z" fill="black"/></svg>\'), auto !important;\n          }\n        ';break;case"text-large":t='\n          * {\n            cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="32" viewBox="0 0 24 32"><line x1="12" y1="2" x2="12" y2="30" stroke="black" stroke-width="3"/></svg>\'), auto !important;\n          }\n        ';break;default:t="\n          * {\n            cursor: default !important;\n          }\n        "}this._addStyle("cursor",t)}_applyFocusIndicators(e){let t="";switch(e.style){case"highlight":t=`\n          *:focus,\n          *:focus-visible {\n            outline: ${e.thickness}px solid ${e.color} !important;\n            outline-offset: 2px !important;\n            background-color: rgba(255, 255, 0, 0.2) !important;\n            box-shadow: 0 0 0 ${e.thickness}px ${e.color}, 0 0 10px rgba(255, 255, 0, 0.5) !important;\n            border-radius: 3px !important;\n          }\n        `;break;case"glow":t=`\n          *:focus,\n          *:focus-visible {\n            outline: none !important;\n            box-shadow: 0 0 0 ${e.thickness}px ${e.color}, 0 0 20px ${e.color} !important;\n            border-radius: 3px !important;\n          }\n        `;break;case"thick":t=`\n          *:focus,\n          *:focus-visible {\n            outline: ${2*e.thickness}px solid ${e.color} !important;\n            outline-offset: 3px !important;\n            border-radius: 3px !important;\n          }\n        `;break;case"dotted":t=`\n          *:focus,\n          *:focus-visible {\n            outline: ${e.thickness}px dotted ${e.color} !important;\n            outline-offset: 2px !important;\n            border-radius: 3px !important;\n          }\n        `;break;default:t=`\n          *:focus,\n          *:focus-visible {\n            outline: ${e.thickness}px solid ${e.color} !important;\n            outline-offset: 2px !important;\n          }\n        `}t+=`\n      button:focus,\n      input:focus,\n      textarea:focus,\n      select:focus,\n      a:focus,\n      [role="button"]:focus,\n      [tabindex]:focus {\n        ${t.includes("outline: none")?"":"outline: "+e.thickness+"px solid "+e.color+" !important;"}\n        ${t.includes("outline: none")?"":"outline-offset: 2px !important;"}\n        border-radius: 3px !important;\n      }\n      \n      /* Focus enhancement for better visibility */\n      .accessify-focus-enhanced *:focus,\n      .accessify-focus-enhanced *:focus-visible {\n        transform: scale(1.02) !important;\n        transition: all 0.2s ease !important;\n        z-index: 9999 !important;\n      }\n    `,this._addStyle("focus-indicators",t)}_addStyle(e,t){this.currentStyles.set(e,t),this._updateStyleElement()}_removeStyle(e){this.currentStyles.delete(e),this._updateStyleElement()}_updateStyleElement(){if(!this.styleElement)return;const e=Array.from(this.currentStyles.values()).join("\n");this.styleElement.textContent=e}_storeOriginalStyles(){const e=document.documentElement,t=document.body;this.originalStyles.set("html-font-size",e.style.fontSize),this.originalStyles.set("body-font-size",t.style.fontSize),this.originalStyles.set("cursor",document.body.style.cursor)}_restoreOriginalStyles(){const e=document.documentElement,t=document.body;e.style.fontSize=this.originalStyles.get("html-font-size")||"",t.style.fontSize=this.originalStyles.get("body-font-size")||"",document.body.style.cursor=this.originalStyles.get("cursor")||""}async _applyInitialConfiguration(){const e=this.accessify.configManager.get("visual");e.textSize.enabled&&this._applyTextSize(e.textSize.current),e.contrast.enabled&&this._applyContrastMode(e.contrast.current),e.brightness.enabled&&this._applyBrightness(e.brightness.current),e.themes.enabled&&this._applyTheme(e.themes.current),e.cursors.enabled&&this._applyCursor(e.cursors.current),e.focusIndicators.enabled&&this._applyFocusIndicators(e.focusIndicators)}_setupEventListeners(){this.accessify.on("configUpdated",e=>{e.visual&&this._applyInitialConfiguration()}),document.addEventListener("keydown",e=>{if(e.altKey)switch(e.key){case"+":case"=":e.preventDefault(),this.increaseTextSize();break;case"-":e.preventDefault(),this.decreaseTextSize();break;case"c":e.preventDefault(),this.toggleContrastMode()}})}_removeEventListeners(){document.removeEventListener("keydown",this._handleKeydown)}getComplianceStatus(){const e=this.accessify.configManager.get("visual"),t=[];return e.textSize.enabled&&t.push("textSizeAdjustment"),e.contrast.enabled&&t.push("highContrast"),e.themes.enabled&&t.push("colorThemes"),e.cursors.enabled&&t.push("customCursors"),e.focusIndicators.enabled&&t.push("focusIndicators"),{wcag:{level:"AA",compliant:t.length>=3,score:Math.round(t.length/5*100)},israeliStandard:{compliant:t.includes("textSizeAdjustment")&&t.includes("highContrast"),score:Math.round(t.length/5*100)},features:t}}getCurrentSettings(){return{textSize:this.accessify.configManager.get("visual.textSize.current"),contrast:this.accessify.configManager.get("visual.contrast.current"),brightness:this.accessify.configManager.get("visual.brightness.current"),theme:this.accessify.configManager.get("visual.themes.current"),cursor:this.accessify.configManager.get("visual.cursors.current"),focusIndicators:this.accessify.configManager.get("visual.focusIndicators")}}reset(){this.resetTextSize(),this.setContrastMode("normal"),this.setBrightness(1),this.setTheme("default"),this.setCursor("default"),this.accessify.emit("visualSettingsReset")}_initializeAltTextGeneration(){try{this.accessify.configManager.get("visual.altTextGeneration",{enabled:!0}).enabled&&(this._generateAltTextForImages(),this._observeNewImages(),this.currentStyles.set("altTextGeneration",!0),this.accessify.emit("altTextGenerationEnabled"))}catch(e){this.accessify.errorHandler.handle(e,"Alt text generation initialization","component")}}_generateAltTextForImages(){document.querySelectorAll("img:not([alt])").forEach(e=>{this._generateAltTextForImage(e)})}_generateAltTextForImage(e){try{if(null!==e.getAttribute("alt"))return;let t="";const i=e.src||e.getAttribute("src");if(i){t=i.split("/").pop().split(".")[0].replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())}e.title&&(t=e.title),e.getAttribute("aria-label")&&(t=e.getAttribute("aria-label")),e.getAttribute("data-alt")&&(t=e.getAttribute("data-alt")),t||(t="Image"),e.setAttribute("alt",t),e.setAttribute("data-accessify-generated","true"),this.accessify.emit("altTextGenerated",{img:e,altText:t})}catch(e){this.accessify.errorHandler.handle(e,"Alt text generation for image","component")}}_observeNewImages(){"undefined"!=typeof MutationObserver&&(this.imageObserver=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){"IMG"===e.tagName&&this._generateAltTextForImage(e);const t=e.querySelectorAll&&e.querySelectorAll("img");t&&t.forEach(e=>this._generateAltTextForImage(e))}})})}),this.imageObserver.observe(document.body,{childList:!0,subtree:!0}))}validateColorContrast(e,t){try{const i=this._hexToRgb(e),n=this._hexToRgb(t);if(!i||!n)return{ratio:0,level:"fail",message:"Invalid color format"};const s=this._getRelativeLuminance(i),a=this._getRelativeLuminance(n),r=Math.max(s,a),o=(r+.05)/(Math.min(s,a)+.05);let c,l;return o>=7?(c="AAA",l="Excellent contrast (AAA)"):o>=4.5?(c="AA",l="Good contrast (AA)"):o>=3?(c="AA Large",l="Acceptable for large text (AA Large)"):(c="fail",l="Insufficient contrast"),{ratio:Math.round(100*o)/100,level:c,message:l}}catch(e){return this.accessify.errorHandler.handle(e,"Color contrast validation","component"),{ratio:0,level:"error",message:"Error calculating contrast"}}}_hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}_getRelativeLuminance(e){const{r:t,g:i,b:n}=e,s=t/255,a=i/255,r=n/255;return.2126*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.7152*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))}detectReducedMotion(){try{if(window.matchMedia){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}return!1}catch(e){return this.accessify.errorHandler.handle(e,"Reduced motion detection","component"),!1}}applyReducedMotion(){this.detectReducedMotion()&&(this.styleElement.textContent+="\n        *, *::before, *::after {\n          animation-duration: 0.01ms !important;\n          animation-iteration-count: 1 !important;\n          transition-duration: 0.01ms !important;\n        }\n      ",this.currentStyles.set("reducedMotion",!0),this.accessify.emit("reducedMotionApplied"))}stopAnimations(){this._addStyle("stop-animations",'\n      *, *::before, *::after {\n        animation-play-state: paused !important;\n        transition: none !important;\n        transform: none !important;\n      }\n      \n      /* Pause specific animation types */\n      .accessify-paused * {\n        animation-play-state: paused !important;\n      }\n      \n      /* Stop scrolling animations */\n      html {\n        scroll-behavior: auto !important;\n      }\n      \n      /* Stop video animations if any */\n      video, iframe {\n        animation-play-state: paused !important;\n      }\n      \n      /* Stop gif animations */\n      img[src$=".gif"] {\n        animation-play-state: paused !important;\n      }\n    '),this.accessify.emit("animationsStopped")}resumeAnimations(){this._removeStyle("stop-animations"),this.accessify.emit("animationsResumed")}toggleAnimations(){this.currentStyles.has("stop-animations")?this.resumeAnimations():this.stopAnimations()}}class o{constructor(e){this.accessify=e,this.isInitialized=!1,this.focusTrap=null,this.skipLinks=[],this.keyboardShortcuts=new Map,this.focusHistory=[],this.tabOrder=[]}async init(){try{if(this.isInitialized)return;this._setupKeyboardNavigation(),this._createSkipLinks(),this._setupFocusManagement(),this._setupKeyboardShortcuts(),this._setupTabOrder(),this.isInitialized=!0,this.accessify.emit("navigationAccessibilityInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Navigation accessibility initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this._removeEventListeners(),this._removeSkipLinks(),this._clearFocusTrap(),this.isInitialized=!1,this.accessify.emit("navigationAccessibilityDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Navigation accessibility destruction","component")}}_setupKeyboardNavigation(){document.addEventListener("keydown",this._handleKeydown.bind(this)),document.addEventListener("keyup",this._handleKeyup.bind(this)),document.addEventListener("focusin",this._handleFocusIn.bind(this)),document.addEventListener("focusout",this._handleFocusOut.bind(this))}_handleKeydown(e){if(!this.accessify.configManager.get("navigation.keyboard.shortcuts").enabled)return;const t=this._getShortcutKey(e);if(this.keyboardShortcuts.has(t))return e.preventDefault(),void this.keyboardShortcuts.get(t)();switch(e.key){case"Tab":this._handleTabNavigation(e);break;case"Escape":this._handleEscapeKey(e);break;case"Enter":case" ":this._handleActivationKey(e);break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":this._handleArrowKeys(e)}}_handleKeyup(e){}_handleFocusIn(e){this.focusHistory.push(e.target),this.focusHistory.length>10&&this.focusHistory.shift(),this.accessify.emit("focusIn",e.target)}_handleFocusOut(e){this.accessify.emit("focusOut",e.target)}_handleTabNavigation(e){const t=this.accessify.configManager.get("navigation.focus");t.enabled&&(this.focusTrap&&this._handleFocusTrap(e),"logical"===t.order&&this._optimizeTabOrder(e))}_handleEscapeKey(e){this._closeOpenElements(),this._returnFocus()}_handleActivationKey(e){const t=e.target;"BUTTON"!==t.tagName&&"button"!==t.getAttribute("role")&&("A"===t.tagName&&t.getAttribute("href")||"0"===t.getAttribute("tabindex")&&t.click())}_handleArrowKeys(e){const t=e.target;"menu"!==t.getAttribute("role")&&"menubar"!==t.getAttribute("role")&&"tablist"!==t.getAttribute("role")||this._handleArrowKeyNavigation(e)}_handleArrowKeyNavigation(e){const t=e.target,i=t.getAttribute("role"),n=t.querySelectorAll(`[role="${"tablist"===i?"tab":"menuitem"}"], button, a`),s=Array.from(n).indexOf(t);let a=s;switch(e.key){case"ArrowDown":case"ArrowRight":a=(s+1)%n.length;break;case"ArrowUp":case"ArrowLeft":a=0===s?n.length-1:s-1}a!==s&&(e.preventDefault(),n[a].focus())}_createSkipLinks(){if(!this.accessify.configManager.get("navigation.skipLinks").enabled)return;const e=document.createElement("div");e.className="accessify-skip-links",e.setAttribute("aria-label","Skip navigation links");const t=document.createElement("a");t.href="#main-content",t.textContent="Skip to main content",t.className="accessify-skip-link",t.addEventListener("click",this._handleSkipLink.bind(this));const i=document.createElement("a");i.href="#main-navigation",i.textContent="Skip to navigation",i.className="accessify-skip-link",i.addEventListener("click",this._handleSkipLink.bind(this)),e.appendChild(t),e.appendChild(i),document.body.insertBefore(e,document.body.firstChild),this.skipLinks.push(t,i),this._addSkipLinksCSS()}_handleSkipLink(e){e.preventDefault();const t=e.target.getAttribute("href").substring(1),i=document.getElementById(t);i&&(i.focus(),i.scrollIntoView({behavior:"smooth"}))}_addSkipLinksCSS(){const e=document.createElement("style");e.textContent="\n      .accessify-skip-links {\n        position: absolute;\n        top: -100px;\n        left: 0;\n        z-index: 10000;\n      }\n      \n      .accessify-skip-link {\n        position: absolute;\n        top: 0;\n        left: 0;\n        background: #000;\n        color: #fff;\n        padding: 8px 16px;\n        text-decoration: none;\n        border-radius: 0 0 4px 0;\n        font-weight: bold;\n        transition: top 0.3s ease;\n      }\n      \n      .accessify-skip-link:focus {\n        top: 0;\n        outline: 2px solid #fff;\n        outline-offset: 2px;\n      }\n    ",document.head.appendChild(e)}_removeSkipLinks(){this.skipLinks.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.skipLinks=[]}_setupFocusManagement(){this.accessify.configManager.get("navigation.focus").enabled&&(this._setupFocusTrap(),this._setupFocusRestoration())}_setupFocusTrap(){}_handleFocusTrap(e){if(!this.focusTrap)return;const t=this.focusTrap.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const i=t[0],n=t[t.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),i.focus())}setFocusTrap(e){this.focusTrap=e,this.accessify.emit("focusTrapSet",e)}_clearFocusTrap(){this.focusTrap=null,this.accessify.emit("focusTrapCleared")}_setupFocusRestoration(){window.addEventListener("beforeunload",()=>{document.activeElement&&sessionStorage.setItem("accessify-last-focus",document.activeElement.id||"")}),window.addEventListener("load",()=>{const e=sessionStorage.getItem("accessify-last-focus");if(e){const t=document.getElementById(e);t&&t.focus()}})}_setupKeyboardShortcuts(){const e=this.accessify.configManager.get("navigation.keyboard.shortcuts");e.enabled&&(this.registerShortcut(e.skipToContent,()=>{this._skipToContent()}),this.registerShortcut(e.toggleMenu,()=>{this._toggleMenu()}),this.registerShortcut(e.increaseTextSize,()=>{this.accessify.visual.increaseTextSize()}),this.registerShortcut(e.decreaseTextSize,()=>{this.accessify.visual.decreaseTextSize()}),this.registerShortcut(e.toggleContrast,()=>{this.accessify.visual.toggleContrastMode()}),this.registerShortcut(e.toggleHighContrast,()=>{this.accessify.visual.setContrastMode("high")}),this.registerShortcut("Alt+r",()=>{this.accessify.readingGuide&&this.accessify.readingGuide.toggleReadingRuler()}),this.registerShortcut("Alt+h",()=>{this.accessify.readingGuide&&this.accessify.readingGuide.toggleTextHighlighting()}),this.registerShortcut("Alt+a",()=>{this.accessify.visual&&this.accessify.visual.toggleAnimations()}),this.registerShortcut("Alt+l",()=>{this._toggleLinkUnderlining()}),this.registerShortcut("Alt+f",()=>{this._cycleFocusStyles()}),this.registerShortcut("Alt+c",()=>{this._cycleCursorStyles()}),this.registerShortcut("Alt+s",()=>{this._toggleScreenReaderAnnouncements()}),this.registerShortcut("Alt+t",()=>{this._toggleTabOrder()}),this.registerShortcut("Alt+g",()=>{this._toggleGridOverlay()}))}registerShortcut(e,t){this.keyboardShortcuts.set(e,t)}unregisterShortcut(e){this.keyboardShortcuts.delete(e)}_getShortcutKey(e){const t=[];return e.ctrlKey&&t.push("Ctrl"),e.altKey&&t.push("Alt"),e.shiftKey&&t.push("Shift"),e.metaKey&&t.push("Meta"),t.push(e.key),t.join("+")}_setupTabOrder(){"logical"===this.accessify.configManager.get("navigation.focus").order&&this._optimizeTabOrder()}_optimizeTabOrder(e){}_skipToContent(){const e=document.querySelector('main, #main-content, [role="main"]');e&&(e.focus(),e.scrollIntoView({behavior:"smooth"}))}_toggleMenu(){const e=document.querySelector('[role="menu"], .menu, #menu');if(e){const t="true"===e.getAttribute("aria-expanded");if(e.setAttribute("aria-expanded",!t),!t){const t=e.querySelector('button, a, [tabindex="0"]');t&&t.focus()}}}_closeOpenElements(){document.querySelectorAll('[aria-expanded="true"]').forEach(e=>{e.setAttribute("aria-expanded","false")})}_returnFocus(){if(this.focusHistory.length>0){const e=this.focusHistory.pop();e&&e.focus&&e.focus()}}_removeEventListeners(){document.removeEventListener("keydown",this._handleKeydown),document.removeEventListener("keyup",this._handleKeyup),document.removeEventListener("focusin",this._handleFocusIn),document.removeEventListener("focusout",this._handleFocusOut)}getComplianceStatus(){const e=this.accessify.configManager.get("navigation"),t=[];return e.keyboard.enabled&&t.push("keyboardNavigation"),e.focus.enabled&&t.push("focusManagement"),e.skipLinks.enabled&&t.push("skipLinks"),{wcag:{level:"AA",compliant:t.length>=2,score:Math.round(t.length/3*100)},israeliStandard:{compliant:t.includes("keyboardNavigation"),score:Math.round(t.length/3*100)},features:t}}getCurrentSettings(){return{keyboard:this.accessify.configManager.get("navigation.keyboard"),focus:this.accessify.configManager.get("navigation.focus"),skipLinks:this.accessify.configManager.get("navigation.skipLinks")}}_toggleLinkUnderlining(){if(this.accessify.visual){const e=this.accessify.configManager.get("visual.linkUnderlining.style"),t=["none","always","hover","enhanced","double"],i=(t.indexOf(e)+1)%t.length;this.accessify.visual.setLinkUnderlining(t[i])}}_cycleFocusStyles(){if(this.accessify.visual){const e=this.accessify.configManager.get("visual.focusIndicators.style"),t=["standard","highlight","glow","thick","dotted"],i=(t.indexOf(e)+1)%t.length;this.accessify.visual.setFocusIndicator(t[i])}}_cycleCursorStyles(){if(this.accessify.visual){const e=this.accessify.configManager.get("visual.cursors.current"),t=["default","large","extra-large","high-contrast","crosshair","pointer-large","text-large"],i=(t.indexOf(e)+1)%t.length;this.accessify.visual.setCursor(t[i])}}_toggleScreenReaderAnnouncements(){if(this.accessify.screenReader){const e=this.accessify.configManager.get("screenReader.announcements.enabled");this.accessify.configManager.set("screenReader.announcements.enabled",!e),this.accessify.screenReader.announce("Screen reader announcements "+(e?"disabled":"enabled"),"polite","normal")}}_toggleTabOrder(){const e=this.accessify.configManager.get("navigation.focus.visualizeTabOrder");this.accessify.configManager.set("navigation.focus.visualizeTabOrder",!e),e?this._hideTabOrder():this._showTabOrder()}_showTabOrder(){document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').forEach((e,t)=>{if(!e.querySelector(".accessify-tab-order-indicator")){const i=document.createElement("div");i.className="accessify-tab-order-indicator",i.textContent=t+1,i.style.cssText="\n          position: absolute;\n          top: -5px;\n          left: -5px;\n          background: #ff0000;\n          color: white;\n          border-radius: 50%;\n          width: 20px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 12px;\n          font-weight: bold;\n          z-index: 10000;\n          pointer-events: none;\n        ",e.style.position="relative",e.appendChild(i)}}),this.accessify.emit("tabOrderShown")}_hideTabOrder(){document.querySelectorAll(".accessify-tab-order-indicator").forEach(e=>{e.remove()}),this.accessify.emit("tabOrderHidden")}_toggleGridOverlay(){const e=this.accessify.configManager.get("navigation.gridOverlay.enabled");this.accessify.configManager.set("navigation.gridOverlay.enabled",!e),e?this._hideGridOverlay():this._showGridOverlay()}_showGridOverlay(){if(!document.getElementById("accessify-grid-overlay")){const e=document.createElement("div");e.id="accessify-grid-overlay",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 9999;\n        background-image: \n          linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px),\n          linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px);\n        background-size: 20px 20px;\n        opacity: 0.5;\n      ",document.body.appendChild(e)}this.accessify.emit("gridOverlayShown")}_hideGridOverlay(){const e=document.getElementById("accessify-grid-overlay");e&&e.remove(),this.accessify.emit("gridOverlayHidden")}}class c{constructor(e){this.accessify=e,this.isInitialized=!1,this.speechSynthesis=null,this.currentUtterance=null,this.readingGuide=null,this.textHighlighter=null,this.fontLoader=null}async init(){try{if(this.isInitialized)return;this._initializeSpeechSynthesis(),this._setupFontLoading(),this._setupTextSpacing(),this._setupReadingGuides(),this._setupTextHighlighting(),this.isInitialized=!0,this.accessify.emit("readingAccessibilityInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Reading accessibility initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this._stopSpeech(),this._removeReadingGuides(),this._removeTextHighlighting(),this._removeCustomFonts(),this.isInitialized=!1,this.accessify.emit("readingAccessibilityDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Reading accessibility destruction","component")}}_initializeSpeechSynthesis(){"speechSynthesis"in window?(this.speechSynthesis=window.speechSynthesis,this.speechSynthesis.addEventListener("voiceschanged",()=>{this.accessify.emit("voicesChanged",this.getAvailableVoices())})):console.warn("Speech synthesis not supported in this browser")}speak(e,t={}){if(!this.speechSynthesis)throw new Error("Speech synthesis not available");this._stopSpeech();const i=new SpeechSynthesisUtterance(e),n=this.accessify.configManager.get("reading.textToSpeech");if(i.rate=t.rate||n.rate,i.pitch=t.pitch||n.pitch,i.volume=t.volume||n.volume,t.voice||"auto"!==n.voice){const e=this._getVoice(t.voice||n.voice);e&&(i.voice=e)}i.onstart=()=>{this.accessify.emit("speechStarted",i)},i.onend=()=>{this.accessify.emit("speechEnded",i),this.currentUtterance=null},i.onerror=e=>{this.accessify.emit("speechError",e),this.currentUtterance=null},this.currentUtterance=i,this.speechSynthesis.speak(i)}_stopSpeech(){this.speechSynthesis&&this.speechSynthesis.speaking&&this.speechSynthesis.cancel(),this.currentUtterance=null}pauseSpeech(){this.speechSynthesis&&this.speechSynthesis.speaking&&this.speechSynthesis.pause()}resumeSpeech(){this.speechSynthesis&&this.speechSynthesis.paused&&this.speechSynthesis.resume()}getAvailableVoices(){return this.speechSynthesis?this.speechSynthesis.getVoices().map(e=>({name:e.name,lang:e.lang,default:e.default,localService:e.localService})):[]}_getVoice(e){if(!this.speechSynthesis)return null;const t=this.speechSynthesis.getVoices();let i=t.find(t=>t.name===e);return i||(i=t.find(t=>t.lang.startsWith(e))),i||(i=t.find(e=>e.default)),i}_setupFontLoading(){const e=this.accessify.configManager.get("reading.fonts");e.enabled&&(e.dyslexia&&this._loadDyslexiaFonts(),this._applyFont(e.current))}_loadDyslexiaFonts(){[{name:"Lexend",url:"https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap"},{name:"Atkinson Hyperlegible",url:"https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap"}].forEach(e=>{if(document.querySelector(`link[href="${e.url}"]`))return void this.accessify.emit("fontLoaded",e.name);const t=document.createElement("link");t.rel="stylesheet",t.href=e.url,t.onload=()=>{this.accessify.emit("fontLoaded",e.name)},t.onerror=()=>{console.warn(`Failed to load ${e.name} from ${e.url}. Font will fall back to system fonts.`),this.accessify.emit("fontLoadFailed",e.name)},document.head.appendChild(t)})}_applyFont(e){if(!this.accessify.configManager.get("reading.fonts").enabled)return;let t="";switch(e){case"opendyslexic":t="OpenDyslexic, sans-serif";break;case"lexend":t="Lexend, sans-serif";break;case"atkinson":t="Atkinson Hyperlegible, sans-serif";break;default:t="inherit"}const i=`\n      * {\n        font-family: ${t} !important;\n      }\n    `;this._addStyle("dyslexia-font",i)}setFont(e){if(!this.accessify.configManager.get("reading.fonts.available").includes(e))throw new Error(`Invalid font: ${e}`);this.accessify.configManager.set("reading.fonts.current",e),this._applyFont(e),this.accessify.emit("fontChanged",e)}_setupTextSpacing(){const e=this.accessify.configManager.get("reading.spacing");e.enabled&&this._applyTextSpacing(e)}_applyTextSpacing(e){const t=`\n      * {\n        line-height: ${e.lineHeight} !important;\n        letter-spacing: ${e.letterSpacing} !important;\n        word-spacing: ${e.wordSpacing} !important;\n      }\n    `;this._addStyle("text-spacing",t)}setLineHeight(e){const t=this.accessify.configManager.get("reading.spacing");this.accessify.configManager.set("reading.spacing.lineHeight",e),this._applyTextSpacing({...t,lineHeight:e}),this.accessify.emit("lineHeightChanged",e)}setLetterSpacing(e){const t=this.accessify.configManager.get("reading.spacing");this.accessify.configManager.set("reading.spacing.letterSpacing",e),this._applyTextSpacing({...t,letterSpacing:e}),this.accessify.emit("letterSpacingChanged",e)}setWordSpacing(e){const t=this.accessify.configManager.get("reading.spacing");this.accessify.configManager.set("reading.spacing.wordSpacing",e),this._applyTextSpacing({...t,wordSpacing:e}),this.accessify.emit("wordSpacingChanged",e)}_setupReadingGuides(){const e=this.accessify.configManager.get("reading.guides");e.enabled&&(e.readingRuler&&this._createReadingRuler(),e.textHighlighting&&this._setupTextHighlighting())}_createReadingRuler(){this.readingGuide=document.createElement("div"),this.readingGuide.className="accessify-reading-ruler",this.readingGuide.setAttribute("aria-hidden","true"),this._addReadingRulerCSS(),document.body.appendChild(this.readingGuide),document.addEventListener("mousemove",this._handleReadingRulerMouseMove.bind(this))}_handleReadingRulerMouseMove(e){this.readingGuide&&(this.readingGuide.style.top=e.clientY-10+"px",this.readingGuide.style.left="0",this.readingGuide.style.width="100%")}_addReadingRulerCSS(){const e=document.createElement("style");e.textContent="\n      .accessify-reading-ruler {\n        position: fixed;\n        height: 2px;\n        background: #ff0000;\n        opacity: 0.7;\n        pointer-events: none;\n        z-index: 10000;\n        transition: top 0.1s ease;\n      }\n    ",document.head.appendChild(e)}_setupTextHighlighting(){this.textHighlighter=document.createElement("div"),this.textHighlighter.className="accessify-text-highlighter",this.textHighlighter.setAttribute("aria-hidden","true"),this._addTextHighlighterCSS(),document.body.appendChild(this.textHighlighter),document.addEventListener("mouseup",this._handleTextSelection.bind(this))}_handleTextSelection(e){if(!this.textHighlighter)return;const t=window.getSelection();if(t.toString().trim()){const e=t.getRangeAt(0).getBoundingClientRect();this.textHighlighter.style.top=`${e.top}px`,this.textHighlighter.style.left=`${e.left}px`,this.textHighlighter.style.width=`${e.width}px`,this.textHighlighter.style.height=`${e.height}px`}}_addTextHighlighterCSS(){const e=document.createElement("style");e.textContent="\n      .accessify-text-highlighter {\n        position: fixed;\n        background: rgba(255, 255, 0, 0.3);\n        pointer-events: none;\n        z-index: 9999;\n        transition: all 0.1s ease;\n      }\n    ",document.head.appendChild(e)}_removeReadingGuides(){this.readingGuide&&this.readingGuide.parentNode&&(this.readingGuide.parentNode.removeChild(this.readingGuide),this.readingGuide=null),this.textHighlighter&&this.textHighlighter.parentNode&&(this.textHighlighter.parentNode.removeChild(this.textHighlighter),this.textHighlighter=null)}_removeTextHighlighting(){window.getSelection().removeAllRanges()}_removeCustomFonts(){this._removeStyle("dyslexia-font")}_addStyle(e,t){this.styleElement||(this.styleElement=document.createElement("style"),this.styleElement.id="accessify-reading-styles",document.head.appendChild(this.styleElement)),this.currentStyles=this.currentStyles||new Map,this.currentStyles.set(e,t),this._updateStyleElement()}_removeStyle(e){this.currentStyles&&(this.currentStyles.delete(e),this._updateStyleElement())}_updateStyleElement(){if(!this.styleElement||!this.currentStyles)return;const e=Array.from(this.currentStyles.values()).join("\n");this.styleElement.textContent=e}getComplianceStatus(){const e=this.accessify.configManager.get("reading"),t=[];return e.textToSpeech.enabled&&t.push("textToSpeech"),e.fonts.enabled&&t.push("dyslexiaFonts"),e.spacing.enabled&&t.push("textSpacing"),e.guides.enabled&&t.push("readingGuides"),{wcag:{level:"AA",compliant:t.length>=2,score:Math.round(t.length/4*100)},israeliStandard:{compliant:t.includes("textToSpeech")||t.includes("dyslexiaFonts"),score:Math.round(t.length/4*100)},features:t}}getCurrentSettings(){return{textToSpeech:this.accessify.configManager.get("reading.textToSpeech"),fonts:this.accessify.configManager.get("reading.fonts"),spacing:this.accessify.configManager.get("reading.spacing"),guides:this.accessify.configManager.get("reading.guides")}}reset(){this._stopSpeech(),this.setFont("default"),this.setLineHeight(1.5),this.setLetterSpacing("normal"),this.setWordSpacing("normal"),this.accessify.emit("readingSettingsReset")}}class l{constructor(e){this.accessify=e,this.isInitialized=!1,this.voiceRecognition=null,this.gestureRecognizer=null,this.motionSensor=null,this.targetEnlarger=null,this.interactionDelays=new Map}async init(){try{if(this.isInitialized)return;this._setupLargeTargets(),this._setupGestureAlternatives(),this._setupVoiceCommands(),this._setupMotionControl(),this._setupInteractionDelays(),this.isInitialized=!0,this.accessify.emit("motorAccessibilityInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Motor accessibility initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this._stopVoiceRecognition(),this._removeGestureRecognition(),this._removeMotionSensor(),this._removeLargeTargets(),this.isInitialized=!1,this.accessify.emit("motorAccessibilityDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Motor accessibility destruction","component")}}_setupLargeTargets(){const e=this.accessify.configManager.get("motor.targets");e.enabled&&(this.targetEnlarger=document.createElement("div"),this.targetEnlarger.className="accessify-target-enlarger",this.targetEnlarger.setAttribute("aria-hidden","true"),this._addTargetEnlargerCSS(e),document.body.appendChild(this.targetEnlarger),document.addEventListener("mouseover",this._handleTargetHover.bind(this)),document.addEventListener("mouseout",this._handleTargetOut.bind(this)))}_handleTargetHover(e){if(!this.targetEnlarger)return;const t=e.target;if(this._isInteractiveElement(t)){const e=t.getBoundingClientRect(),i=this.accessify.configManager.get("motor.targets.minSize"),n=this.accessify.configManager.get("motor.targets.padding"),s=Math.max(e.width,i)+2*n,a=Math.max(e.height,i)+2*n;this.targetEnlarger.style.top=e.top-n+"px",this.targetEnlarger.style.left=e.left-n+"px",this.targetEnlarger.style.width=`${s}px`,this.targetEnlarger.style.height=`${a}px`,this.targetEnlarger.style.display="block"}}_handleTargetOut(e){this.targetEnlarger&&(this.targetEnlarger.style.display="none")}_isInteractiveElement(e){return["button","a","input","select","textarea"].includes(e.tagName.toLowerCase())||["button","link","textbox","combobox","checkbox","radio"].includes(e.getAttribute("role"))||"0"===e.getAttribute("tabindex")}_addTargetEnlargerCSS(e){const t=document.createElement("style");t.textContent="\n      .accessify-target-enlarger {\n        position: fixed;\n        border: 2px solid #0066cc;\n        background: rgba(0, 102, 204, 0.1);\n        pointer-events: none;\n        z-index: 10000;\n        display: none;\n        transition: all 0.2s ease;\n        border-radius: 4px;\n      }\n      \n      .accessify-target-enlarger::before {\n        content: '';\n        position: absolute;\n        top: -2px;\n        left: -2px;\n        right: -2px;\n        bottom: -2px;\n        border: 1px solid rgba(0, 102, 204, 0.3);\n        border-radius: 6px;\n        pointer-events: none;\n      }\n    ",document.head.appendChild(t)}_removeLargeTargets(){this.targetEnlarger&&this.targetEnlarger.parentNode&&(this.targetEnlarger.parentNode.removeChild(this.targetEnlarger),this.targetEnlarger=null)}_setupGestureAlternatives(){this.accessify.configManager.get("motor.gestures").enabled&&(this._setupTouchEvents(),this._setupPointerEvents(),this._setupGestureRecognition())}_setupTouchEvents(){document.addEventListener("touchstart",this._handleTouchStart.bind(this)),document.addEventListener("touchend",this._handleTouchEnd.bind(this)),document.addEventListener("touchmove",this._handleTouchMove.bind(this))}_handleTouchStart(e){this.touchStart={x:e.touches[0].clientX,y:e.touches[0].clientY,time:Date.now()}}_handleTouchEnd(e){if(!this.touchStart)return;const t={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY,time:Date.now()},i=this._calculateGesture(this.touchStart,t);i&&this._handleGesture(i),this.touchStart=null}_handleTouchMove(e){}_setupPointerEvents(){document.addEventListener("pointerdown",this._handlePointerDown.bind(this)),document.addEventListener("pointerup",this._handlePointerUp.bind(this)),document.addEventListener("pointermove",this._handlePointerMove.bind(this))}_handlePointerDown(e){this.pointerStart={x:e.clientX,y:e.clientY,time:Date.now()}}_handlePointerUp(e){if(!this.pointerStart)return;const t={x:e.clientX,y:e.clientY,time:Date.now()},i=this._calculateGesture(this.pointerStart,t);i&&this._handleGesture(i),this.pointerStart=null}_handlePointerMove(e){}_setupGestureRecognition(){}_calculateGesture(e,t){const i=t.x-e.x,n=t.y-e.y,s=t.time-e.time;if(Math.abs(i)>Math.abs(n)){if(i>50&&s<500)return{type:"swipe",direction:"right"};if(i<-50&&s<500)return{type:"swipe",direction:"left"}}else{if(n>50&&s<500)return{type:"swipe",direction:"down"};if(n<-50&&s<500)return{type:"swipe",direction:"up"}}return Math.abs(i)<10&&Math.abs(n)<10&&s<300?{type:"tap"}:null}_handleGesture(e){switch(this.accessify.emit("gestureDetected",e),e.type){case"swipe":this._handleSwipeGesture(e);break;case"tap":this._handleTapGesture(e)}}_handleSwipeGesture(e){switch(e.direction){case"left":window.history.length>1&&window.history.back();break;case"right":window.history.length>1&&window.history.forward();break;case"up":window.scrollBy(0,-100);break;case"down":window.scrollBy(0,100)}}_handleTapGesture(e){}_removeGestureRecognition(){document.removeEventListener("touchstart",this._handleTouchStart),document.removeEventListener("touchend",this._handleTouchEnd),document.removeEventListener("touchmove",this._handleTouchMove),document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("pointerup",this._handlePointerUp),document.removeEventListener("pointermove",this._handlePointerMove)}_setupVoiceCommands(){if(!this.accessify.configManager.get("motor.voice").enabled)return;if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return void console.warn("Speech recognition not supported in this browser");const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.voiceRecognition=new e,this.voiceRecognition.continuous=!0,this.voiceRecognition.interimResults=!1,this.voiceRecognition.lang=this.accessify.configManager.get("language","en-US"),this.voiceRecognition.onstart=()=>{this.accessify.emit("voiceRecognitionStarted")},this.voiceRecognition.onresult=e=>{const t=e.results[e.results.length-1];t.isFinal&&this._handleVoiceCommand(t[0].transcript)},this.voiceRecognition.onerror=e=>{this.accessify.emit("voiceRecognitionError",e)},this.voiceRecognition.onend=()=>{this.accessify.emit("voiceRecognitionEnded")}}_handleVoiceCommand(e){const t=e.toLowerCase().trim();if(this.accessify.emit("voiceCommand",t),t.includes("scroll up"))window.scrollBy(0,-100);else if(t.includes("scroll down"))window.scrollBy(0,100);else if(t.includes("go back"))window.history.length>1&&window.history.back();else if(t.includes("go forward"))window.history.length>1&&window.history.forward();else if(t.includes("increase text size"))this.accessify.visual.increaseTextSize();else if(t.includes("decrease text size"))this.accessify.visual.decreaseTextSize();else if(t.includes("toggle contrast"))this.accessify.visual.toggleContrastMode();else if(t.includes("speak")){const e=document.body.textContent;this.accessify.reading.speak(e)}}startVoiceRecognition(){this.voiceRecognition&&this.voiceRecognition.start()}_stopVoiceRecognition(){this.voiceRecognition&&this.voiceRecognition.stop()}_setupMotionControl(){const e=this.accessify.configManager.get("motor.motion");e.enabled&&(e.reduced&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&this._applyReducedMotion(),this._setupMotionSensor())}_applyReducedMotion(){this._addStyle("reduced-motion","\n      * {\n        animation-duration: 0.01ms !important;\n        animation-iteration-count: 1 !important;\n        transition-duration: 0.01ms !important;\n      }\n    ")}_setupMotionSensor(){}_removeMotionSensor(){}_setupInteractionDelays(){const e=this.accessify.configManager.get("motor.delays");e.enabled&&(e.hover>0&&this._setupHoverDelays(e.hover),e.interaction>0&&this._setupInteractionDelays(e.interaction))}_setupHoverDelays(e){}_setupInteractionDelays(e){}_addStyle(e,t){this.styleElement||(this.styleElement=document.createElement("style"),this.styleElement.id="accessify-motor-styles",document.head.appendChild(this.styleElement)),this.currentStyles=this.currentStyles||new Map,this.currentStyles.set(e,t),this._updateStyleElement()}_updateStyleElement(){if(!this.styleElement||!this.currentStyles)return;const e=Array.from(this.currentStyles.values()).join("\n");this.styleElement.textContent=e}getComplianceStatus(){const e=this.accessify.configManager.get("motor"),t=[];return e.targets.enabled&&t.push("largeTargets"),e.gestures.enabled&&t.push("gestureAlternatives"),e.voice.enabled&&t.push("voiceCommands"),e.motion.enabled&&t.push("motionControl"),{wcag:{level:"AA",compliant:t.length>=2,score:Math.round(t.length/4*100)},israeliStandard:{compliant:t.includes("largeTargets")||t.includes("voiceCommands"),score:Math.round(t.length/4*100)},features:t}}getCurrentSettings(){return{targets:this.accessify.configManager.get("motor.targets"),gestures:this.accessify.configManager.get("motor.gestures"),voice:this.accessify.configManager.get("motor.voice"),motion:this.accessify.configManager.get("motor.motion"),delays:this.accessify.configManager.get("motor.delays")}}reset(){this._stopVoiceRecognition(),this._removeLargeTargets(),this._removeGestureRecognition(),this._removeMotionSensor(),this.accessify.emit("motorSettingsReset")}}class h{constructor(e){this.accessify=e,this.isInitialized=!1,this.currentLanguage="en",this.currentDirection="ltr",this.rtlLanguages=["ar","he","fa","ur","yi"],this.translations=new Map,this.directionObserver=null}async init(){try{if(this.isInitialized)return;this._detectLanguageAndDirection(),this._setupRTLSupport(),this._setupLanguageSwitching(),this._setupDirectionSwitching(),await this._loadTranslations(),this._initializeRTLVoiceRecognition(),this.isInitialized=!0,this.accessify.emit("multilingualSupportInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Multilingual support initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this.directionObserver&&this.directionObserver.disconnect(),this._removeRTLStyles(),this.isInitialized=!1,this.accessify.emit("multilingualSupportDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Multilingual support destruction","component")}}_detectLanguageAndDirection(){if(this.accessify.configManager.get("multilingual").autoDetect){const e=document.documentElement.lang||"en";this.currentLanguage=e.split("-")[0];const t=document.documentElement.dir||"ltr";this.currentDirection=t}else this.currentLanguage=this.accessify.configManager.get("language","en"),this.currentDirection=this.accessify.configManager.get("direction","ltr");this.accessify.configManager.set("language",this.currentLanguage),this.accessify.configManager.set("direction",this.currentDirection)}_setupRTLSupport(){this.accessify.configManager.get("multilingual.rtl").enabled&&(this._applyRTLStyles(),this._setupDirectionObserver(),this._setupRTLFeatures())}_applyRTLStyles(){if("rtl"===this.currentDirection){const e="\n        html {\n          direction: rtl !important;\n        }\n        \n        body {\n          direction: rtl !important;\n        }\n        \n        * {\n          direction: inherit !important;\n        }\n        \n        /* RTL-specific adjustments */\n        .accessify-skip-links {\n          right: 0 !important;\n          left: auto !important;\n        }\n        \n        .accessify-skip-link {\n          border-radius: 0 0 0 4px !important;\n        }\n        \n        .accessify-reading-ruler {\n          right: 0 !important;\n          left: auto !important;\n        }\n        \n        .accessify-target-enlarger {\n          right: 0 !important;\n          left: auto !important;\n        }\n      ";this._addStyle("rtl-support",e)}}_removeRTLStyles(){this._removeStyle("rtl-support")}_setupDirectionObserver(){this.directionObserver=new MutationObserver(e=>{e.forEach(e=>{if("attributes"===e.type&&"dir"===e.attributeName){const e=document.documentElement.dir||"ltr";e!==this.currentDirection&&this.setDirection(e)}})}),this.directionObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["dir"]})}_setupRTLFeatures(){"rtl"===this.currentDirection&&(this._adjustKeyboardNavigationForRTL(),this._adjustGestureRecognitionForRTL(),this._adjustTextSelectionForRTL())}_adjustKeyboardNavigationForRTL(){document.addEventListener("keydown",e=>{if("rtl"===this.currentDirection)switch(e.key){case"ArrowLeft":e.preventDefault(),this._moveFocus("right");break;case"ArrowRight":e.preventDefault(),this._moveFocus("left")}})}_moveFocus(e){const t=document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),i=Array.from(t).indexOf(document.activeElement);if(-1===i)return;let n;n="left"===e?0===i?t.length-1:i-1:i===t.length-1?0:i+1,t[n].focus()}_adjustGestureRecognitionForRTL(){this.accessify.on("gestureDetected",e=>{"rtl"===this.currentDirection&&"swipe"===e.type&&("left"===e.direction?e.direction="right":"right"===e.direction&&(e.direction="left"))})}_adjustTextSelectionForRTL(){document.addEventListener("mouseup",e=>{if("rtl"===this.currentDirection){window.getSelection().toString().trim()&&this._adjustSelectionHighlighting()}})}_adjustSelectionHighlighting(){}_setupLanguageSwitching(){this.accessify.on("languageChanged",e=>{this.setLanguage(e)})}_setupDirectionSwitching(){this.accessify.on("directionChanged",e=>{this.setDirection(e)})}setLanguage(e){this.currentLanguage!==e&&(this.currentLanguage=e,this.accessify.configManager.set("language",e),document.documentElement.lang=e,this.accessify.reading&&this.accessify.reading.speechSynthesis&&(this.accessify.reading.speechSynthesis.lang=e),this.accessify.motor&&this.accessify.motor.voiceRecognition&&(this.accessify.motor.voiceRecognition.lang=e),this.accessify.emit("languageChanged",e))}setDirection(e){this.currentDirection!==e&&(this.currentDirection=e,this.accessify.configManager.set("direction",e),document.documentElement.dir=e,"rtl"===e?(this._applyRTLStyles(),this._setupRTLFeatures()):this._removeRTLStyles(),this.accessify.emit("directionChanged",e))}async _loadTranslations(){const e=["en","he","ar","es","fr","de"];for(const t of e)try{const e=await this._loadLanguageTranslations(t);this.translations.set(t,e)}catch(e){console.warn(`Failed to load translations for ${t}:`,e)}}async _loadLanguageTranslations(e){const t={en:{skipToContent:"Skip to main content",skipToNavigation:"Skip to navigation",increaseTextSize:"Increase text size",decreaseTextSize:"Decrease text size",toggleContrast:"Toggle contrast",toggleHighContrast:"Toggle high contrast",speak:"Speak text",stop:"Stop",pause:"Pause",resume:"Resume"},he:{skipToContent:"×“×œ×’ ×œ×ª×•×›×Ÿ ×”×¨××©×™",skipToNavigation:"×“×œ×’ ×œ× ×™×•×•×˜",increaseTextSize:"×”×’×“×œ ×’×•×“×œ ×˜×§×¡×˜",decreaseTextSize:"×”×§×˜×Ÿ ×’×•×“×œ ×˜×§×¡×˜",toggleContrast:"×”×—×œ×£ × ×™×’×•×“×™×•×ª",toggleHighContrast:"×”×—×œ×£ × ×™×’×•×“×™×•×ª ×’×‘×•×”×”",speak:"×”×§×¨× ×˜×§×¡×˜",stop:"×¢×¦×•×¨",pause:"×”×©×”×”",resume:"×”×ž×©×š"},ar:{skipToContent:"Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",skipToNavigation:"Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ†Ù‚Ù„",increaseTextSize:"Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ù†Øµ",decreaseTextSize:"ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù†Øµ",toggleContrast:"ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨Ø§ÙŠÙ†",toggleHighContrast:"ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨Ø§ÙŠÙ† Ø§Ù„Ø¹Ø§Ù„ÙŠ",speak:"Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ",stop:"ØªÙˆÙ‚Ù",pause:"Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª",resume:"Ø§Ø³ØªØ¦Ù†Ø§Ù"}};return t[e]||t.en}getTranslation(e,t=null){const i=t||this.currentLanguage,n=this.translations.get(i);if(n&&n[e])return n[e];const s=this.translations.get("en");return s&&s[e]?s[e]:e}isRTLLanguage(e=null){const t=e||this.currentLanguage;return this.rtlLanguages.includes(t)}getCurrentLanguage(){return this.currentLanguage}getCurrentDirection(){return this.currentDirection}getSupportedLanguages(){return Array.from(this.translations.keys())}_addStyle(e,t){this.styleElement||(this.styleElement=document.createElement("style"),this.styleElement.id="accessify-multilingual-styles",document.head.appendChild(this.styleElement)),this.currentStyles=this.currentStyles||new Map,this.currentStyles.set(e,t),this._updateStyleElement()}_removeStyle(e){this.currentStyles&&(this.currentStyles.delete(e),this._updateStyleElement())}_updateStyleElement(){if(!this.styleElement||!this.currentStyles)return;const e=Array.from(this.currentStyles.values()).join("\n");this.styleElement.textContent=e}getComplianceStatus(){const e=this.accessify.configManager.get("multilingual"),t=[];return e.enabled&&t.push("multilingual"),e.rtl.enabled&&t.push("rtlSupport"),{wcag:{level:"AA",compliant:t.length>=1,score:Math.round(t.length/2*100)},israeliStandard:{compliant:t.includes("rtlSupport")&&this.isRTLLanguage(),score:Math.round(t.length/2*100)},features:t}}getCurrentSettings(){return{language:this.currentLanguage,direction:this.currentDirection,isRTL:this.isRTLLanguage(),supportedLanguages:this.getSupportedLanguages(),translations:this.translations}}reset(){this.setLanguage("en"),this.setDirection("ltr"),this.accessify.emit("multilingualSettingsReset")}_initializeRTLVoiceRecognition(){try{this.hebrewCommands={"×’×“×œ ×˜×§×¡×˜":()=>this.accessify.visual?.increaseTextSize(),"×”×§×˜×Ÿ ×˜×§×¡×˜":()=>this.accessify.visual?.decreaseTextSize(),"× ×™×’×•×“×™×•×ª ×’×‘×•×”×”":()=>this.accessify.visual?.setContrastMode("high"),"× ×™×’×•×“×™×•×ª ×¨×’×™×œ×”":()=>this.accessify.visual?.setContrastMode("normal"),"×¢×¨×›×ª × ×•×©× ×›×”×”":()=>this.accessify.visual?.setTheme("dark"),"×¢×¨×›×ª × ×•×©× ×‘×”×™×¨×”":()=>this.accessify.visual?.setTheme("light"),"×§×¨× ×˜×§×¡×˜":()=>this._speakSelectedText("he"),"×¢×¦×•×¨ ×§×¨×™××”":()=>this.accessify.reading?.stop(),"× ×™×•×•×˜ ×œ×ž×¢×œ×”":()=>this._navigateUp(),"× ×™×•×•×˜ ×œ×ž×˜×”":()=>this._navigateDown(),"× ×™×•×•×˜ ×©×ž××œ×”":()=>this._navigateLeft(),"× ×™×•×•×˜ ×™×ž×™× ×”":()=>this._navigateRight(),"×¡×’×•×¨":()=>this._closeCurrentElement(),"×¤×ª×—":()=>this._openCurrentElement(),"×—×–×•×¨":()=>window.history.back(),"×§×“×™×ž×”":()=>window.history.forward()},this.arabicCommands={"ÙƒØ¨Ø± Ø§Ù„Ù†Øµ":()=>this.accessify.visual?.increaseTextSize(),"ØµØºØ± Ø§Ù„Ù†Øµ":()=>this.accessify.visual?.decreaseTextSize(),"ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ù„ÙŠ":()=>this.accessify.visual?.setContrastMode("high"),"ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ø¯ÙŠ":()=>this.accessify.visual?.setContrastMode("normal"),"Ù…Ø¸Ù‡Ø± Ø¯Ø§ÙƒÙ†":()=>this.accessify.visual?.setTheme("dark"),"Ù…Ø¸Ù‡Ø± ÙØ§ØªØ­":()=>this.accessify.visual?.setTheme("light"),"Ø§Ù‚Ø±Ø£ Ø§Ù„Ù†Øµ":()=>this._speakSelectedText("ar"),"ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©":()=>this.accessify.reading?.stop(),"Ø§Ù†ØªÙ‚Ù„ Ù„Ø£Ø¹Ù„Ù‰":()=>this._navigateUp(),"Ø§Ù†ØªÙ‚Ù„ Ù„Ø£Ø³ÙÙ„":()=>this._navigateDown(),"Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ÙŠØ³Ø§Ø±":()=>this._navigateLeft(),"Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ÙŠÙ…ÙŠÙ†":()=>this._navigateRight(),"Ø¥ØºÙ„Ø§Ù‚":()=>this._closeCurrentElement(),"ÙØªØ­":()=>this._openCurrentElement(),"Ø±Ø¬ÙˆØ¹":()=>window.history.back(),"ØªÙ‚Ø¯Ù…":()=>window.history.forward()},this.accessify.emit("rtlVoiceRecognitionInitialized")}catch(e){this.accessify.errorHandler.handle(e,"RTL voice recognition initialization","component")}}processVoiceCommand(e){try{const t=e.toLowerCase().trim();return"he"===this.currentLanguage&&this.hebrewCommands[t]?(this.hebrewCommands[t](),this.accessify.emit("hebrewVoiceCommand",e),!0):!("ar"!==this.currentLanguage||!this.arabicCommands[t])&&(this.arabicCommands[t](),this.accessify.emit("arabicVoiceCommand",e),!0)}catch(e){return this.accessify.errorHandler.handle(e,"Voice command processing","component"),!1}}_speakSelectedText(e){try{const t=window.getSelection().toString().trim();t&&this.accessify.reading&&this.accessify.reading.speak(t,{lang:e,rate:.9,pitch:1,volume:1})}catch(e){this.accessify.errorHandler.handle(e,"Text-to-speech in RTL language","component")}}_navigateUp(){const e=document.activeElement,t=this._getFocusableElements(),i=t.indexOf(e);i>0&&t[i-1].focus()}_navigateDown(){const e=document.activeElement,t=this._getFocusableElements(),i=t.indexOf(e);i<t.length-1&&t[i+1].focus()}_navigateLeft(){"rtl"===this.currentDirection?this._navigateDown():this._navigateUp()}_navigateRight(){"rtl"===this.currentDirection?this._navigateUp():this._navigateDown()}_closeCurrentElement(){const e=document.activeElement,t=e.closest('[role="dialog"], [role="modal"]')?.querySelector('[aria-label*="close"], [aria-label*="×¡×’×•×¨"], [aria-label*="Ø¥ØºÙ„Ø§Ù‚"]');t?t.click():e.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))}_openCurrentElement(){const e=document.activeElement;"BUTTON"===e.tagName||"button"===e.getAttribute("role")||"A"===e.tagName?e.click():e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter"}))}_getFocusableElements(){return Array.from(document.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]'].join(", ")))}getAvailableVoiceCommands(){return"he"===this.currentLanguage?Object.keys(this.hebrewCommands):"ar"===this.currentLanguage?Object.keys(this.arabicCommands):[]}addCustomVoiceCommand(e,t,i=null){try{const n=i||this.currentLanguage;"he"===n?this.hebrewCommands[e]=t:"ar"===n&&(this.arabicCommands[e]=t),this.accessify.emit("customVoiceCommandAdded",{command:e,language:n})}catch(e){this.accessify.errorHandler.handle(e,"Custom voice command addition","component")}}}class d{constructor(e){this.accessify=e,this.isInitialized=!1,this.enhancedElements=new Set,this.ariaObserver=null}async init(){try{if(this.isInitialized)return;this._enhanceExistingElements(),this._observeNewElements(),this._setupLiveRegions(),this.isInitialized=!0,this.accessify.emit("ariaEnhancementInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"ARIA enhancement initialization","component"),e}}destroy(){try{this.ariaObserver&&(this.ariaObserver.disconnect(),this.ariaObserver=null),this.enhancedElements.clear(),this.isInitialized=!1,this.accessify.emit("ariaEnhancementDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"ARIA enhancement destruction","component")}}_enhanceExistingElements(){this._enhanceButtons(),this._enhanceFormElements(),this._enhanceNavigation(),this._enhanceImages(),this._enhanceInteractiveElements()}_enhanceButtons(){document.querySelectorAll("button:not([aria-label]):not([aria-labelledby])").forEach(e=>{if(!e.textContent.trim()&&!e.getAttribute("aria-label")){const t=e.querySelector("i, svg, img");if(t){const i=t.className,n=t.getAttribute("title")||t.getAttribute("aria-label");if(n)e.setAttribute("aria-label",n);else if(i){const t=this._generateLabelFromIconClass(i);e.setAttribute("aria-label",t)}}const i=e.getAttribute("data-label");i&&e.setAttribute("aria-label",i)}this.enhancedElements.add(e)})}_enhanceFormElements(){document.querySelectorAll("input, select, textarea").forEach(e=>{if(!e.getAttribute("aria-label")&&!e.getAttribute("aria-labelledby")){const t=e.closest("label")||document.querySelector(`label[for="${e.id}"]`);t&&e.setAttribute("aria-labelledby",t.id||this._generateId(t))}e.hasAttribute("required")&&e.setAttribute("aria-required","true"),(e.hasAttribute("invalid")||e.classList.contains("invalid"))&&e.setAttribute("aria-invalid","true");const t=e.closest(".form-group, .field")?.querySelector(".help-text, .description");t&&!e.getAttribute("aria-describedby")&&(t.id=t.id||this._generateId(t),e.setAttribute("aria-describedby",t.id)),this.enhancedElements.add(e)})}_enhanceNavigation(){document.querySelectorAll("nav:not([aria-label]):not([aria-labelledby])").forEach(e=>{if(!e.getAttribute("aria-label")){const t=e.querySelector("h1, h2, h3, h4, h5, h6");t?e.setAttribute("aria-labelledby",t.id||this._generateId(t)):e.setAttribute("aria-label","Navigation")}this.enhancedElements.add(e)})}_enhanceImages(){document.querySelectorAll("img").forEach(e=>{if(e.hasAttribute("alt")||e.setAttribute("alt","Image"),e.hasAttribute("data-longdesc")&&!e.hasAttribute("aria-describedby")){const t=this._generateId(e)+"-longdesc",i=document.getElementById(e.getAttribute("data-longdesc"));i&&(i.id=t,e.setAttribute("aria-describedby",t))}this.enhancedElements.add(e)})}_enhanceInteractiveElements(){document.querySelectorAll('[onclick], [role="button"]:not(button)').forEach(e=>{e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),e.getAttribute("role")||e.setAttribute("role","button"),this._addKeyboardHandlers(e),this.enhancedElements.add(e)})}_addKeyboardHandlers(e){const t=t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())};e.addEventListener("keydown",t),e._accessifyKeydownHandler=t}_observeNewElements(){"undefined"!=typeof MutationObserver&&(this.ariaObserver=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&this._enhanceNewElement(e)})})}),this.ariaObserver.observe(document.body,{childList:!0,subtree:!0}))}_enhanceNewElement(e){this.enhancedElements.has(e)||("BUTTON"===e.tagName?this._enhanceButtons():["INPUT","SELECT","TEXTAREA"].includes(e.tagName)?this._enhanceFormElements():"NAV"===e.tagName?this._enhanceNavigation():"IMG"===e.tagName?this._enhanceImages():(e.hasAttribute("onclick")||"button"===e.getAttribute("role"))&&this._enhanceInteractiveElements())}_setupLiveRegions(){if(!document.getElementById("accessify-live-region")){const e=document.createElement("div");e.id="accessify-live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="\n        position: absolute;\n        left: -10000px;\n        width: 1px;\n        height: 1px;\n        overflow: hidden;\n      ",document.body.appendChild(e)}if(!document.getElementById("accessify-live-region-assertive")){const e=document.createElement("div");e.id="accessify-live-region-assertive",e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),e.style.cssText="\n        position: absolute;\n        left: -10000px;\n        width: 1px;\n        height: 1px;\n        overflow: hidden;\n      ",document.body.appendChild(e)}}announce(e,t="polite"){try{const i="assertive"===t?"accessify-live-region-assertive":"accessify-live-region",n=document.getElementById(i);n&&(n.textContent=e,setTimeout(()=>{n.textContent=""},1e3))}catch(e){this.accessify.errorHandler.handle(e,"Live region announcement","component")}}_generateLabelFromIconClass(e){const t={"fa-search":"Search","fa-menu":"Menu","fa-close":"Close","fa-edit":"Edit","fa-delete":"Delete","fa-save":"Save","fa-cancel":"Cancel","fa-plus":"Add","fa-minus":"Remove","fa-arrow-left":"Previous","fa-arrow-right":"Next","fa-arrow-up":"Up","fa-arrow-down":"Down","fa-home":"Home","fa-user":"User","fa-settings":"Settings","fa-help":"Help"};for(const[i,n]of Object.entries(t))if(e.includes(i))return n;return"Button"}_generateId(e){if(e.id)return e.id;const t=`${e.tagName.toLowerCase()}-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;return e.id=t,t}enhanceElement(e,t){try{Object.entries(t).forEach(([t,i])=>{e.setAttribute(t,i)}),this.enhancedElements.add(e),this.accessify.emit("elementEnhanced",{element:e,attributes:t})}catch(e){this.accessify.errorHandler.handle(e,"Element enhancement","component")}}removeEnhancement(e,t){try{Array.isArray(t)?t.forEach(t=>{e.removeAttribute(t)}):e.removeAttribute(t),this.enhancedElements.delete(e),this.accessify.emit("elementEnhancementRemoved",{element:e,attributes:t})}catch(e){this.accessify.errorHandler.handle(e,"Element enhancement removal","component")}}getComplianceStatus(){return{enhancedElements:this.enhancedElements.size,liveRegions:{polite:!!document.getElementById("accessify-live-region"),assertive:!!document.getElementById("accessify-live-region-assertive")},wcagCompliant:!0,israeliStandardCompliant:!0}}reset(){try{this.enhancedElements.forEach(e=>{Array.from(e.attributes).filter(e=>e.name.startsWith("data-accessify-")).map(e=>e.name).forEach(t=>{e.removeAttribute(t)})}),this.enhancedElements.clear(),this.accessify.emit("ariaEnhancementReset")}catch(e){this.accessify.errorHandler.handle(e,"ARIA enhancement reset","component")}}}class u{constructor(e){this.accessify=e,this.isInitialized=!1,this.readingRuler=null,this.isActive=!1,this.currentPosition={x:0,y:0},this.highlightedElements=new Set}async init(){try{if(this.isInitialized)return;this._createReadingRuler(),this._setupEventListeners(),this._initializeTextHighlighting(),this.isInitialized=!0,this.accessify.emit("readingGuideInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Reading guide initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this._removeReadingRuler(),this._removeEventListeners(),this._clearHighlightedElements(),this.isInitialized=!1,this.accessify.emit("readingGuideDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Reading guide destruction","component")}}_createReadingRuler(){this.readingRuler=document.createElement("div"),this.readingRuler.id="accessify-reading-ruler",this.readingRuler.className="accessify-reading-ruler",this.readingRuler.setAttribute("aria-hidden","true");const e=document.createElement("div");e.className="accessify-ruler-line";const t=document.createElement("div");t.className="accessify-ruler-handle accessify-ruler-handle-top";const i=document.createElement("div");i.className="accessify-ruler-handle accessify-ruler-handle-bottom",this.readingRuler.appendChild(e),this.readingRuler.appendChild(t),this.readingRuler.appendChild(i),document.body.appendChild(this.readingRuler),this._addReadingRulerCSS(),this.hideReadingRuler()}_addReadingRulerCSS(){const e=document.createElement("style");e.textContent="\n      .accessify-reading-ruler {\n        position: fixed;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 60px;\n        z-index: 10000;\n        pointer-events: none;\n        display: none;\n        border: 2px solid #ff0000;\n        background-color: rgba(255, 0, 0, 0.1);\n        box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);\n      }\n      \n      .accessify-ruler-line {\n        position: absolute;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background-color: #ff0000;\n        top: 50%;\n        transform: translateY(-50%);\n      }\n      \n      .accessify-ruler-handle {\n        position: absolute;\n        width: 20px;\n        height: 20px;\n        background-color: #ff0000;\n        border: 2px solid #ffffff;\n        border-radius: 50%;\n        cursor: pointer;\n        pointer-events: auto;\n        top: 50%;\n        transform: translateY(-50%);\n      }\n      \n      .accessify-ruler-handle-top {\n        left: -10px;\n      }\n      \n      .accessify-ruler-handle-bottom {\n        right: -10px;\n      }\n      \n      .accessify-ruler-handle:hover {\n        background-color: #cc0000;\n        transform: translateY(-50%) scale(1.2);\n      }\n      \n      .accessify-reading-ruler.active {\n        display: block;\n        pointer-events: auto;\n      }\n      \n      .accessify-text-highlight {\n        background-color: rgba(255, 255, 0, 0.3) !important;\n        border-radius: 3px !important;\n        padding: 2px !important;\n      }\n      \n      .accessify-text-mask {\n        background-color: rgba(0, 0, 0, 0.8) !important;\n        color: transparent !important;\n        text-shadow: 0 0 5px rgba(0, 0, 0, 0.8) !important;\n      }\n      \n      .accessify-text-mask.active {\n        background-color: rgba(255, 255, 255, 0.9) !important;\n        color: inherit !important;\n        text-shadow: none !important;\n      }\n    ",document.head.appendChild(e)}showReadingRuler(){this.readingRuler&&(this.readingRuler.classList.add("active"),this.isActive=!0,this.accessify.emit("readingRulerShown"))}hideReadingRuler(){this.readingRuler&&(this.readingRuler.classList.remove("active"),this.isActive=!1,this.accessify.emit("readingRulerHidden"))}toggleReadingRuler(){this.isActive?this.hideReadingRuler():this.showReadingRuler()}setReadingRulerPosition(e){this.readingRuler&&(this.readingRuler.style.top=e+"px",this.currentPosition.y=e,this.accessify.emit("readingRulerPositionChanged",e))}setReadingRulerHeight(e){this.readingRuler&&(this.readingRuler.style.height=e+"px",this.accessify.emit("readingRulerHeightChanged",e))}highlightText(e){Array.isArray(e)||(e=[e]),e.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&(e.classList.add("accessify-text-highlight"),this.highlightedElements.add(e))}),this.accessify.emit("textHighlighted",e)}removeTextHighlighting(e){Array.isArray(e)||(e=[e]),e.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&(e.classList.remove("accessify-text-highlight"),this.highlightedElements.delete(e))}),this.accessify.emit("textHighlightingRemoved",e)}_clearHighlightedElements(){this.highlightedElements.forEach(e=>{e.classList.remove("accessify-text-highlight")}),this.highlightedElements.clear()}maskText(e){Array.isArray(e)||(e=[e]),e.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&e.classList.add("accessify-text-mask")}),this.accessify.emit("textMasked",e)}unmaskText(e){Array.isArray(e)||(e=[e]),e.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&e.classList.remove("accessify-text-mask")}),this.accessify.emit("textUnmasked",e)}focusOnText(e){if(e&&e.nodeType===Node.ELEMENT_NODE){e.classList.add("accessify-text-mask","active");document.querySelectorAll("p, h1, h2, h3, h4, h5, h6, span, div, li, td, th").forEach(t=>{t!==e&&t.classList.add("accessify-text-mask")}),this.accessify.emit("textFocused",e)}}clearTextFocus(){document.querySelectorAll(".accessify-text-mask").forEach(e=>{e.classList.remove("accessify-text-mask","active")}),this.accessify.emit("textFocusCleared")}_setupEventListeners(){document.addEventListener("mousemove",this._handleMouseMove.bind(this)),document.addEventListener("click",this._handleClick.bind(this)),document.addEventListener("keydown",this._handleKeydown.bind(this)),document.addEventListener("touchstart",this._handleTouchStart.bind(this)),document.addEventListener("touchmove",this._handleTouchMove.bind(this))}_handleMouseMove(e){this.isActive&&e.ctrlKey&&this.setReadingRulerPosition(e.clientY-30)}_handleClick(e){this.isActive&&e.ctrlKey&&(e.preventDefault(),this.setReadingRulerPosition(e.clientY-30))}_handleKeydown(e){e.altKey&&"r"===e.key&&(e.preventDefault(),this.toggleReadingRuler()),e.altKey&&"h"===e.key&&(e.preventDefault(),this.toggleTextHighlighting())}_handleTouchStart(e){this.isActive&&1===e.touches.length&&this.setReadingRulerPosition(e.touches[0].clientY-30)}_handleTouchMove(e){this.isActive&&1===e.touches.length&&(e.preventDefault(),this.setReadingRulerPosition(e.touches[0].clientY-30))}_removeEventListeners(){document.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("click",this._handleClick),document.removeEventListener("keydown",this._handleKeydown),document.removeEventListener("touchstart",this._handleTouchStart),document.removeEventListener("touchmove",this._handleTouchMove)}_removeReadingRuler(){this.readingRuler&&this.readingRuler.parentNode&&this.readingRuler.parentNode.removeChild(this.readingRuler)}_initializeTextHighlighting(){this.accessify.emit("textHighlightingInitialized")}toggleTextHighlighting(){if(this.highlightedElements.size>0)this._clearHighlightedElements();else{const e=document.querySelectorAll("p, h1, h2, h3, h4, h5, h6, span, div, li, td, th");this.highlightText(Array.from(e))}}getComplianceStatus(){return{readingRuler:{available:!!this.readingRuler,active:this.isActive},textHighlighting:{available:!0,highlightedElements:this.highlightedElements.size},wcagCompliant:!0,israeliStandardCompliant:!0}}getCurrentSettings(){return{readingRuler:{active:this.isActive,position:this.currentPosition},textHighlighting:{highlightedElements:this.highlightedElements.size}}}reset(){this.hideReadingRuler(),this._clearHighlightedElements(),this.clearTextFocus(),this.accessify.emit("readingGuideReset")}}class g{constructor(e){this.accessify=e,this.isInitialized=!1,this.liveRegions=new Map,this.announcements=[],this.ariaEnhancements=new Map,this.screenReaderDetected=!1}async init(){try{if(this.isInitialized)return;this._detectScreenReader(),this._setupLiveRegions(),this._enhanceARIA(),this._setupAnnouncements(),this._setupEventListeners(),this.isInitialized=!0,this.accessify.emit("screenReaderOptimizationInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Screen reader optimization initialization","component"),e}}destroy(){try{if(!this.isInitialized)return;this._removeLiveRegions(),this._removeEventListeners(),this.announcements=[],this.isInitialized=!1,this.accessify.emit("screenReaderOptimizationDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Screen reader optimization destruction","component")}}_detectScreenReader(){(window.speechSynthesis||document.querySelector("[aria-live]"))&&(this.screenReaderDetected=!0);document.querySelector('.sr-only, .screen-reader-only, [aria-hidden="true"]')&&(this.screenReaderDetected=!0),this.accessify.emit("screenReaderDetected",this.screenReaderDetected)}_setupLiveRegions(){this._createLiveRegion("polite","accessify-live-polite"),this._createLiveRegion("assertive","accessify-live-assertive"),this._createLiveRegion("status","accessify-live-status"),this._createLiveRegion("log","accessify-live-log")}_createLiveRegion(e,t){const i=document.createElement("div");i.id=t,i.setAttribute("aria-live",e),i.setAttribute("aria-atomic","true"),i.style.cssText="\n      position: absolute;\n      left: -10000px;\n      width: 1px;\n      height: 1px;\n      overflow: hidden;\n    ",document.body.appendChild(i),this.liveRegions.set(e,i)}announce(e,t="polite",i="normal"){try{const n=this.liveRegions.get(t);n&&(n.textContent="",setTimeout(()=>{n.textContent=e,this.announcements.push({message:e,type:t,priority:i,timestamp:(new Date).toISOString()})},100),setTimeout(()=>{n.textContent=""},2e3),this.accessify.emit("announcementMade",{message:e,type:t,priority:i}))}catch(e){this.accessify.errorHandler.handle(e,"Screen reader announcement","component")}}announceStatus(e,t=""){const i=t?`${e}: ${t}`:e;this.announce(i,"status","high")}announceError(e,t=""){const i=t?`Error in ${t}: ${e}`:`Error: ${e}`;this.announce(i,"assertive","high")}announceSuccess(e){this.announce(`Success: ${e}`,"polite","normal")}_enhanceARIA(){this._enhanceButtons(),this._enhanceFormElements(),this._enhanceNavigation(),this._enhanceHeadings(),this._enhanceLists(),this._enhanceTables()}_enhanceButtons(){document.querySelectorAll("button:not([aria-label]):not([aria-labelledby])").forEach(e=>{if(!e.textContent.trim()){const t=e.querySelector("i, svg, img");if(t){const i=t.getAttribute("title")||t.getAttribute("aria-label");i&&e.setAttribute("aria-label",i)}const i=e.getAttribute("data-label");i&&e.setAttribute("aria-label",i)}this.ariaEnhancements.set(e,["aria-label"])})}_enhanceFormElements(){document.querySelectorAll("input, select, textarea").forEach(e=>{if(!e.getAttribute("aria-label")&&!e.getAttribute("aria-labelledby")){const t=e.closest("label")||document.querySelector(`label[for="${e.id}"]`);t&&e.setAttribute("aria-labelledby",t.id||this._generateId(t))}e.hasAttribute("required")&&e.setAttribute("aria-required","true"),(e.hasAttribute("invalid")||e.classList.contains("invalid"))&&e.setAttribute("aria-invalid","true");const t=e.closest(".form-group, .field")?.querySelector(".help-text, .description");t&&!e.getAttribute("aria-describedby")&&(t.id=t.id||this._generateId(t),e.setAttribute("aria-describedby",t.id)),this.ariaEnhancements.set(e,["aria-required","aria-invalid","aria-describedby"])})}_enhanceNavigation(){document.querySelectorAll("nav:not([aria-label]):not([aria-labelledby])").forEach(e=>{if(!e.getAttribute("aria-label")){const t=e.querySelector("h1, h2, h3, h4, h5, h6");t?e.setAttribute("aria-labelledby",t.id||this._generateId(t)):e.setAttribute("aria-label","Navigation")}this.ariaEnhancements.set(e,["aria-label","aria-labelledby"])})}_enhanceHeadings(){document.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(e=>{e.id||(e.id=this._generateId(e)),this.ariaEnhancements.set(e,["id"])})}_enhanceLists(){document.querySelectorAll("ul, ol").forEach(e=>{if(!e.getAttribute("aria-label")&&!e.getAttribute("aria-labelledby")){const t=e.previousElementSibling;t&&["H1","H2","H3","H4","H5","H6"].includes(t.tagName)&&e.setAttribute("aria-labelledby",t.id||this._generateId(t))}this.ariaEnhancements.set(e,["aria-label","aria-labelledby"])})}_enhanceTables(){document.querySelectorAll("table").forEach(e=>{if(!e.querySelector("caption")){const t=document.createElement("caption");t.textContent="Table",e.insertBefore(t,e.firstChild)}e.querySelectorAll("th").length>0&&e.setAttribute("role","table"),this.ariaEnhancements.set(e,["caption","role"])})}_setupAnnouncements(){this.announce("Page loaded successfully","polite","normal"),this.announce("Accessibility features are now active","polite","normal")}_setupEventListeners(){document.addEventListener("submit",this._handleFormSubmit.bind(this)),document.addEventListener("focusin",this._handleFocusIn.bind(this)),window.addEventListener("error",this._handleError.bind(this)),document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this))}_handleFormSubmit(e){this.announce("Form submitted","polite","normal")}_handleFocusIn(e){const t=e.target;t.getAttribute("aria-label")?this.announce(t.getAttribute("aria-label"),"polite","low"):t.textContent.trim()&&this.announce(t.textContent.trim(),"polite","low")}_handleError(e){this.announceError(e.message,e.filename)}_handleVisibilityChange(e){document.hidden?this.announce("Page hidden","polite","low"):this.announce("Page visible","polite","low")}_removeEventListeners(){document.removeEventListener("submit",this._handleFormSubmit),document.removeEventListener("focusin",this._handleFocusIn),window.removeEventListener("error",this._handleError),document.removeEventListener("visibilitychange",this._handleVisibilityChange)}_removeLiveRegions(){this.liveRegions.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.liveRegions.clear()}_generateId(e){if(e.id)return e.id;const t=`${e.tagName.toLowerCase()}-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;return e.id=t,t}getComplianceStatus(){return{screenReaderDetected:this.screenReaderDetected,liveRegions:{count:this.liveRegions.size,types:Array.from(this.liveRegions.keys())},ariaEnhancements:{count:this.ariaEnhancements.size},announcements:{count:this.announcements.length},wcagCompliant:!0,israeliStandardCompliant:!0}}getCurrentSettings(){return{screenReaderDetected:this.screenReaderDetected,liveRegions:Array.from(this.liveRegions.keys()),ariaEnhancements:this.ariaEnhancements.size,announcements:this.announcements.length}}reset(){this.announcements=[],this.liveRegions.forEach(e=>{e.textContent=""}),this.accessify.emit("screenReaderOptimizationReset")}}const p="accessify-settings",m=Object.freeze({textSize:100,contrastMode:"normal",textSpacing:"normal",fontType:"default",highlightLinks:!1,highlightCursor:!1,language:"en",colorFilter:"none"});function f(e){try{localStorage.setItem(p,JSON.stringify(e))}catch(e){}}const y="accessify-toolbar-v2-styles";function b(){if(document.getElementById(y))return;const e=document.createElement("style");e.id=y,e.textContent='\n/* ---- Toolbar V2: Trigger (bottom; left for RTL/hebrew, right for LTR/english) ---- */\n.accessify-toolbar-v2-trigger {\n  position: fixed;\n  bottom: 1rem;\n  inset-inline-end: 1rem;\n  z-index: 10002;\n  width: 48px;\n  height: 48px;\n  min-width: 48px;\n  min-height: 48px;\n  padding: 12px;\n  border: none;\n  border-radius: 50%;\n  background-color: #2563eb;\n  color: #fff;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);\n  transition: transform 0.3s ease, box-shadow 0.2s ease, background-color 0.2s ease;\n}\n.accessify-toolbar-v2-trigger[aria-expanded="false"] {\n  transform: rotate(180deg);\n}\n.accessify-toolbar-v2-trigger[aria-expanded="true"] {\n  transform: rotate(0deg);\n}\n.accessify-toolbar-v2-trigger:hover {\n  background-color: #1d4ed8;\n}\n.accessify-toolbar-v2-trigger:focus {\n  outline: none;\n}\n.accessify-toolbar-v2-trigger:focus-visible {\n  outline: none;\n  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5);\n}\n.accessify-toolbar-v2-trigger .accessify-toolbar-v2-icon,\n.accessify-toolbar-v2-trigger .accessify-toolbar-v2-trigger-icon-img {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.accessify-toolbar-v2-trigger .accessify-toolbar-v2-trigger-icon-img {\n  width: 24px;\n  height: 24px;\n  object-fit: contain;\n}\n.accessify-toolbar-v2-trigger .accessify-toolbar-v2-icon svg {\n  width: 24px;\n  height: 24px;\n}\n.accessify-toolbar-v2-trigger .accessify-toolbar-v2-trigger-fallback {\n  display: none;\n}\n.accessify-toolbar-v2-trigger:not(:has(.accessify-toolbar-v2-trigger-icon-img)) .accessify-toolbar-v2-trigger-fallback {\n  display: flex;\n}\n\n/* ---- Toolbar V2: Panel (bottom, same side as trigger; dir set in JS for inset-inline-end) ---- */\n.accessify-toolbar-v2-panel {\n  position: fixed;\n  bottom: 5rem;\n  inset-inline-end: 1rem;\n  z-index: 10001;\n  width: 260px;\n  max-width: calc(100vw - 2rem);\n  max-height: calc(100vh - 7rem);\n  background: #fff;\n  border: 2px solid #e5e7eb;\n  border-radius: 8px;\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n.accessify-toolbar-v2-panel-body {\n  padding: 16px 8px;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n/* ---- Toolbar V2: Header ---- */\n.accessify-toolbar-v2-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 8px;\n  background-color: #eff6ff;\n  border-bottom: 2px solid #e5e7eb;\n}\n.accessify-toolbar-v2-header-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin: 0;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #111827;\n}\n.accessify-toolbar-v2-header-title .accessify-toolbar-v2-header-title-icon {\n  display: flex;\n  align-items: center;\n  flex-shrink: 0;\n}\n.accessify-toolbar-v2-header-title .accessify-toolbar-v2-header-title-icon-img {\n  width: 20px;\n  height: 20px;\n  object-fit: contain;\n}\n.accessify-toolbar-v2-header-title .accessify-toolbar-v2-header-title-icon-fallback {\n  display: none;\n  color: #2563eb;\n}\n.accessify-toolbar-v2-header-title .accessify-toolbar-v2-header-title-icon-fallback svg {\n  width: 20px;\n  height: 20px;\n}\n.accessify-toolbar-v2-header-title .accessify-toolbar-v2-header-title-icon:not(:has(.accessify-toolbar-v2-header-title-icon-img)) .accessify-toolbar-v2-header-title-icon-fallback {\n  display: flex;\n}\n.accessify-toolbar-v2-close {\n  width: 44px;\n  height: 44px;\n  min-width: 44px;\n  min-height: 44px;\n  padding: 0;\n  border: none;\n  border-radius: 6px;\n  background: transparent;\n  color: #6b7280;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.accessify-toolbar-v2-close:hover {\n  color: #374151;\n  background: rgba(0, 0, 0, 0.05);\n}\n.accessify-toolbar-v2-close:focus {\n  outline: none;\n}\n.accessify-toolbar-v2-close:focus-visible {\n  outline: none;\n  box-shadow: 0 0 0 2px #2563eb;\n}\n.accessify-toolbar-v2-close .accessify-toolbar-v2-icon svg {\n  width: 20px;\n  height: 20px;\n}\n\n/* ---- Toolbar V2: Section ---- */\n.accessify-toolbar-v2-section {\n  margin-bottom: 16px;\n}\n.accessify-toolbar-v2-section:last-child {\n  margin-bottom: 0;\n}\n.accessify-toolbar-v2-section-label {\n  display: block;\n  margin-bottom: 8px;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  color: #4b5563;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n.accessify-toolbar-v2-section-controls {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n}\n.accessify-toolbar-v2-section-controls > .accessify-toolbar-v2-btn,\n.accessify-toolbar-v2-section-controls > div {\n  flex: 1;\n  min-width: 0;\n}\n\n/* ---- Toolbar V2: Customize (show/hide tools, collapsible) ---- */\n.accessify-toolbar-v2-customize {\n  margin-bottom: 16px;\n}\n.accessify-toolbar-v2-customize-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  min-height: 48px;\n  padding: 12px 16px;\n  border: 2px solid #d1d5db;\n  border-radius: 8px;\n  background: #fff;\n  color: #111827;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  color: #4b5563;\n  cursor: pointer;\n  transition: border-color 0.15s ease, background-color 0.15s ease;\n}\n.accessify-toolbar-v2-customize-header:hover {\n  border-color: #2563eb;\n  background: #eff6ff;\n}\n.accessify-toolbar-v2-customize-header:focus-visible {\n  outline: 2px solid #2563eb;\n  outline-offset: 2px;\n}\n.accessify-toolbar-v2-customize-header-label {\n  flex: 1;\n  text-align: left;\n}\n.accessify-toolbar-v2-customize-chevron {\n  flex-shrink: 0;\n  transition: transform 0.2s ease;\n}\n.accessify-toolbar-v2-customize-open .accessify-toolbar-v2-customize-chevron {\n  transform: rotate(180deg);\n}\n.accessify-toolbar-v2-customize-body {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-top: 12px;\n  padding: 0 2px;\n}\n.accessify-toolbar-v2-customize-body[hidden] {\n  display: none;\n}\n.accessify-toolbar-v2-customize-label {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #374151;\n}\n.accessify-toolbar-v2-customize-checkbox {\n  width: 18px;\n  height: 18px;\n  accent-color: #2563eb;\n  cursor: pointer;\n}\n.accessify-toolbar-v2-customize-label-text {\n  user-select: none;\n}\n.accessify-toolbar-v2-section[data-control-id] {\n  transition: opacity 0.15s ease;\n}\n\n/* ---- Toolbar V2: Buttons (default) ---- */\n.accessify-toolbar-v2-btn {\n  min-height: 48px;\n  padding: 14px 16px;\n  border: 2px solid #d1d5db;\n  border-radius: 8px;\n  background: #fff;\n  color: #111827;\n  font-size: 0.875rem;\n  font-weight: 600;\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  transition: border-color 0.15s ease, background-color 0.15s ease, color 0.15s ease;\n}\n.accessify-toolbar-v2-btn:hover:not(:disabled) {\n  border-color: #2563eb;\n  background-color: #eff6ff;\n}\n.accessify-toolbar-v2-btn:focus {\n  outline: none;\n}\n.accessify-toolbar-v2-btn:focus-visible {\n  outline: none;\n  box-shadow: 0 0 0 2px #2563eb;\n}\n.accessify-toolbar-v2-btn:disabled {\n  border-color: #e5e7eb;\n  background-color: #f9fafb;\n  color: #9ca3af;\n  cursor: not-allowed;\n}\n.accessify-toolbar-v2-btn[aria-pressed="true"] {\n  border-color: #2563eb;\n  background-color: #eff6ff;\n  color: #1d4ed8;\n}\n.accessify-toolbar-v2-btn .accessify-toolbar-v2-icon {\n  display: flex;\n  flex-shrink: 0;\n}\n.accessify-toolbar-v2-btn .accessify-toolbar-v2-icon svg {\n  width: 20px;\n  height: 20px;\n}\n\n/* Text size value display */\n.accessify-toolbar-v2-value {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #2563eb;\n  min-width: 3ch;\n  text-align: center;\n}\n\n/* Font D badge */\n.accessify-toolbar-v2-font-d-badge {\n  width: 24px;\n  height: 24px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: #111827;\n  color: #fff;\n  font-size: 0.875rem;\n  font-weight: 700;\n  border-radius: 4px;\n  flex-shrink: 0;\n}\n\n/* Language buttons */\n.accessify-toolbar-v2-language-buttons {\n  display: flex;\n  gap: 8px;\n  width: 100%;\n}\n.accessify-toolbar-v2-language-btn {\n  flex: 1;\n  min-width: 0;\n}\n\n/* Reset button */\n.accessify-toolbar-v2-reset {\n  margin-top: 8px;\n  padding-top: 16px;\n  border-top: 2px solid #e5e7eb;\n}\n.accessify-toolbar-v2-reset .accessify-toolbar-v2-btn {\n  width: 100%;\n  background: #fef2f2;\n  border-color: #fca5a5;\n  color: #b91c1c;\n}\n.accessify-toolbar-v2-reset .accessify-toolbar-v2-btn:hover {\n  background: #fee2e2;\n  border-color: #f87171;\n}\n.accessify-toolbar-v2-reset .accessify-toolbar-v2-btn:focus-visible {\n  box-shadow: 0 0 0 2px #ef4444;\n}\n\n/* Cursor highlight circle (centered on pointer) - above toolbar so it stays visible */\n.accessify-toolbar-v2-cursor-circle {\n  position: fixed;\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  border: 4px solid #2563eb;\n  background: rgba(37, 99, 235, 0.1);\n  pointer-events: none;\n  z-index: 10003;\n  left: 0;\n  top: 0;\n  transform: translate(-50%, -50%);\n}\n\n/* Visually hidden live region for screen reader announcements */\n.accessify-toolbar-v2-live {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border: 0;\n}\n\n/* Reduced motion */\n@media (prefers-reduced-motion: reduce) {\n  .accessify-toolbar-v2-trigger,\n  .accessify-toolbar-v2-btn,\n  .accessify-toolbar-v2-close {\n    transition: none;\n  }\n  .accessify-toolbar-v2-cursor-circle {\n    transition: none;\n  }\n}\n\n/* ---- Body/Root accessibility classes (page effects) ---- */\n/* Contrast applied to content wrapper (not body) so filter does not break toolbar position:fixed */\n.contrast-normal {\n  /* default */\n}\n.contrast-high {\n  filter: contrast(150%) brightness(1.1);\n}\n.contrast-high *:not(button):not(a) {\n  border-color: #000 !important;\n}\n.contrast-high button,\n.contrast-high a {\n  border: 2px solid currentColor !important;\n}\n.contrast-high {\n  font-weight: 500;\n}\n.contrast-high h1, .contrast-high h2, .contrast-high h3,\n.contrast-high h4, .contrast-high h5, .contrast-high h6 {\n  font-weight: 700;\n}\n.contrast-dark {\n  background-color: #1a1a1a !important;\n  color: #e5e7eb !important;\n  min-height: 100vh;\n}\n.contrast-dark a {\n  color: #93c5fd !important;\n}\n.text-spacing-wide p,\n.text-spacing-wide h1, .text-spacing-wide h2, .text-spacing-wide h3,\n.text-spacing-wide h4, .text-spacing-wide h5, .text-spacing-wide h6,\n.text-spacing-wide li, .text-spacing-wide span, .text-spacing-wide div {\n  line-height: 2 !important;\n  letter-spacing: 0.12em !important;\n  word-spacing: 0.16em !important;\n}\n.text-spacing-wide button,\n.text-spacing-wide a {\n  padding-top: 0.75em !important;\n  padding-bottom: 0.75em !important;\n}\n.font-dyslexia,\n.font-dyslexia * {\n  font-family: \'Comic Sans MS\', \'OpenDyslexic\', Arial, sans-serif !important;\n}\n.highlight-links a {\n  text-decoration: underline !important;\n  text-decoration-thickness: 2px !important;\n  text-underline-offset: 3px !important;\n  font-weight: 600 !important;\n  background-color: rgba(255, 255, 0, 0.2) !important;\n  padding: 2px 4px !important;\n  border-radius: 2px !important;\n}\n.highlight-links a:hover {\n  background-color: rgba(255, 255, 0, 0.4) !important;\n}\n.highlight-cursor,\n.highlight-cursor * {\n  cursor: none !important;\n}\n\n/* Color adjustments (applied to content wrapper) */\n.color-filter-none {\n  /* default */\n}\n.color-filter-grayscale,\n.color-filter-grayscale * {\n  filter: grayscale(100%) !important;\n}\n.color-filter-invert,\n.color-filter-invert * {\n  filter: invert(100%) !important;\n}\n',document.head.appendChild(e)}const v={en:{triggerAriaLabel:"Toggle Accessibility Controls",triggerTitle:"Open accessibility controls",headerTitle:"Accessibility",closeAriaLabel:"Close",closeTitle:"Close panel",customizeHeader:"Show or hide tools",showControl:"Show {label}",sectionTextSize:"Text size",sectionContrast:"Contrast",sectionSpacing:"Spacing",sectionFont:"Font",sectionLinks:"Links",sectionCursor:"Cursor",sectionReset:"Reset",sectionLanguage:"Language",sectionColorAdjustments:"Color Adjustments",controlTextSize:"Text size",controlContrast:"Contrast",controlSpacing:"Spacing",controlFont:"Font",controlLinks:"Links",controlCursor:"Cursor",controlReset:"Reset",controlLanguage:"Language",controlColorAdjustments:"Color Adjustments",decreaseTextSize:"Decrease text size",increaseTextSize:"Increase text size",toggleContrast:"Toggle contrast mode",contrastTitle:"Change contrast (Normal / High / Dark)",contrastNormal:"Normal",contrastHigh:"High",contrastDark:"Dark",contrastAriaLabelCurrent:"Contrast: {mode}",announceContrast:"Contrast set to {mode}",toggleSpacing:"Toggle text spacing",spacingTitle:"Toggle letter and line spacing",spacingNormal:"Normal",spacingWide:"Wide",announceSpacing:"Text spacing {state}",toggleFont:"Toggle dyslexia-friendly font",fontTitle:"Switch to dyslexia-friendly font",fontDefault:"Default",fontDyslexia:"Dyslexia",announceFont:"Dyslexia-friendly font {state}",toggleLinks:"Toggle link highlighting",linksTitle:"Highlight links on the page",on:"ON",off:"OFF",announceLinks:"Link highlighting {state}",toggleCursor:"Toggle cursor highlighting",cursorTitle:"Highlight cursor with a circle",announceCursor:"Cursor highlighting {state}",resetAriaLabel:"Reset all settings",resetTitle:"Restore all settings to default",resetLabel:"Reset",announceReset:"All settings reset",languageEn:"English",languageHe:"×¢×‘×¨×™×ª",colorAdjustmentsTitle:"Change color filter (for color vision)",colorFilterNone:"None",colorFilterGrayscale:"Grayscale",colorFilterInvert:"Invert",colorFilterAriaLabelCurrent:"Color filter: {mode}",announceColorFilter:"Color filter set to {mode}"},he:{triggerAriaLabel:"×”×¦×’/×”×¡×ª×¨ ×¤×§×“×™ × ×’×™×©×•×ª",triggerTitle:"×¤×ª×— ×¤×§×“×™ × ×’×™×©×•×ª",headerTitle:"× ×’×™×©×•×ª",closeAriaLabel:"×¡×’×•×¨",closeTitle:"×¡×’×•×¨ ×—×œ×•× ×™×ª",customizeHeader:"×”×¦×’ ××• ×”×¡×ª×¨ ×›×œ×™×",showControl:"×”×¦×’ {label}",sectionTextSize:"×’×•×“×œ ×˜×§×¡×˜",sectionContrast:"× ×™×’×•×“×™×•×ª",sectionSpacing:"×¨×™×•×•×—",sectionFont:"×’×•×¤×Ÿ",sectionLinks:"×§×™×©×•×¨×™×",sectionCursor:"×¡×ž×Ÿ",sectionReset:"××™×¤×•×¡",sectionLanguage:"×©×¤×”",sectionColorAdjustments:"×”×ª××ž×•×ª ×¦×‘×¢",controlTextSize:"×’×•×“×œ ×˜×§×¡×˜",controlContrast:"× ×™×’×•×“×™×•×ª",controlSpacing:"×¨×™×•×•×—",controlFont:"×’×•×¤×Ÿ",controlLinks:"×§×™×©×•×¨×™×",controlCursor:"×¡×ž×Ÿ",controlReset:"××™×¤×•×¡",controlLanguage:"×©×¤×”",controlColorAdjustments:"×”×ª××ž×•×ª ×¦×‘×¢",decreaseTextSize:"×”×§×˜×Ÿ ×’×•×“×œ ×˜×§×¡×˜",increaseTextSize:"×”×’×“×œ ×’×•×“×œ ×˜×§×¡×˜",toggleContrast:"×”×—×œ×£ ×ž×¦×‘ × ×™×’×•×“×™×•×ª",contrastTitle:"×©×™× ×•×™ × ×™×’×•×“×™×•×ª (×¨×’×™×œ / ×’×‘×•×” / ×›×”×”)",contrastNormal:"×¨×’×™×œ",contrastHigh:"×’×‘×•×”",contrastDark:"×›×”×”",contrastAriaLabelCurrent:"× ×™×’×•×“×™×•×ª: {mode}",announceContrast:"× ×™×’×•×“×™×•×ª ×”×•×’×“×¨×” ×œ-{mode}",toggleSpacing:"×”×—×œ×£ ×¨×™×•×•×— ×˜×§×¡×˜",spacingTitle:"×”×—×œ×£ ×¨×™×•×•×— ××•×ª×™×•×ª ×•×©×•×¨×•×ª",spacingNormal:"×¨×’×™×œ",spacingWide:"×¨×—×‘",announceSpacing:"×¨×™×•×•×— ×˜×§×¡×˜ {state}",toggleFont:"×”×—×œ×£ ×’×•×¤×Ÿ ×™×“×™×“×•×ª×™ ×œ×“×™×¡×œ×§×¦×™×”",fontTitle:"×”×—×œ×£ ×œ×’×•×¤×Ÿ ×™×“×™×“×•×ª×™ ×œ×“×™×¡×œ×§×¦×™×”",fontDefault:"×‘×¨×™×¨×ª ×ž×—×“×œ",fontDyslexia:"×“×™×¡×œ×§×¦×™×”",announceFont:"×’×•×¤×Ÿ ×™×“×™×“×•×ª×™ ×œ×“×™×¡×œ×§×¦×™×” {state}",toggleLinks:"×”×—×œ×£ ×”×“×’×©×ª ×§×™×©×•×¨×™×",linksTitle:"×”×“×’×© ×§×™×©×•×¨×™× ×‘×¢×ž×•×“",on:"×¤×•×¢×œ",off:"×›×‘×•×™",announceLinks:"×”×“×’×©×ª ×§×™×©×•×¨×™× {state}",toggleCursor:"×”×—×œ×£ ×”×“×’×©×ª ×¡×ž×Ÿ",cursorTitle:"×”×“×’×© ×¡×ž×Ÿ ×¢× ×¢×™×’×•×œ",announceCursor:"×”×“×’×©×ª ×¡×ž×Ÿ {state}",resetAriaLabel:"××¤×¡ ××ª ×›×œ ×”×”×’×“×¨×•×ª",resetTitle:"×©×—×–×¨ ××ª ×›×œ ×”×”×’×“×¨×•×ª ×œ×‘×¨×™×¨×ª ×ž×—×“×œ",resetLabel:"××™×¤×•×¡",announceReset:"×›×œ ×”×”×’×“×¨×•×ª ××•×¤×¡×•",languageEn:"English",languageHe:"×¢×‘×¨×™×ª",colorAdjustmentsTitle:"×©×™× ×•×™ ×ž×¡× ×Ÿ ×¦×‘×¢ (×œ×ž×¢×Ÿ ×¨××™×™×ª ×¦×‘×¢)",colorFilterNone:"×œ×œ×",colorFilterGrayscale:"×’×•×•× ×™ ××¤×•×¨",colorFilterInvert:"×”×™×¤×•×š",colorFilterAriaLabelCurrent:"×ž×¡× ×Ÿ ×¦×‘×¢: {mode}",announceColorFilter:"×ž×¡× ×Ÿ ×¦×‘×¢ ×”×•×’×“×¨ ×œ-{mode}"}},x="en";let w=x;const S=[];function _(e,t){const i=v[w]||v[x];let n=i&&i[e]||v[x]&&v[x][e]||e;return t&&Object.keys(t).forEach(e=>{n=n.replace(new RegExp("\\{"+e+"\\}","g"),t[e])}),n}function C(){return w}function E(e){v[e]&&(w=e,S.forEach(e=>e()))}function k(){return Object.keys(v)}function A(e){if(!e||"string"!=typeof e)return null;const t=e.trim().toLowerCase(),i=t.split("-")[0],n=k();if(n.includes(t))return t;if(n.includes(i))return i;const s={en:"en",he:"he"};return s[i]&&n.includes(s[i])?s[i]:null}class L{constructor(){this.el=null,this.raf=null,this.x=0,this.y=0}mount(){this.el||(this.el=document.createElement("div"),this.el.className="accessify-toolbar-v2-cursor-circle",this.el.setAttribute("aria-hidden","true"),document.body.appendChild(this.el),this._boundMove=this._onMove.bind(this),window.addEventListener("mousemove",this._boundMove,{passive:!0}))}unmount(){this.el&&(window.removeEventListener("mousemove",this._boundMove),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=null,this.raf&&cancelAnimationFrame(this.raf))}setVisible(e){this.el&&(this.el.style.display=e?"block":"none")}_onMove(e){this.x=e.clientX,this.y=e.clientY,this.raf||(this.raf=requestAnimationFrame(()=>{this.raf=null,this.el&&(this.el.style.left=this.x+"px",this.el.style.top=this.y+"px")}))}}const T=' width="20" height="20" ',R=' width="24" height="24" ',z={accessibility:`<svg xmlns="http://www.w3.org/2000/svg" ${R} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="4" r="2"/><path d="m15 22 2-6 2 6"/><path d="m7 22-2-6-2 6"/><path d="M12 6v14"/><path d="M8 14h8"/></svg>`,typeSmall:'<svg xmlns="http://www.w3.org/2000/svg"  width="16" height="16"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>',typeLarge:`<svg xmlns="http://www.w3.org/2000/svg" ${R} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>`,sun:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,contrast:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 2a10 10 0 0 1 0 20"/></svg>`,moon:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>`,alignJustify:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>`,link:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>`,mousePointer:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3Z"/></svg>`,rotateCcw:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>`,x:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,chevronDown:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>`,palette:`<svg xmlns="http://www.w3.org/2000/svg" ${T} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.9 0 1.75-.2 2.5-.5"/></svg>`};function M(e,t=""){const i=document.createElement("span");return i.className="accessify-toolbar-v2-icon"+(t?" "+t:""),i.innerHTML=e,i.setAttribute("aria-hidden","true"),i}function I(e){const t=document.createElement("div");t.className="accessify-toolbar-v2-header";const i=document.createElement("div");i.className="accessify-toolbar-v2-header-title",i.appendChild(function(){const e=document.createElement("span");e.className="accessify-toolbar-v2-header-title-icon";const t=document.createElement("img");t.src="assets/accessify-icon.png",t.alt="",t.className="accessify-toolbar-v2-header-title-icon-img",t.setAttribute("aria-hidden","true");const i=M(z.accessibility);return i.classList.add("accessify-toolbar-v2-header-title-icon-fallback"),t.onerror=()=>{t.parentNode===e&&e.removeChild(t)},e.appendChild(t),e.appendChild(i),e}());const n=document.createElement("h2");n.className="accessify-toolbar-v2-header-title-text",n.setAttribute("data-i18n-key","headerTitle"),n.textContent=_("headerTitle"),i.appendChild(n),t.appendChild(i);const s=document.createElement("button");return s.type="button",s.className="accessify-toolbar-v2-close",s.setAttribute("aria-label",_("closeAriaLabel")),s.title=_("closeTitle"),s.appendChild(M(z.x)),s.addEventListener("click",e),t.appendChild(s),{element:t,refreshLabels(){const e=t.querySelector(".accessify-toolbar-v2-header-title-text");e&&(e.textContent=_("headerTitle")),s.setAttribute("aria-label",_("closeAriaLabel")),s.title=_("closeTitle")}}}function N(e,t){const i=document.createElement("div");i.className="accessify-toolbar-v2-section";const n=document.createElement("span");n.className="accessify-toolbar-v2-section-label",n.setAttribute("data-section-label-key",e),n.textContent=_(e),n.id="accessify-toolbar-v2-label-"+e.replace(/\s+/g,"-").toLowerCase();const s=document.createElement("div");s.className="accessify-toolbar-v2-section-controls";return(Array.isArray(t)?t:[t]).forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&s.appendChild(e)}),i.appendChild(n),i.appendChild(s),i}let F=null;function P(e){if(!e)return;const t=(F&&F.isConnected||(F=document.createElement("div"),F.id="accessify-toolbar-v2-live",F.setAttribute("aria-live","polite"),F.setAttribute("aria-atomic","true"),F.className="accessify-toolbar-v2-live",document.body.appendChild(F)),F);t.textContent="",requestAnimationFrame(()=>{t.textContent=e,setTimeout(()=>{t.textContent=""},600)})}const H={normal:"contrastNormal",high:"contrastHigh",dark:"contrastDark"};function D(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.title=_("contrastTitle");const n=M(z.sun),s=document.createElement("span");function a(){const t=e().contrastMode;n.innerHTML=function(e){return"high"===e?z.contrast:"dark"===e?z.moon:z.sun}(t),s.textContent=_(H[t]||"contrastNormal"),function(e,t){const i=_(H[t]||"contrastNormal");e.setAttribute("aria-label",_("contrastAriaLabelCurrent",{mode:i}))}(i,t)}return i.appendChild(n),i.appendChild(s),i.addEventListener("click",()=>{t(),a();const i=_(H[e().contrastMode]||"contrastNormal");P(_("announceContrast",{mode:i}))}),a(),{section:N("sectionContrast",i),update:a,refreshLabels:function(){i.title=_("contrastTitle"),a()}}}function O(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.setAttribute("aria-label",_("toggleFont")),i.title=_("fontTitle"),i.setAttribute("aria-pressed","false"),i.appendChild(function(){const e=document.createElement("span");return e.className="accessify-toolbar-v2-font-d-badge",e.setAttribute("aria-hidden","true"),e.textContent="D",e}());const n=document.createElement("span");function s(){const t="dyslexia"===e().fontType;n.textContent=_(t?"fontDyslexia":"fontDefault"),i.setAttribute("aria-pressed",t?"true":"false")}return i.appendChild(n),i.addEventListener("click",()=>{t(),s();P(_("announceFont",{state:_("dyslexia"===e().fontType?"on":"off")}))}),s(),{section:N("sectionFont",i),update:s,refreshLabels:function(){i.setAttribute("aria-label",_("toggleFont")),i.title=_("fontTitle"),s()}}}const B={none:"colorFilterNone",grayscale:"colorFilterGrayscale",invert:"colorFilterInvert"};function $(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.title=_("colorAdjustmentsTitle");const n=M(z.palette),s=document.createElement("span");function a(){const t=e().colorFilter||"none";s.textContent=_(B[t]||"colorFilterNone"),function(e,t){const i=_(B[t]||"colorFilterNone");e.setAttribute("aria-label",_("colorFilterAriaLabelCurrent",{mode:i}))}(i,t)}return i.appendChild(n),i.appendChild(s),i.addEventListener("click",()=>{t(),a();const i=_(B[e().colorFilter]||"colorFilterNone");P(_("announceColorFilter",{mode:i}))}),a(),{section:N("sectionColorAdjustments",i),update:a,refreshLabels:function(){i.title=_("colorAdjustmentsTitle"),a()}}}const G=[{id:"textSize",labelKey:"controlTextSize",defaultVisible:!0,customizable:!0,create:(e,t)=>function(e,t,i){const n=document.createElement("button");n.type="button",n.className="accessify-toolbar-v2-btn",n.setAttribute("aria-label",_("decreaseTextSize")),n.title=_("decreaseTextSize"),n.appendChild(M(z.typeSmall));const s=document.createElement("span");s.className="accessify-toolbar-v2-text-a",s.textContent="A",s.style.fontSize="0.75rem",s.style.fontWeight="700",n.appendChild(s);const a=document.createElement("span");a.className="accessify-toolbar-v2-value",a.setAttribute("aria-live","polite");const r=document.createElement("button");r.type="button",r.className="accessify-toolbar-v2-btn",r.setAttribute("aria-label",_("increaseTextSize")),r.title=_("increaseTextSize"),r.appendChild(M(z.typeLarge));const o=document.createElement("span");function c(){const t=e().textSize;a.textContent=t+"%",n.disabled=t<=80,r.disabled=t>=200}o.className="accessify-toolbar-v2-text-a",o.textContent="A",o.style.fontSize="1rem",o.style.fontWeight="700",r.appendChild(o),n.addEventListener("click",()=>{t(),c()}),r.addEventListener("click",()=>{i(),c()});const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.gap="8px",l.style.width="100%",n.style.flex="1",r.style.flex="1";const h=document.createElement("div");return h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="center",h.style.padding="0 8px",h.appendChild(a),l.appendChild(n),l.appendChild(h),l.appendChild(r),c(),{section:N("sectionTextSize",l),update:c,refreshLabels:function(){n.setAttribute("aria-label",_("decreaseTextSize")),n.title=_("decreaseTextSize"),r.setAttribute("aria-label",_("increaseTextSize")),r.title=_("increaseTextSize")}}}(e,t.onDecrease,t.onIncrease)},{id:"contrast",labelKey:"controlContrast",defaultVisible:!0,customizable:!0,create:(e,t)=>D(e,t.onContrastCycle)},{id:"spacing",labelKey:"controlSpacing",defaultVisible:!0,customizable:!0,create:(e,t)=>function(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.setAttribute("aria-label",_("toggleSpacing")),i.title=_("spacingTitle"),i.setAttribute("aria-pressed","false"),i.appendChild(M(z.alignJustify));const n=document.createElement("span");function s(){const t="wide"===e().textSpacing;n.textContent=_(t?"spacingWide":"spacingNormal"),i.setAttribute("aria-pressed",t?"true":"false")}return i.appendChild(n),i.addEventListener("click",()=>{t(),s(),P(_("announceSpacing",{state:_("wide"===e().textSpacing?"spacingWide":"spacingNormal")}))}),s(),{section:N("sectionSpacing",i),update:s,refreshLabels:function(){i.setAttribute("aria-label",_("toggleSpacing")),i.title=_("spacingTitle"),s()}}}(e,t.onSpacingToggle)},{id:"font",labelKey:"controlFont",defaultVisible:!0,customizable:!0,create:(e,t)=>O(e,t.onFontToggle)},{id:"links",labelKey:"controlLinks",defaultVisible:!0,customizable:!0,create:(e,t)=>function(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.setAttribute("aria-label",_("toggleLinks")),i.title=_("linksTitle"),i.setAttribute("aria-pressed","false"),i.appendChild(M(z.link));const n=document.createElement("span");function s(){const t=e().highlightLinks;n.textContent=_(t?"on":"off"),i.setAttribute("aria-pressed",t?"true":"false")}return i.appendChild(n),i.addEventListener("click",()=>{t(),s(),P(_("announceLinks",{state:_(e().highlightLinks?"on":"off")}))}),s(),{section:N("sectionLinks",i),update:s,refreshLabels:function(){i.setAttribute("aria-label",_("toggleLinks")),i.title=_("linksTitle"),s()}}}(e,t.onLinksToggle)},{id:"cursor",labelKey:"controlCursor",defaultVisible:!0,customizable:!0,create:(e,t)=>function(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.setAttribute("aria-label",_("toggleCursor")),i.title=_("cursorTitle"),i.setAttribute("aria-pressed","false"),i.appendChild(M(z.mousePointer));const n=document.createElement("span");function s(){const t=e().highlightCursor;n.textContent=_(t?"on":"off"),i.setAttribute("aria-pressed",t?"true":"false")}return i.appendChild(n),i.addEventListener("click",()=>{t(),s(),P(_("announceCursor",{state:_(e().highlightCursor?"on":"off")}))}),s(),{section:N("sectionCursor",i),update:s,refreshLabels:function(){i.setAttribute("aria-label",_("toggleCursor")),i.title=_("cursorTitle"),s()}}}(e,t.onCursorToggle)},{id:"colorAdjustments",labelKey:"controlColorAdjustments",defaultVisible:!1,customizable:!0,create:(e,t)=>$(e,t.onColorFilterCycle)},{id:"reset",labelKey:"controlReset",defaultVisible:!0,customizable:!1,create:(e,t)=>function(e){const t=document.createElement("div");t.className="accessify-toolbar-v2-section accessify-toolbar-v2-reset",t.setAttribute("data-control-id","reset");const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-btn",i.setAttribute("aria-label",_("resetAriaLabel")),i.title=_("resetTitle"),i.appendChild(M(z.rotateCcw));const n=document.createElement("span");return n.textContent=_("resetLabel"),i.appendChild(n),t.appendChild(i),i.addEventListener("click",()=>{e(),P(_("announceReset"))}),{section:t,update:()=>{},refreshLabels:function(){i.setAttribute("aria-label",_("resetAriaLabel")),i.title=_("resetTitle"),n.textContent=_("resetLabel")}}}(t.onReset)},{id:"language",labelKey:"controlLanguage",defaultVisible:!1,customizable:!0,create:(e,t)=>function(e,t={}){const i=document.createElement("div");i.className="accessify-toolbar-v2-language-buttons",i.setAttribute("role","group"),i.setAttribute("aria-label",_("sectionLanguage"));const n=new Map;return function e(){i.innerHTML="";const s=C();for(const a of k()){const r=document.createElement("button");r.type="button",r.className="accessify-toolbar-v2-btn accessify-toolbar-v2-language-btn",r.setAttribute("aria-pressed",a===s?"true":"false"),r.textContent="en"===a?_("languageEn"):"he"===a?_("languageHe"):a.toUpperCase(),r.addEventListener("click",()=>{C()!==a&&(E(a),t.onLanguageChange&&t.onLanguageChange(a),e())}),n.set(a,r),i.appendChild(r)}}(),{section:N("sectionLanguage",i),update:function(){const e=C();n.forEach((t,i)=>{t.setAttribute("aria-pressed",i===e?"true":"false"),t.textContent="en"===i?_("languageEn"):"he"===i?_("languageHe"):i.toUpperCase()})}}}(0,t)}],U=new Map(G.map(e=>[e.id,e]));function V(e){return U.get(e)}function j(){const e={};for(const t of G)t.customizable&&(e[t.id]=t.defaultVisible);return e}function K(e,t,i){const n=U.get(e);return n?n.create(t,i):null}function q(e){const t=G.map(e=>e.id);return e&&0!==e.length?e.filter(e=>U.has(e)):t}class W{constructor(e,t={}){this.accessify=e,this.config=t,this.isInitialized=!1,this.speechSynthesis=null,this.currentUtterance=null,this.voiceQueue=[],this.isPlaying=!1,this.isPaused=!1,this.currentPosition=0,this.totalLength=0}async init(){try{if(this.isInitialized)return;this._initializeSpeechSynthesis(),this._setupEventListeners(),this._createUIControls(),this.isInitialized=!0,this.accessify.emit("textToSpeechPluginInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Text-to-speech plugin initialization","plugin"),e}}destroy(){try{if(!this.isInitialized)return;this.stop(),this._removeEventListeners(),this._removeUIControls(),this.isInitialized=!1,this.accessify.emit("textToSpeechPluginDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Text-to-speech plugin destruction","plugin")}}_initializeSpeechSynthesis(){if(!("speechSynthesis"in window))throw new Error("Speech synthesis not supported in this browser");this.speechSynthesis=window.speechSynthesis,this.speechSynthesis.addEventListener("voiceschanged",()=>{this.accessify.emit("voicesChanged",this.getAvailableVoices())})}_setupEventListeners(){document.addEventListener("mouseup",this._handleTextSelection.bind(this)),document.addEventListener("keydown",this._handleKeyboardShortcuts.bind(this)),this.accessify.on("configUpdated",this._handleConfigUpdate.bind(this))}_handleTextSelection(e){const t=window.getSelection().toString().trim();t&&this.config.autoSpeakOnSelection&&this.speak(t)}_handleKeyboardShortcuts(e){if(e.ctrlKey||e.metaKey)switch(e.key){case"s":e.shiftKey&&(e.preventDefault(),this.speak(document.body.textContent));break;case"p":e.preventDefault(),this.isPlaying?this.pause():this.isPaused&&this.resume();break;case"q":e.preventDefault(),this.stop()}}_handleConfigUpdate(e){e.reading&&e.reading.textToSpeech&&(this.config={...this.config,...e.reading.textToSpeech})}_createUIControls(){this.config.showControls&&(this.controlPanel=document.createElement("div"),this.controlPanel.className="accessify-tts-controls",this.controlPanel.setAttribute("aria-label","Text-to-speech controls"),this.playButton=document.createElement("button"),this.playButton.className="accessify-tts-play",this.playButton.setAttribute("aria-label","Play text-to-speech"),this.playButton.innerHTML="â–¶ï¸",this.playButton.addEventListener("click",()=>{this.isPlaying?this.pause():this.isPaused?this.resume():this.speak(document.body.textContent)}),this.stopButton=document.createElement("button"),this.stopButton.className="accessify-tts-stop",this.stopButton.setAttribute("aria-label","Stop text-to-speech"),this.stopButton.innerHTML="â¹ï¸",this.stopButton.addEventListener("click",()=>this.stop()),this.rateControl=document.createElement("input"),this.rateControl.type="range",this.rateControl.min="0.5",this.rateControl.max="2.0",this.rateControl.step="0.1",this.rateControl.value=this.config.rate||1,this.rateControl.setAttribute("aria-label","Speech rate"),this.rateControl.addEventListener("input",e=>{this.setRate(parseFloat(e.target.value))}),this.volumeControl=document.createElement("input"),this.volumeControl.type="range",this.volumeControl.min="0",this.volumeControl.max="1",this.volumeControl.step="0.1",this.volumeControl.value=this.config.volume||1,this.volumeControl.setAttribute("aria-label","Speech volume"),this.volumeControl.addEventListener("input",e=>{this.setVolume(parseFloat(e.target.value))}),this.voiceSelector=document.createElement("select"),this.voiceSelector.setAttribute("aria-label","Voice selection"),this.voiceSelector.addEventListener("change",e=>{this.setVoice(e.target.value)}),this._populateVoiceSelector(),this.controlPanel.appendChild(this.playButton),this.controlPanel.appendChild(this.stopButton),this.controlPanel.appendChild(this.rateControl),this.controlPanel.appendChild(this.volumeControl),this.controlPanel.appendChild(this.voiceSelector),document.body.appendChild(this.controlPanel),this._addControlPanelCSS())}_populateVoiceSelector(){const e=this.getAvailableVoices();this.voiceSelector.innerHTML="";const t=document.createElement("option");t.value="auto",t.textContent="Auto (System Default)",this.voiceSelector.appendChild(t),e.forEach(e=>{const t=document.createElement("option");t.value=e.name,t.textContent=`${e.name} (${e.lang})`,this.voiceSelector.appendChild(t)})}_addControlPanelCSS(){const e=document.createElement("style");e.textContent='\n      .accessify-tts-controls {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: rgba(0, 0, 0, 0.8);\n        color: white;\n        padding: 10px;\n        border-radius: 8px;\n        display: flex;\n        gap: 10px;\n        align-items: center;\n        z-index: 10000;\n        font-family: Arial, sans-serif;\n      }\n      \n      .accessify-tts-controls button {\n        background: #0066cc;\n        color: white;\n        border: none;\n        padding: 8px 12px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 16px;\n      }\n      \n      .accessify-tts-controls button:hover {\n        background: #0052a3;\n      }\n      \n      .accessify-tts-controls button:disabled {\n        background: #666;\n        cursor: not-allowed;\n      }\n      \n      .accessify-tts-controls input[type="range"] {\n        width: 80px;\n      }\n      \n      .accessify-tts-controls select {\n        background: white;\n        color: black;\n        border: 1px solid #ccc;\n        padding: 4px;\n        border-radius: 4px;\n        font-size: 12px;\n      }\n    ',document.head.appendChild(e)}_removeUIControls(){this.controlPanel&&this.controlPanel.parentNode&&this.controlPanel.parentNode.removeChild(this.controlPanel)}_removeEventListeners(){document.removeEventListener("mouseup",this._handleTextSelection),document.removeEventListener("keydown",this._handleKeyboardShortcuts)}speak(e,t={}){if(!this.speechSynthesis)throw new Error("Speech synthesis not available");this.stop();const i=new SpeechSynthesisUtterance(e);if(i.rate=t.rate||this.config.rate||1,i.pitch=t.pitch||this.config.pitch||1,i.volume=t.volume||this.config.volume||1,t.voice||"auto"!==this.config.voice){const e=this._getVoice(t.voice||this.config.voice);e&&(i.voice=e)}i.onstart=()=>{this.isPlaying=!0,this.isPaused=!1,this._updatePlayButton(),this.accessify.emit("speechStarted",i)},i.onend=()=>{this.isPlaying=!1,this.isPaused=!1,this._updatePlayButton(),this.accessify.emit("speechEnded",i),this.currentUtterance=null},i.onerror=e=>{this.isPlaying=!1,this.isPaused=!1,this._updatePlayButton(),this.accessify.emit("speechError",e),this.currentUtterance=null},this.currentUtterance=i,this.speechSynthesis.speak(i)}pause(){this.speechSynthesis&&this.speechSynthesis.speaking&&(this.speechSynthesis.pause(),this.isPaused=!0,this.isPlaying=!1,this._updatePlayButton())}resume(){this.speechSynthesis&&this.speechSynthesis.paused&&(this.speechSynthesis.resume(),this.isPlaying=!0,this.isPaused=!1,this._updatePlayButton())}stop(){this.speechSynthesis&&this.speechSynthesis.speaking&&this.speechSynthesis.cancel(),this.isPlaying=!1,this.isPaused=!1,this._updatePlayButton()}setRate(e){this.config.rate=e,this.rateControl&&(this.rateControl.value=e)}setVolume(e){this.config.volume=e,this.volumeControl&&(this.volumeControl.value=e)}setVoice(e){this.config.voice=e,this.voiceSelector&&(this.voiceSelector.value=e)}getAvailableVoices(){return this.speechSynthesis?this.speechSynthesis.getVoices().map(e=>({name:e.name,lang:e.lang,default:e.default,localService:e.localService})):[]}_getVoice(e){if(!this.speechSynthesis)return null;const t=this.speechSynthesis.getVoices();let i=t.find(t=>t.name===e);return i||(i=t.find(t=>t.lang.startsWith(e))),i||(i=t.find(e=>e.default)),i}_updatePlayButton(){this.playButton&&(this.isPlaying?(this.playButton.innerHTML="â¸ï¸",this.playButton.setAttribute("aria-label","Pause text-to-speech")):this.isPaused?(this.playButton.innerHTML="â–¶ï¸",this.playButton.setAttribute("aria-label","Resume text-to-speech")):(this.playButton.innerHTML="â–¶ï¸",this.playButton.setAttribute("aria-label","Play text-to-speech")))}getStatus(){return{isInitialized:this.isInitialized,isPlaying:this.isPlaying,isPaused:this.isPaused,currentUtterance:this.currentUtterance,config:this.config}}updateConfig(e){this.config={...this.config,...e}}}class Y{constructor(e,t={}){this.accessify=e,this.config=t,this.isInitialized=!1,this.voiceRecognition=null,this.isListening=!1,this.commands=new Map,this.recognitionTimeout=null,this.lastCommandTime=0}async init(){try{if(this.isInitialized)return;if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))throw new Error("Speech recognition not supported in this browser");this._initializeSpeechRecognition(),this._setupDefaultCommands(),this._setupEventListeners(),this._createUIControls(),this.isInitialized=!0,this.accessify.emit("voiceCommandsPluginInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Voice commands plugin initialization","plugin"),e}}destroy(){try{if(!this.isInitialized)return;this.stopListening(),this._removeEventListeners(),this._removeUIControls(),this.isInitialized=!1,this.accessify.emit("voiceCommandsPluginDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Voice commands plugin destruction","plugin")}}_initializeSpeechRecognition(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.voiceRecognition=new e,this.voiceRecognition.continuous=this.config.continuous||!0,this.voiceRecognition.interimResults=this.config.interimResults||!1,this.voiceRecognition.lang=this.config.language||this.accessify.configManager.get("language","en-US"),this.voiceRecognition.maxAlternatives=this.config.maxAlternatives||1,this.voiceRecognition.onstart=()=>{this.isListening=!0,this._updateListenButton(),this.accessify.emit("voiceRecognitionStarted")},this.voiceRecognition.onresult=e=>{this._handleRecognitionResult(e)},this.voiceRecognition.onerror=e=>{this._handleRecognitionError(e)},this.voiceRecognition.onend=()=>{this.isListening=!1,this._updateListenButton(),this.accessify.emit("voiceRecognitionEnded"),this.config.continuous&&this.config.autoRestart&&setTimeout(()=>{this.config.autoRestart&&this.startListening()},1e3)}}_setupDefaultCommands(){this.registerCommand("scroll up",()=>{window.scrollBy(0,-100)}),this.registerCommand("scroll down",()=>{window.scrollBy(0,100)}),this.registerCommand("scroll left",()=>{window.scrollBy(-100,0)}),this.registerCommand("scroll right",()=>{window.scrollBy(100,0)}),this.registerCommand("go back",()=>{window.history.length>1&&window.history.back()}),this.registerCommand("go forward",()=>{window.history.length>1&&window.history.forward()}),this.registerCommand("increase text size",()=>{this.accessify.visual.increaseTextSize()}),this.registerCommand("decrease text size",()=>{this.accessify.visual.decreaseTextSize()}),this.registerCommand("toggle contrast",()=>{this.accessify.visual.toggleContrastMode()}),this.registerCommand("toggle high contrast",()=>{this.accessify.visual.setContrastMode("high")}),this.registerCommand("toggle dark mode",()=>{this.accessify.visual.setTheme("dark")}),this.registerCommand("toggle light mode",()=>{this.accessify.visual.setTheme("light")}),this.registerCommand("speak page",()=>{const e=document.body.textContent;this.accessify.reading.speak(e)}),this.registerCommand("speak selection",()=>{const e=window.getSelection();e.toString().trim()&&this.accessify.reading.speak(e.toString())}),this.registerCommand("stop speaking",()=>{this.accessify.reading.stop()}),this.registerCommand("pause speaking",()=>{this.accessify.reading.pause()}),this.registerCommand("resume speaking",()=>{this.accessify.reading.resume()}),this.registerCommand("start listening",()=>{this.startListening()}),this.registerCommand("stop listening",()=>{this.stopListening()}),this.registerCommand("toggle listening",()=>{this.isListening?this.stopListening():this.startListening()})}_setupEventListeners(){document.addEventListener("keydown",this._handleKeyboardShortcuts.bind(this)),this.accessify.on("configUpdated",this._handleConfigUpdate.bind(this))}_handleKeyboardShortcuts(e){if((e.ctrlKey||e.metaKey)&&"v"===e.key)e.shiftKey&&(e.preventDefault(),this.toggleListening())}_handleConfigUpdate(e){e.motor&&e.motor.voice&&(this.config={...this.config,...e.motor.voice})}_createUIControls(){this.config.showControls&&(this.controlPanel=document.createElement("div"),this.controlPanel.className="accessify-voice-controls",this.controlPanel.setAttribute("aria-label","Voice command controls"),this.listenButton=document.createElement("button"),this.listenButton.className="accessify-voice-listen",this.listenButton.setAttribute("aria-label","Start voice commands"),this.listenButton.innerHTML="ðŸŽ¤",this.listenButton.addEventListener("click",()=>this.toggleListening()),this.statusIndicator=document.createElement("div"),this.statusIndicator.className="accessify-voice-status",this.statusIndicator.textContent="Voice commands ready",this.commandList=document.createElement("div"),this.commandList.className="accessify-voice-commands",this.commandList.innerHTML="<h4>Available Commands:</h4>",this._populateCommandList(),this.controlPanel.appendChild(this.listenButton),this.controlPanel.appendChild(this.statusIndicator),this.controlPanel.appendChild(this.commandList),document.body.appendChild(this.controlPanel),this._addControlPanelCSS())}_populateCommandList(){Object.entries({Navigation:["scroll up","scroll down","go back","go forward"],Accessibility:["increase text size","decrease text size","toggle contrast","toggle high contrast"],"Text-to-Speech":["speak page","speak selection","stop speaking","pause speaking"],"Voice Controls":["start listening","stop listening","toggle listening"]}).forEach(([e,t])=>{const i=document.createElement("div");i.className="accessify-voice-group";const n=document.createElement("h5");n.textContent=e,i.appendChild(n);const s=document.createElement("ul");t.forEach(e=>{const t=document.createElement("li");t.textContent=e,s.appendChild(t)}),i.appendChild(s),this.commandList.appendChild(i)})}_addControlPanelCSS(){const e=document.createElement("style");e.textContent="\n      .accessify-voice-controls {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: rgba(0, 0, 0, 0.9);\n        color: white;\n        padding: 15px;\n        border-radius: 8px;\n        max-width: 300px;\n        z-index: 10000;\n        font-family: Arial, sans-serif;\n        font-size: 14px;\n      }\n      \n      .accessify-voice-listen {\n        background: #0066cc;\n        color: white;\n        border: none;\n        padding: 10px 15px;\n        border-radius: 50%;\n        cursor: pointer;\n        font-size: 20px;\n        margin-bottom: 10px;\n        transition: all 0.3s ease;\n      }\n      \n      .accessify-voice-listen:hover {\n        background: #0052a3;\n      }\n      \n      .accessify-voice-listen.listening {\n        background: #ff4444;\n        animation: pulse 1s infinite;\n      }\n      \n      @keyframes pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.1); }\n        100% { transform: scale(1); }\n      }\n      \n      .accessify-voice-status {\n        margin-bottom: 10px;\n        font-weight: bold;\n        color: #00ff00;\n      }\n      \n      .accessify-voice-commands h4 {\n        margin: 0 0 10px 0;\n        color: #ffcc00;\n      }\n      \n      .accessify-voice-group {\n        margin-bottom: 10px;\n      }\n      \n      .accessify-voice-group h5 {\n        margin: 0 0 5px 0;\n        color: #ffcc00;\n        font-size: 12px;\n      }\n      \n      .accessify-voice-group ul {\n        margin: 0;\n        padding-left: 15px;\n        font-size: 11px;\n      }\n      \n      .accessify-voice-group li {\n        margin-bottom: 2px;\n      }\n    ",document.head.appendChild(e)}_removeUIControls(){this.controlPanel&&this.controlPanel.parentNode&&this.controlPanel.parentNode.removeChild(this.controlPanel)}_removeEventListeners(){document.removeEventListener("keydown",this._handleKeyboardShortcuts)}registerCommand(e,t){if("function"!=typeof t)throw new Error("Command callback must be a function");this.commands.set(e.toLowerCase(),t),this.accessify.emit("voiceCommandRegistered",e)}unregisterCommand(e){this.commands.delete(e.toLowerCase()),this.accessify.emit("voiceCommandUnregistered",e)}startListening(){if(!this.voiceRecognition)throw new Error("Voice recognition not initialized");if(!this.isListening)try{this.voiceRecognition.start()}catch(e){this.accessify.errorHandler.handle(e,"Failed to start voice recognition","plugin")}}stopListening(){this.voiceRecognition&&this.isListening&&this.voiceRecognition.stop()}toggleListening(){this.isListening?this.stopListening():this.startListening()}_handleRecognitionResult(e){const t=e.results[e.results.length-1];if(t.isFinal){const e=t[0].transcript.toLowerCase().trim();this._processCommand(e)}}_processCommand(e){this._updateStatus(`Heard: "${e}"`),this.accessify.emit("voiceCommand",e);const t=this._findMatchingCommand(e);if(t)try{t.callback(),this._updateStatus(`Executed: "${t.name}"`),this.accessify.emit("voiceCommandExecuted",t.name)}catch(e){this.accessify.errorHandler.handle(e,`Failed to execute command: ${t.name}`,"plugin"),this._updateStatus(`Error executing: "${t.name}"`)}else this._updateStatus(`Unknown command: "${e}"`),this.accessify.emit("voiceCommandUnknown",e)}_findMatchingCommand(e){if(this.commands.has(e))return{name:e,callback:this.commands.get(e)};for(const[t,i]of this.commands)if(e.includes(t)||t.includes(e))return{name:t,callback:i};return null}_handleRecognitionError(e){switch(this._updateStatus(`Error: ${e.error}`),this.accessify.emit("voiceRecognitionError",e),e.error){case"no-speech":this._updateStatus("No speech detected");break;case"audio-capture":this._updateStatus("Microphone not available");break;case"not-allowed":this._updateStatus("Microphone permission denied");break;case"network":this._updateStatus("Network error");break;default:this._updateStatus(`Recognition error: ${e.error}`)}}_updateStatus(e){this.statusIndicator&&(this.statusIndicator.textContent=e)}_updateListenButton(){this.listenButton&&(this.isListening?(this.listenButton.classList.add("listening"),this.listenButton.setAttribute("aria-label","Stop voice commands")):(this.listenButton.classList.remove("listening"),this.listenButton.setAttribute("aria-label","Start voice commands")))}getStatus(){return{isInitialized:this.isInitialized,isListening:this.isListening,commands:Array.from(this.commands.keys()),config:this.config}}updateConfig(e){this.config={...this.config,...e},this.voiceRecognition&&(this.voiceRecognition.continuous=this.config.continuous||!0,this.voiceRecognition.interimResults=this.config.interimResults||!1,this.voiceRecognition.lang=this.config.language||this.accessify.configManager.get("language","en-US"))}}class X{constructor(e,t={}){this.accessify=e,this.config=t,this.isInitialized=!1,this.switchElements=[],this.currentIndex=0,this.scanInterval=null,this.isScanning=!1,this.scanSpeed=1e3,this.activationTimeout=null,this.activationDelay=2e3}async init(){try{if(this.isInitialized)return;this._setupSwitchNavigation(),this._setupKeyboardAlternatives(),this._setupEventListeners(),this._createUIControls(),this.isInitialized=!0,this.accessify.emit("switchNavigationPluginInitialized")}catch(e){throw this.accessify.errorHandler.handle(e,"Switch navigation plugin initialization","plugin"),e}}destroy(){try{if(!this.isInitialized)return;this.stopScanning(),this._removeEventListeners(),this._removeUIControls(),this.isInitialized=!1,this.accessify.emit("switchNavigationPluginDestroyed")}catch(e){this.accessify.errorHandler.handle(e,"Switch navigation plugin destruction","plugin")}}_setupSwitchNavigation(){this._findInteractiveElements(),this._setupScanning()}_findInteractiveElements(){this.switchElements=Array.from(document.querySelectorAll(["button","a[href]",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[role="button"]','[role="link"]','[role="menuitem"]','[role="tab"]','[role="option"]'].join(", "))).filter(e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&!e.hasAttribute("aria-hidden")}),this.accessify.emit("switchElementsFound",this.switchElements.length)}_setupScanning(){this._setupScanIndicators()}_setupScanIndicators(){this._addScanIndicatorCSS()}_addScanIndicatorCSS(){const e=document.createElement("style");e.textContent="\n      .accessify-scan-indicator {\n        position: absolute;\n        border: 3px solid #ff0000;\n        background: rgba(255, 0, 0, 0.1);\n        pointer-events: none;\n        z-index: 10000;\n        transition: all 0.3s ease;\n        border-radius: 4px;\n      }\n      \n      .accessify-scan-indicator::before {\n        content: '';\n        position: absolute;\n        top: -6px;\n        left: -6px;\n        right: -6px;\n        bottom: -6px;\n        border: 1px solid rgba(255, 0, 0, 0.3);\n        border-radius: 7px;\n        pointer-events: none;\n      }\n      \n      .accessify-scan-indicator.active {\n        border-color: #00ff00;\n        background: rgba(0, 255, 0, 0.1);\n        animation: scanPulse 1s infinite;\n      }\n      \n      @keyframes scanPulse {\n        0% { transform: scale(1); opacity: 1; }\n        50% { transform: scale(1.05); opacity: 0.7; }\n        100% { transform: scale(1); opacity: 1; }\n      }\n    ",document.head.appendChild(e)}_setupKeyboardAlternatives(){document.addEventListener("keydown",this._handleKeyboardInput.bind(this))}_handleKeyboardInput(e){if(this.config.enabled)switch(e.key){case"Enter":case" ":this.isScanning&&(e.preventDefault(),this.activateCurrentElement());break;case"ArrowRight":case"ArrowDown":this.isScanning&&(e.preventDefault(),this.nextElement());break;case"ArrowLeft":case"ArrowUp":this.isScanning&&(e.preventDefault(),this.previousElement());break;case"Escape":this.isScanning&&(e.preventDefault(),this.stopScanning())}}_setupEventListeners(){new MutationObserver(()=>{this._findInteractiveElements()}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["tabindex","role","aria-hidden"]}),this.accessify.on("configUpdated",this._handleConfigUpdate.bind(this))}_handleConfigUpdate(e){e.motor&&e.motor.switchNavigation&&(this.config={...this.config,...e.motor.switchNavigation})}_createUIControls(){this.config.showControls&&(this.controlPanel=document.createElement("div"),this.controlPanel.className="accessify-switch-controls",this.controlPanel.setAttribute("aria-label","Switch navigation controls"),this.scanButton=document.createElement("button"),this.scanButton.className="accessify-switch-scan",this.scanButton.setAttribute("aria-label","Start switch navigation"),this.scanButton.textContent="Start Switch Navigation",this.scanButton.addEventListener("click",()=>this.toggleScanning()),this.speedControl=document.createElement("input"),this.speedControl.type="range",this.speedControl.min="500",this.speedControl.max="3000",this.speedControl.step="100",this.speedControl.value=this.scanSpeed,this.speedControl.setAttribute("aria-label","Scan speed"),this.speedControl.addEventListener("input",e=>{this.setScanSpeed(parseInt(e.target.value))}),this.speedLabel=document.createElement("label"),this.speedLabel.textContent=`Scan Speed: ${this.scanSpeed}ms`,this.statusIndicator=document.createElement("div"),this.statusIndicator.className="accessify-switch-status",this.statusIndicator.textContent="Switch navigation ready",this.instructions=document.createElement("div"),this.instructions.className="accessify-switch-instructions",this.instructions.innerHTML="\n      <h4>Switch Navigation Instructions:</h4>\n      <ul>\n        <li>Use arrow keys to navigate between elements</li>\n        <li>Press Enter or Space to activate the current element</li>\n        <li>Press Escape to stop scanning</li>\n        <li>Adjust scan speed with the slider</li>\n      </ul>\n    ",this.controlPanel.appendChild(this.scanButton),this.controlPanel.appendChild(this.speedControl),this.controlPanel.appendChild(this.speedLabel),this.controlPanel.appendChild(this.statusIndicator),this.controlPanel.appendChild(this.instructions),document.body.appendChild(this.controlPanel),this._addControlPanelCSS())}_addControlPanelCSS(){const e=document.createElement("style");e.textContent='\n      .accessify-switch-controls {\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        background: rgba(0, 0, 0, 0.9);\n        color: white;\n        padding: 15px;\n        border-radius: 8px;\n        max-width: 300px;\n        z-index: 10000;\n        font-family: Arial, sans-serif;\n        font-size: 14px;\n      }\n      \n      .accessify-switch-scan {\n        background: #0066cc;\n        color: white;\n        border: none;\n        padding: 10px 15px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 14px;\n        margin-bottom: 10px;\n        width: 100%;\n      }\n      \n      .accessify-switch-scan:hover {\n        background: #0052a3;\n      }\n      \n      .accessify-switch-scan.scanning {\n        background: #ff4444;\n      }\n      \n      .accessify-switch-controls input[type="range"] {\n        width: 100%;\n        margin: 10px 0;\n      }\n      \n      .accessify-switch-status {\n        margin: 10px 0;\n        font-weight: bold;\n        color: #00ff00;\n      }\n      \n      .accessify-switch-instructions h4 {\n        margin: 0 0 10px 0;\n        color: #ffcc00;\n      }\n      \n      .accessify-switch-instructions ul {\n        margin: 0;\n        padding-left: 15px;\n        font-size: 12px;\n      }\n      \n      .accessify-switch-instructions li {\n        margin-bottom: 5px;\n      }\n    ',document.head.appendChild(e)}_removeUIControls(){this.controlPanel&&this.controlPanel.parentNode&&this.controlPanel.parentNode.removeChild(this.controlPanel)}_removeEventListeners(){document.removeEventListener("keydown",this._handleKeyboardInput)}startScanning(){this.isScanning||(0!==this.switchElements.length?(this.isScanning=!0,this.currentIndex=0,this.scanInterval=setInterval(()=>{this._highlightCurrentElement()},this.scanSpeed),this._highlightCurrentElement(),this._updateStatus(`Scanning ${this.switchElements.length} elements`),this._updateScanButton(),this.accessify.emit("switchScanningStarted")):this._updateStatus("No interactive elements found"))}stopScanning(){this.isScanning&&(this.isScanning=!1,this.scanInterval&&(clearInterval(this.scanInterval),this.scanInterval=null),this.activationTimeout&&(clearTimeout(this.activationTimeout),this.activationTimeout=null),this._removeScanIndicators(),this._updateStatus("Switch navigation stopped"),this._updateScanButton(),this.accessify.emit("switchScanningStopped"))}toggleScanning(){this.isScanning?this.stopScanning():this.startScanning()}nextElement(){this.isScanning&&(this.currentIndex=(this.currentIndex+1)%this.switchElements.length,this._highlightCurrentElement())}previousElement(){this.isScanning&&(this.currentIndex=0===this.currentIndex?this.switchElements.length-1:this.currentIndex-1,this._highlightCurrentElement())}activateCurrentElement(){if(!this.isScanning||this.currentIndex>=this.switchElements.length)return;const e=this.switchElements[this.currentIndex];this.activationTimeout&&clearTimeout(this.activationTimeout),this.activationTimeout=setTimeout(()=>{this._performActivation(e)},this.activationDelay),this._updateStatus(`Activating in ${this.activationDelay}ms...`)}_performActivation(e){try{e.focus(),"BUTTON"===e.tagName||"button"===e.getAttribute("role")||"A"===e.tagName?e.click():"INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName?e.focus():"0"===e.getAttribute("tabindex")&&e.click(),this._updateStatus(`Activated: ${this._getElementDescription(e)}`),this.accessify.emit("switchElementActivated",e)}catch(e){this.accessify.errorHandler.handle(e,"Failed to activate switch element","plugin")}}_highlightCurrentElement(){if(this._removeScanIndicators(),this.currentIndex>=this.switchElements.length)return;const e=this.switchElements[this.currentIndex],t=e.getBoundingClientRect(),i=document.createElement("div");i.className="accessify-scan-indicator",i.style.top=`${t.top+window.scrollY}px`,i.style.left=`${t.left+window.scrollX}px`,i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,document.body.appendChild(i),this._updateStatus(`Element ${this.currentIndex+1} of ${this.switchElements.length}: ${this._getElementDescription(e)}`)}_removeScanIndicators(){document.querySelectorAll(".accessify-scan-indicator").forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}_getElementDescription(e){return e.getAttribute("aria-label")||e.getAttribute("title")||e.textContent?.trim()||e.getAttribute("alt")||e.getAttribute("placeholder")||e.tagName.toLowerCase()||"Unknown element"}setScanSpeed(e){this.scanSpeed=e,this.speedLabel&&(this.speedLabel.textContent=`Scan Speed: ${e}ms`),this.isScanning&&(this.stopScanning(),this.startScanning())}_updateStatus(e){this.statusIndicator&&(this.statusIndicator.textContent=e)}_updateScanButton(){this.scanButton&&(this.isScanning?(this.scanButton.textContent="Stop Switch Navigation",this.scanButton.classList.add("scanning"),this.scanButton.setAttribute("aria-label","Stop switch navigation")):(this.scanButton.textContent="Start Switch Navigation",this.scanButton.classList.remove("scanning"),this.scanButton.setAttribute("aria-label","Start switch navigation")))}getStatus(){return{isInitialized:this.isInitialized,isScanning:this.isScanning,currentIndex:this.currentIndex,totalElements:this.switchElements.length,scanSpeed:this.scanSpeed,config:this.config}}updateConfig(e){this.config={...this.config,...e}}}class J{constructor(p={}){this.version="1.0.0",this.isInitialized=!1,this.eventEmitter=new e,this.stateManager=new t,this.configManager=new i(p),this.pluginManager=new n(this),this.browserDetection=new s,this.errorHandler=new a,this.visual=new r(this),this.navigation=new o(this),this.reading=new c(this),this.motor=new l(this),this.multilingual=new h(this),this.aria=new d(this),this.readingGuide=new u(this),this.screenReader=new g(this),this._registerBuiltInPlugins(),this.init=this.init.bind(this),this.destroy=this.destroy.bind(this),this.updateConfig=this.updateConfig.bind(this),this.getState=this.getState.bind(this),this.setState=this.setState.bind(this),this.on=this.on.bind(this),this.off=this.off.bind(this),this.emit=this.emit.bind(this)}async init(){try{if(this.isInitialized)return console.warn("Accessify is already initialized"),this;if(!this.browserDetection.isSupported)throw new Error("Browser not supported. Please use Chrome 60+, Firefox 55+, Safari 12+, or Edge 79+");return await this.multilingual.init(),await this.visual.init(),await this.navigation.init(),await this.reading.init(),await this.motor.init(),await this.aria.init(),await this.readingGuide.init(),await this.screenReader.init(),await this.pluginManager.init(),this.isInitialized=!0,this.emit("initialized"),console.log("Accessify initialized successfully"),this}catch(e){throw this.errorHandler.handle(e,"Initialization failed"),e}}destroy(){try{if(!this.isInitialized)return this;this.screenReader.destroy(),this.readingGuide.destroy(),this.aria.destroy(),this.motor.destroy(),this.reading.destroy(),this.navigation.destroy(),this.visual.destroy(),this.multilingual.destroy(),this.pluginManager.destroy(),this.eventEmitter.removeAllListeners(),this.stateManager.clear(),this.isInitialized=!1,this.emit("destroyed"),console.log("Accessify destroyed")}catch(e){this.errorHandler.handle(e,"Destruction failed")}}updateConfig(e){this.configManager.update(e),this.emit("configUpdated",e)}getState(){return this.stateManager.getState()}setState(e){this.stateManager.setState(e),this.emit("stateChanged",e)}on(e,t){return this.eventEmitter.on(e,t),this}off(e,t){return this.eventEmitter.off(e,t),this}emit(e,...t){return this.eventEmitter.emit(e,...t),this}_registerBuiltInPlugins(){this.pluginManager.register("textToSpeech",W),this.pluginManager.register("voiceCommands",Y),this.pluginManager.register("switchNavigation",X)}getComponent(e){return{visual:this.visual,navigation:this.navigation,reading:this.reading,motor:this.motor,multilingual:this.multilingual,aria:this.aria,readingGuide:this.readingGuide,screenReader:this.screenReader}[e]}isFeatureEnabled(e){return this.configManager.isFeatureEnabled(e)}enableFeature(e){this.configManager.enableFeature(e),this.emit("featureEnabled",e)}disableFeature(e){this.configManager.disableFeature(e),this.emit("featureDisabled",e)}getComplianceStatus(){return{wcag:this._checkWCAGCompliance(),israeliStandard:this._checkIsraeliStandardCompliance(),features:this._getFeatureCompliance()}}_checkWCAGCompliance(){const e=this.configManager.getEnabledFeatures();return{level:"AA",version:"2.1",compliant:this._validateWCAGFeatures(e),score:this._calculateWCAGScore(e)}}_checkIsraeliStandardCompliance(){const e=this.configManager.getEnabledFeatures();return{compliant:this._validateIsraeliStandardFeatures(e),score:this._calculateIsraeliStandardScore(e)}}_getFeatureCompliance(){return{visual:this.visual.getComplianceStatus(),navigation:this.navigation.getComplianceStatus(),reading:this.reading.getComplianceStatus(),motor:this.motor.getComplianceStatus(),multilingual:this.multilingual.getComplianceStatus(),aria:this.aria.getComplianceStatus(),readingGuide:this.readingGuide.getComplianceStatus(),screenReader:this.screenReader.getComplianceStatus()}}_validateWCAGFeatures(e){return["textSizeAdjustment","highContrast","keyboardNavigation","focusIndicators","skipLinks","altText"].every(t=>e.includes(t))}_calculateWCAGScore(e){const t=e.length;return Math.round(t/20*100)}_validateIsraeliStandardFeatures(e){return["rtlSupport","hebrewSupport","textSizeAdjustment","highContrast","keyboardNavigation"].every(t=>e.includes(t))}_calculateIsraeliStandardScore(e){const t=e.length;return Math.round(t/15*100)}}return J.ToolbarV2=class{constructor(e={}){this.options=e,this.syncWithPageLanguage=!!e.syncWithPageLanguage,this.settings={...m},this.isOpen=!1,this.trigger=null,this.panel=null,this.panelBody=null,this.cursorHighlight=new L,this.controlUpdates=[],this.customizeSetVisible=null,this._boundKeydown=this._onKeydown.bind(this)}init(){b(),this.settings=function(){try{const e=localStorage.getItem(p);if(!e)return{...m};const t=JSON.parse(e);return{...m,...t}}catch{return{...m}}}(),this.settings.visibleControls={...j(),...this.settings.visibleControls};const e=A(document.documentElement.getAttribute("lang")),t=document.documentElement.getAttribute("dir");e?(E(e),this.settings.language=e,f(this.settings)):"rtl"===t?(E("he"),this.settings.language="he",f(this.settings)):this.settings.language?E(this.settings.language):(E("en"),this.settings.language="en");const i=q(this.options.availableControls),n=()=>this.settings,s={textSize:{onDecrease:()=>{this.settings.textSize=Math.max(80,this.settings.textSize-10),this._persistAndApply()},onIncrease:()=>{this.settings.textSize=Math.min(200,this.settings.textSize+10),this._persistAndApply()}},contrast:{onContrastCycle:()=>{const e=["normal","high","dark"].indexOf(this.settings.contrastMode);this.settings.contrastMode=["normal","high","dark"][(e+1)%3],this._persistAndApply()}},spacing:{onSpacingToggle:()=>{this.settings.textSpacing="wide"===this.settings.textSpacing?"normal":"wide",this._persistAndApply()}},font:{onFontToggle:()=>{this.settings.fontType="dyslexia"===this.settings.fontType?"default":"dyslexia",this._persistAndApply()}},links:{onLinksToggle:()=>{this.settings.highlightLinks=!this.settings.highlightLinks,this._persistAndApply()}},cursor:{onCursorToggle:()=>{this.settings.highlightCursor=!this.settings.highlightCursor,this._persistAndApply(),this.cursorHighlight.setVisible(this.settings.highlightCursor)}},reset:{onReset:()=>{this.settings={...m,visibleControls:j()},this._persistAndApply(),this.cursorHighlight.setVisible(!1),this._applyVisibleControls(),this.controlUpdates.forEach(e=>e())}},language:{onLanguageChange:e=>{this.settings.language=e,f(this.settings),this.syncWithPageLanguage&&(document.documentElement.setAttribute("lang",e),document.documentElement.setAttribute("dir",function(e){return"he"===e?"rtl":"ltr"}(e))),this._refreshAllLabels()}},colorAdjustments:{onColorFilterCycle:()=>{const e=["none","grayscale","invert"],t=e.indexOf(this.settings.colorFilter||"none");this.settings.colorFilter=e[(t+1)%e.length],this._persistAndApply()}}},a=function(e,t,i){const n=t(),s=document.createElement("div");s.className="accessify-toolbar-v2-customize-body";const a=new Map,r=new Map;let o=null,c=null;for(const t of e){const e=V(t);if(!e||!e.customizable)continue;const o=document.createElement("label");o.className="accessify-toolbar-v2-customize-label";const c=document.createElement("input");c.type="checkbox",c.className="accessify-toolbar-v2-customize-checkbox",c.setAttribute("data-aria-label-key","showControl"),c.setAttribute("data-aria-label-vars",JSON.stringify({label:e.labelKey})),c.setAttribute("aria-label",_("showControl",{label:_(e.labelKey)})),c.checked=!1!==n[t],a.set(t,c);const l=document.createElement("span");l.className="accessify-toolbar-v2-customize-label-text",l.setAttribute("data-label-key",e.labelKey),l.textContent=_(e.labelKey),r.set(t,l),o.appendChild(c),o.appendChild(l),c.addEventListener("change",()=>{const e=!!c.checked;i(t,e)}),s.appendChild(o)}const l=document.createElement("div");l.className="accessify-toolbar-v2-section accessify-toolbar-v2-customize";const h=document.createElement("button");h.type="button",h.className="accessify-toolbar-v2-customize-header",h.setAttribute("aria-expanded","false"),h.setAttribute("aria-controls","accessify-toolbar-v2-customize-body"),h.setAttribute("aria-label",_("customizeHeader")),o=h;const d=document.createElement("span");d.className="accessify-toolbar-v2-customize-header-label",d.textContent=_("customizeHeader"),c=d;const u=M(z.chevronDown,"accessify-toolbar-v2-customize-chevron");return h.appendChild(d),h.appendChild(u),s.id="accessify-toolbar-v2-customize-body",s.hidden=!0,h.addEventListener("click",()=>{const e=!("true"===h.getAttribute("aria-expanded"));h.setAttribute("aria-expanded",String(e)),s.hidden=!e,l.classList.toggle("accessify-toolbar-v2-customize-open",e)}),l.appendChild(h),l.appendChild(s),{section:l,setVisible:(e,t)=>{const i=a.get(e);i&&(i.checked=t)},refreshLabels:function(){o&&o.setAttribute("aria-label",_("customizeHeader")),c&&(c.textContent=_("customizeHeader")),r.forEach((e,t)=>{const i=V(t);i&&(e.textContent=_(i.labelKey))}),a.forEach((e,t)=>{const i=V(t);i&&e.setAttribute("aria-label",_("showControl",{label:_(i.labelKey)}))})}}}(i,()=>this.settings.visibleControls||{},(e,t)=>{this.settings.visibleControls||(this.settings.visibleControls={}),this.settings.visibleControls[e]=t,f(this.settings),this._applyVisibleControls()});this.customizeSetVisible=a.setVisible;const r=[a.section],o=[],c=[];for(const e of i){if(!V(e))continue;const t=K(e,n,s[e]||{});t&&(t.section.setAttribute("data-control-id",e),r.push(t.section),t.update&&o.push(t.update),t.refreshLabels&&c.push(t.refreshLabels))}this.controlUpdates=o,this._refreshLabelFns=c,this._customizeRefreshLabels=a.refreshLabels,this.trigger=function(e,t){const i=document.createElement("button");i.type="button",i.className="accessify-toolbar-v2-trigger",i.setAttribute("aria-label",_("triggerAriaLabel")),i.title=_("triggerTitle"),i.setAttribute("aria-expanded","false");const n=document.createElement("img");n.src="assets/accessify-icon.png",n.alt="",n.className="accessify-toolbar-v2-trigger-icon-img",n.setAttribute("aria-hidden","true");const s=M(z.accessibility);return s.classList.add("accessify-toolbar-v2-trigger-fallback"),n.onerror=()=>{n.parentNode===i&&i.removeChild(n)},i.appendChild(n),i.appendChild(s),i.addEventListener("click",()=>{e(),i.setAttribute("aria-expanded",String(t()))}),{element:i,setExpanded(e){i.setAttribute("aria-expanded",String(e))},refreshLabels(){i.setAttribute("aria-label",_("triggerAriaLabel")),i.title=_("triggerTitle")}}}(()=>this.toggle(),()=>this.isOpen),this._updateTriggerDir();const l=function(e,t){const i=document.createElement("div");i.className="accessify-toolbar-v2-panel",i.setAttribute("role","dialog"),i.setAttribute("aria-labelledby","accessify-toolbar-v2-dialog-title"),i.setAttribute("aria-modal","true");const n=I(t),s=n.element,a=s.querySelector(".accessify-toolbar-v2-header-title-text");a&&(a.id="accessify-toolbar-v2-dialog-title"),i.appendChild(s);const r=document.createElement("div");return r.className="accessify-toolbar-v2-panel-body",e.forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&r.appendChild(e)}),i.appendChild(r),{panel:i,refreshHeaderLabels:n.refreshLabels}}(r,()=>this.close());var h;this.panel=l.panel,this._refreshHeaderLabels=l.refreshHeaderLabels,this.panelBody=this.panel.querySelector(".accessify-toolbar-v2-panel-body"),this._unsubscribeLanguage=(h=()=>this._refreshAllLabels(),S.push(h),()=>{const e=S.indexOf(h);-1!==e&&S.splice(e,1)});const d=document.createElement("div");for(d.id="accessify-toolbar-v2-content-wrapper";document.body.firstChild;)d.appendChild(document.body.firstChild);document.body.appendChild(d),document.body.appendChild(this.trigger.element),this.panel.style.display="none",document.body.appendChild(this.panel),this._contentWrapper=d,this._applyVisibleControls(),this._applySettingsToDocument(),this.cursorHighlight.mount(),this.cursorHighlight.setVisible(this.settings.highlightCursor),this._refreshAllLabels(),this.syncWithPageLanguage&&(this._langObserver=new MutationObserver(e=>{for(const t of e)if("lang"===t.attributeName||"dir"===t.attributeName){const e=A(document.documentElement.getAttribute("lang"));e&&e!==C()&&(E(e),this.settings.language=e,f(this.settings),this._refreshAllLabels());break}}),this._langObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["lang","dir"]})),document.addEventListener("keydown",this._boundKeydown)}_updateTriggerDir(){if(this.trigger&&this.trigger.element){const e="he"===C()?"rtl":"ltr";this.trigger.element.setAttribute("dir",e)}}_refreshAllLabels(){const e=C();this.panel&&(this.panel.setAttribute("dir","he"===e?"rtl":"ltr"),this.panel.setAttribute("lang",e)),this._updateTriggerDir(),this.trigger&&this.trigger.refreshLabels&&this.trigger.refreshLabels(),this._refreshHeaderLabels&&this._refreshHeaderLabels(),this._customizeRefreshLabels&&this._customizeRefreshLabels(),this.panel&&this.panel.querySelectorAll("[data-section-label-key]").forEach(e=>{const t=e.getAttribute("data-section-label-key");t&&(e.textContent=_(t))}),(this._refreshLabelFns||[]).forEach(e=>e()),this.controlUpdates.forEach(e=>e())}_applyVisibleControls(){const e=this.settings.visibleControls||{};if(this.panelBody&&(this.panelBody.querySelectorAll("[data-control-id]").forEach(t=>{const i=t.getAttribute("data-control-id"),n=i?V(i):null,s=n&&(!n.customizable||!1!==e[i]);t.style.display=s?"":"none"}),this.customizeSetVisible))for(const t of Object.keys(e))this.customizeSetVisible(t,!1!==e[t])}_applySettingsToDocument(){document.documentElement.style.fontSize=this.settings.textSize+"%";const e=document.body,t=this._contentWrapper;t?(t.classList.remove("contrast-normal","contrast-high","contrast-dark"),t.classList.add("contrast-"+(this.settings.contrastMode||"normal"))):(e.classList.remove("contrast-normal","contrast-high","contrast-dark"),e.classList.add("contrast-"+(this.settings.contrastMode||"normal"))),"wide"===this.settings.textSpacing?e.classList.add("text-spacing-wide"):e.classList.remove("text-spacing-wide"),"dyslexia"===this.settings.fontType?e.classList.add("font-dyslexia"):e.classList.remove("font-dyslexia"),this.settings.highlightLinks?e.classList.add("highlight-links"):e.classList.remove("highlight-links"),this.settings.highlightCursor?e.classList.add("highlight-cursor"):e.classList.remove("highlight-cursor");const i=t||e,n=["none","grayscale","invert"].includes(this.settings.colorFilter)?this.settings.colorFilter:"none";i.classList.remove("color-filter-none","color-filter-grayscale","color-filter-invert"),i.classList.add("color-filter-"+n)}_persistAndApply(){const e=window.scrollX??document.documentElement.scrollLeft,t=window.scrollY??document.documentElement.scrollTop;f(this.settings),this._applySettingsToDocument(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo(e,t)})})}_onKeydown(e){"Escape"===e.key&&this.isOpen&&(e.preventDefault(),this.close())}open(){this.isOpen||(this.isOpen=!0,this.panel.style.display="",this.trigger.setExpanded(!0))}close(){this.isOpen&&(this.isOpen=!1,this.panel.style.display="none",this.trigger.setExpanded(!1))}toggle(){this.isOpen?this.close():this.open()}destroy(){if(this._unsubscribeLanguage&&this._unsubscribeLanguage(),this._langObserver&&(this._langObserver.disconnect(),this._langObserver=null),document.removeEventListener("keydown",this._boundKeydown),this.trigger&&this.trigger.element.parentNode&&this.trigger.element.parentNode.removeChild(this.trigger.element),this.panel&&this.panel.parentNode&&this.panel.parentNode.removeChild(this.panel),this.cursorHighlight.unmount(),document.documentElement.style.fontSize="",document.body.classList.remove("text-spacing-wide","font-dyslexia","highlight-links","highlight-cursor","color-filter-none","color-filter-grayscale","color-filter-invert"),this._contentWrapper&&this._contentWrapper.parentNode){const e=this._contentWrapper.parentNode;for(;this._contentWrapper.firstChild;)e.insertBefore(this._contentWrapper.firstChild,this._contentWrapper);e.removeChild(this._contentWrapper)}}getSettings(){return{...this.settings}}},"undefined"!=typeof window&&(window.Accessify=J),J});
//# sourceMappingURL=accessify.min.js.map
